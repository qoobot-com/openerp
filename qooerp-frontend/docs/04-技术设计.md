# QooERP 统一前端工程 - 技术设计文档

> 文档版本: v1.0
> 创建日期: 20xx-xx-xx
> 最后更新: 20xx-xx-xx

---

## 一、技术栈选型

### 1.1 核心技术栈

| 技术领域 | 技术选型 | 版本 | 选型理由 |
|---------|---------|------|---------|
| 前端框架 | Vue 3 | 3.4+ | 响应式系统、Composition API、性能优异 |
| 开发语言 | TypeScript | 5.3+ | 类型安全、代码提示、减少运行时错误 |
| 构建工具 | Vite | 5.0+ | 快速冷启动、HMR、原生 ESM |
| UI组件库 | TDesign | Latest | 腾讯企业级设计语言、组件丰富、主题定制 |
| 状态管理 | Pinia | 2.1+ | Vue 官方推荐、轻量、TypeScript 友好 |
| 路由 | Vue Router | 4.2+ | 官方路由、动态路由、导航守卫 |
| HTTP 客户端 | Axios | 1.6+ | 拦截器、请求/响应转换、取消请求 |
| 国际化 | Vue I18n | 9.x | 多语言支持、格式化、复数规则 |
| 日期处理 | Day.js | 1.11+ | 轻量级、API 友好、插件系统 |
| 工具函数 | Lodash-es | 4.17+ | 模块化、Tree Shaking |
| 图表库 | ECharts | 5.x | 图表丰富、交互性强、主题定制 |
| 桌面端 | Electron | Latest | 跨平台、原生能力、成熟方案 |
| 移动端 | Capacitor | 5.x | 现代化、原生插件、渐进增强 |
| 代码规范 | ESLint + Prettier | Latest | 代码质量、格式统一 |
| 单元测试 | Vitest | Latest | Vite 生态、快速测试 |
| E2E测试 | Playwright | Latest | 跨浏览器、自动等待 |

---

### 1.2 技术架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        应用层                                    │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   Web 端      │  │  Desktop端    │  │  Mobile端    │          │
│  │  Vue 3 + TS  │  │  Electron    │  │  Capacitor   │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
└─────────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                        框架层                                    │
│  Vue 3 + TypeScript + Pinia + Vue Router + TDesign             │
└─────────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                        工具层                                    │
│  Axios + Day.js + Lodash + ECharts + Vue I18n                   │
└─────────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                        构建层                                    │
│  Vite + TypeScript + ESLint + Prettier + Vitest                │
└─────────────────────────────────────────────────────────────────┘
```

---

## 二、项目结构设计

### 2.1 Monorepo 结构

```
qooerp-frontend/
├── packages/                      # 子包目录
│   ├── web/                      # Web 端应用
│   │   ├── src/
│   │   │   ├── main.ts           # 入口文件
│   │   │   ├── App.vue           # 根组件
│   │   │   ├── assets/           # 静态资源
│   │   │   │   ├── styles/       # 样式文件
│   │   │   │   │   ├── index.scss
│   │   │   │   │   ├── variables.scss
│   │   │   │   │   └── mixins.scss
│   │   │   │   ├── images/       # 图片资源
│   │   │   │   └── icons/        # 图标资源
│   │   │   ├── components/       # 组件目录
│   │   │   │   ├── layout/       # 布局组件
│   │   │   │   │   ├── MainLayout.vue
│   │   │   │   │   ├── Sidebar.vue
│   │   │   │   │   └── Header.vue
│   │   │   │   ├── common/       # 通用组件
│   │   │   │   │   ├── Table.vue
│   │   │   │   │   ├── Form.vue
│   │   │   │   │   └── SearchCard.vue
│   │   │   │   └── business/     # 业务组件
│   │   │   │       ├── UserSelect.vue
│   │   │   │       └── OrgTree.vue
│   │   │   ├── views/            # 页面视图
│   │   │   │   ├── auth/
│   │   │   │   ├── system/
│   │   │   │   ├── hr/
│   │   │   │   ├── finance/
│   │   │   │   └── ...
│   │   │   ├── router/           # 路由配置
│   │   │   │   ├── index.ts
│   │   │   │   ├── modules/
│   │   │   │   └── guards.ts
│   │   │   ├── stores/           # 状态管理
│   │   │   │   ├── index.ts
│   │   │   │   └── modules/
│   │   │   │       ├── auth.ts
│   │   │   │       ├── user.ts
│   │   │   │       └── ...
│   │   │   ├── api/              # API 接口
│   │   │   │   ├── index.ts
│   │   │   │   ├── request.ts
│   │   │   │   └── modules/
│   │   │   │       ├── auth.ts
│   │   │   │       ├── system.ts
│   │   │   │       └── ...
│   │   │   ├── hooks/            # 组合式函数
│   │   │   │   ├── useAuth.ts
│   │   │   │   ├── useTable.ts
│   │   │   │   ├── useForm.ts
│   │   │   │   └── ...
│   │   │   ├── composables/     # Composables(共享)
│   │   │   │   ├── useRequest.ts
│   │   │   │   └── useDialog.ts
│   │   │   ├── utils/            # 工具函数
│   │   │   │   ├── index.ts
│   │   │   │   ├── format.ts
│   │   │   │   ├── validate.ts
│   │   │   │   └── storage.ts
│   │   │   ├── constants/        # 常量定义
│   │   │   │   └── index.ts
│   │   │   ├── types/            # 类型定义
│   │   │   │   ├── index.ts
│   │   │   │   ├── base.ts
│   │   │   │   ├── user.ts
│   │   │   │   └── ...
│   │   │   ├── directives/      # 自定义指令
│   │   │   │   └── index.ts
│   │   │   ├── plugins/          # 插件配置
│   │   │   │   ├── i18n.ts
│   │   │   │   ├── router.ts
│   │   │   │   └── store.ts
│   │   │   ├── config/           # 配置文件
│   │   │   │   └── index.ts
│   │   │   └── locales/          # 国际化
│   │   │       ├── zh-CN/
│   │   │       └── en-US/
│   │   ├── public/              # 公共资源
│   │   │   ├── favicon.ico
│   │   │   └── index.html
│   │   ├── package.json
│   │   ├── vite.config.ts
│   │   └── tsconfig.json
│   │
│   ├── desktop/                 # Desktop 端
│   │   ├── src/
│   │   │   ├── main/            # Electron 主进程
│   │   │   │   ├── index.ts
│   │   │   │   ├── ipc.ts
│   │   │   │   └── window.ts
│   │   │   └── preload/         # 预加载脚本
│   │   │       └── index.ts
│   │   ├── package.json
│   │   └── electron.config.js
│   │
│   └── mobile/                  # Mobile 端
│       ├── src/
│       ├── android/
│       ├── ios/
│       ├── capacitor.config.ts
│       └── package.json
│
├── shared/                      # 共享代码
│   ├── components/              # 共享组件
│   ├── composables/            # 共享 Composables
│   ├── utils/                  # 共享工具函数
│   ├── types/                  # 共享类型定义
│   └── constants/              # 共享常量
│
├── scripts/                     # 脚本文件
│   ├── build.sh
│   └── release.sh
│
├── docs/                        # 文档目录
│   ├── 01-业务设计.md
│   ├── 02-应用设计.md
│   ├── 03-数据设计.md
│   ├── 04-技术设计.md
│   ├── 05-交互设计.md
│   └── 06-开发进度.md
│
├── .github/                     # GitHub 配置
│   └── workflows/              # CI/CD 配置
│
├── pnpm-workspace.yaml         # pnpm 工作区配置
├── package.json                # 根 package.json
├── tsconfig.json               # TypeScript 配置
├── .eslintrc.cjs               # ESLint 配置
├── .prettierrc                 # Prettier 配置
├── .editorconfig               # Editor 配置
├── .gitignore                  # Git 忽略配置
└── README.md                   # 项目说明
```

---

### 2.2 Web 端详细结构

```
packages/web/src/
├── main.ts                     # 应用入口
├── App.vue                     # 根组件
│
├── assets/                     # 静态资源
│   └── styles/
│       ├── index.scss          # 主样式
│       ├── variables.scss      # SCSS 变量
│       ├── mixins.scss         # SCSS Mixins
│       ├── reset.scss          # 样式重置
│       └── responsive.scss      # 响应式样式
│
├── components/                 # 组件
│   ├── layout/                 # 布局组件
│   │   ├── MainLayout.vue     # 主布局
│   │   ├── Sidebar.vue         # 侧边栏
│   │   ├── Header.vue          # 头部
│   │   ├── Tabs.vue            # 标签页
│   │   └── Breadcrumb.vue      # 面包屑
│   │
│   ├── common/                 # 通用组件
│   │   ├── Table.vue           # 表格组件
│   │   ├── Form.vue            # 表单组件
│   │   ├── SearchCard.vue      # 搜索卡片
│   │   ├── StatusTag.vue       # 状态标签
│   │   ├── AmountDisplay.vue   # 金额显示
│   │   └── ActionButton.vue    # 操作按钮组
│   │
│   └── business/               # 业务组件
│       ├── UserSelect.vue      # 用户选择器
│       ├── OrgTree.vue         # 组织树
│       ├── SupplierPicker.vue  # 供应商选择
│       ├── CustomerPicker.vue  # 客户选择
│       └── MaterialPicker.vue  # 物料选择
│
├── views/                      # 页面视图
│   ├── auth/                   # 认证模块
│   │   ├── Login.vue
│   │   ├── Register.vue
│   │   └── ForgotPassword.vue
│   │
│   ├── system/                 # 系统管理
│   │   ├── Params.vue
│   │   ├── Configs.vue
│   │   ├── Dictionaries.vue
│   │   ├── Menus.vue
│   │   └── Logs.vue
│   │
│   ├── auth/                   # 权限管理
│   │   ├── Permissions.vue
│   │   ├── Roles.vue
│   │   ├── Users.vue
│   │   └── AuditLog.vue
│   │
│   ├── org/                    # 组织架构
│   │   ├── Units.vue
│   │   ├── Departments.vue
│   │   ├── Positions.vue
│   │   └── Ranks.vue
│   │
│   └── ...
│
├── router/                     # 路由
│   ├── index.ts                # 路由入口
│   ├── modules/                # 路由模块
│   │   ├── auth.ts
│   │   ├── system.ts
│   │   └── ...
│   └── guards.ts               # 路由守卫
│
├── stores/                     # 状态管理
│   ├── index.ts
│   └── modules/
│       ├── auth.ts
│       ├── user.ts
│       ├── permission.ts
│       ├── menu.ts
│       └── ...
│
├── api/                        # API 接口
│   ├── index.ts
│   ├── request.ts              # Axios 实例配置
│   └── modules/
│       ├── auth.ts
│       ├── system.ts
│       └── ...
│
├── hooks/                      # 组合式函数
│   ├── useAuth.ts
│   ├── useTable.ts
│   ├── useForm.ts
│   ├── useDialog.ts
│   ├── useMessage.ts
│   └── useRequest.ts
│
├── composables/                # 共享 Composables
│   └── index.ts
│
├── utils/                      # 工具函数
│   ├── index.ts
│   ├── format.ts               # 格式化工具
│   ├── validate.ts             # 验证工具
│   ├── storage.ts              # 存储工具
│   ├── cache.ts                # 缓存工具
│   └── transform.ts            # 数据转换
│
├── constants/                  # 常量
│   └── index.ts
│
├── types/                      # 类型定义
│   ├── index.ts
│   ├── base.ts
│   ├── user.ts
│   ├── system.ts
│   └── ...
│
├── directives/                 # 自定义指令
│   ├── index.ts
│   ├── permission.ts           # 权限指令
│   └── loading.ts              # 加载指令
│
├── plugins/                    # 插件
│   ├── index.ts
│   ├── i18n.ts
│   ├── router.ts
│   └── store.ts
│
├── config/                     # 配置
│   └── index.ts
│
└── locales/                    # 国际化
    ├── zh-CN/
    │   ├── common.json
    │   ├── auth.json
    │   └── ...
    └── en-US/
        ├── common.json
        ├── auth.json
        └── ...
```

---

## 三、核心技术实现

### 3.1 HTTP 请求封装

```typescript
// packages/web/src/api/request.ts
import axios, { type AxiosInstance, type AxiosRequestConfig, type AxiosResponse } from 'axios'
import { MessagePlugin } from 'tdesign-vue-next'
import { useAuthStore } from '@/stores/auth'
import router from '@/router'

// 基础配置
const BASE_URL = import.meta.env.VITE_API_BASE_URL || '/api'
const TIMEOUT = 30000

// 创建 Axios 实例
const service: AxiosInstance = axios.create({
  baseURL: BASE_URL,
  timeout: TIMEOUT,
  headers: {
    'Content-Type': 'application/json;charset=UTF-8'
  }
})

/**
 * 请求拦截器
 */
service.interceptors.request.use(
  (config) => {
    const authStore = useAuthStore()

    // 添加 Token
    if (authStore.token) {
      config.headers['Authorization'] = `Bearer ${authStore.token}`
    }

    // 添加租户 ID
    const tenantId = localStorage.getItem('tenantId')
    if (tenantId) {
      config.headers['X-Tenant-Id'] = tenantId
    }

    // 添加语言
    const language = localStorage.getItem('language') || 'zh-CN'
    config.headers['Accept-Language'] = language

    return config
  },
  (error) => {
    console.error('Request Error:', error)
    return Promise.reject(error)
  }
)

/**
 * 响应拦截器
 */
service.interceptors.response.use(
  (response: AxiosResponse) => {
    const res = response.data

    // 成功响应
    if (res.code === 200 || res.code === 0) {
      return res.data
    }

    // 业务错误
    MessagePlugin.error(res.message || '请求失败')
    return Promise.reject(new Error(res.message || 'Error'))
  },
  (error) => {
    const authStore = useAuthStore()

    if (error.response) {
      switch (error.response.status) {
        case 401:
          // Token 过期
          MessagePlugin.error('登录已过期,请重新登录')
          authStore.logout()
          router.push('/login')
          break
        case 403:
          // 无权限
          MessagePlugin.error('无权限访问')
          break
        case 404:
          // 资源不存在
          MessagePlugin.error('请求的资源不存在')
          break
        case 500:
          // 服务器错误
          MessagePlugin.error('服务器错误,请稍后重试')
          break
        default:
          MessagePlugin.error(error.response.data?.message || '请求失败')
      }
    } else if (error.request) {
      // 请求已发送但无响应
      MessagePlugin.error('网络错误,请检查网络连接')
    } else {
      // 请求配置错误
      MessagePlugin.error(error.message || '请求失败')
    }

    return Promise.reject(error)
  }
)

/**
 * 封装请求方法
 */
export const http = {
  get<T = any>(url: string, config?: AxiosRequestConfig): Promise<T> {
    return service.get(url, config)
  },

  post<T = any>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {
    return service.post(url, data, config)
  },

  put<T = any>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {
    return service.put(url, data, config)
  },

  delete<T = any>(url: string, config?: AxiosRequestConfig): Promise<T> {
    return service.delete(url, config)
  },

  upload<T = any>(url: string, file: File, config?: AxiosRequestConfig): Promise<T> {
    const formData = new FormData()
    formData.append('file', file)
    return service.post(url, formData, {
      ...config,
      headers: {
        'Content-Type': 'multipart/form-data'
      }
    })
  },

  download(url: string, filename?: string): void {
    service.get(url, {
      responseType: 'blob'
    }).then((response) => {
      const blob = new Blob([response])
      const link = document.createElement('a')
      link.href = URL.createObjectURL(blob)
      link.download = filename || 'download'
      link.click()
      URL.revokeObjectURL(link.href)
    })
  }
}

export default service
```

---

### 3.2 路由配置

```typescript
// packages/web/src/router/index.ts
import { createRouter, createWebHistory, type RouteRecordRaw } from 'vue-router'
import { setupRouterGuards } from './guards'

const routes: RouteRecordRaw[] = [
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/views/auth/Login.vue'),
    meta: {
      title: '登录',
      hidden: true,
      noAuth: true
    }
  },
  {
    path: '/404',
    name: 'NotFound',
    component: () => import('@/views/error/404.vue'),
    meta: {
      title: '404',
      hidden: true,
      noAuth: true
    }
  },
  {
    path: '/',
    component: () => import('@/components/layout/MainLayout.vue'),
    redirect: '/dashboard',
    children: [
      {
        path: 'dashboard',
        name: 'Dashboard',
        component: () => import('@/views/dashboard/Index.vue'),
        meta: {
          title: '首页',
          icon: 'dashboard',
          keepAlive: true
        }
      }
    ]
  },
  {
    path: '/:pathMatch(.*)*',
    redirect: '/404'
  }
]

const router = createRouter({
  history: createWebHistory(import.meta.env.BASE_URL),
  routes,
  scrollBehavior(to, from, savedPosition) {
    if (savedPosition) {
      return savedPosition
    } else {
      return { top: 0 }
    }
  }
})

// 设置路由守卫
setupRouterGuards(router)

export default router
```

---

### 3.3 动态路由加载

```typescript
// packages/web/src/router/dynamic.ts
import type { RouteRecordRaw } from 'vue-router'
import { usePermissionStore } from '@/stores/permission'

/**
 * 动态加载路由
 */
export async function loadDynamicRoutes() {
  const permissionStore = usePermissionStore()

  // 获取用户菜单
  const menus = await permissionStore.fetchUserMenus()

  // 转换为路由
  const routes = transformMenusToRoutes(menus)

  // 动态添加路由
  routes.forEach((route) => {
    router.addRoute(route)
  })
}

/**
 * 菜单转路由
 */
function transformMenusToRoutes(menus: Menu[]): RouteRecordRaw[] {
  const routes: RouteRecordRaw[] = []

  menus.forEach((menu) => {
    if (menu.menuType === 'button') {
      return
    }

    const route: RouteRecordRaw = {
      path: menu.path,
      name: menu.menuCode,
      component: loadComponent(menu.component),
      meta: {
        title: menu.menuName,
        icon: menu.icon,
        hidden: !menu.visible,
        keepAlive: menu.keepAlive,
        permission: menu.permission
      }
    }

    if (menu.children && menu.children.length > 0) {
      route.children = transformMenusToRoutes(menu.children)
    }

    routes.push(route)
  })

  return routes
}

/**
 * 动态加载组件
 */
function loadComponent(component: string | undefined) {
  if (!component) {
    return () => import('@/components/layout/BlankLayout.vue')
  }

  return () => import(`@/views/${component}.vue`)
}
```

---

### 3.4 自定义指令

```typescript
// packages/web/src/directives/index.ts
import type { App, Directive } from 'vue'
import { usePermissionStore } from '@/stores/permission'

/**
 * 权限指令
 */
const permission: Directive = {
  mounted(el, binding) {
    const permissionStore = usePermissionStore()
    const { value } = binding

    if (value && !permissionStore.hasPermission(value)) {
      el.parentNode?.removeChild(el)
    }
  }
}

/**
 * 加载指令
 */
const loading: Directive = {
  mounted(el, binding) {
    if (binding.value) {
      el.classList.add('is-loading')
    }
  },
  updated(el, binding) {
    if (binding.value) {
      el.classList.add('is-loading')
    } else {
      el.classList.remove('is-loading')
    }
  }
}

/**
 * 注册指令
 */
export function setupDirectives(app: App) {
  app.directive('permission', permission)
  app.directive('loading', loading)
}
```

---

### 3.5 组合式函数示例

```typescript
// packages/web/src/hooks/useTable.ts
import { ref, reactive, onMounted } from 'vue'
import { MessagePlugin } from 'tdesign-vue-next'

export function useTable<T>(
  fetchApi: (params: any) => Promise<PageResult<T>>
) {
  // 表格数据
  const data = ref<T[]>([])
  const loading = ref(false)

  // 查询参数
  const searchForm = reactive({
    current: 1,
    pageSize: 20,
    ...defaultParams
  })

  // 分页
  const pagination = reactive({
    current: 1,
    pageSize: 20,
    total: 0,
    showSizeChanger: true,
    showQuickJumper: true,
    pageSizeOptions: [10, 20, 50, 100]
  })

  /**
   * 加载数据
   */
  const fetchData = async () => {
    loading.value = true
    try {
      const result = await fetchApi(searchForm)
      data.value = result.records
      pagination.total = result.total
    } catch (error) {
      MessagePlugin.error('加载数据失败')
    } finally {
      loading.value = false
    }
  }

  /**
   * 搜索
   */
  const handleSearch = () => {
    searchForm.current = 1
    fetchData()
  }

  /**
   * 重置
   */
  const handleReset = () => {
    Object.assign(searchForm, {
      current: 1,
      pageSize: 20
    })
    fetchData()
  }

  /**
   * 分页变化
   */
  const handlePageChange = (page: number, pageSize: number) => {
    searchForm.current = page
    searchForm.pageSize = pageSize
    fetchData()
  }

  onMounted(() => {
    fetchData()
  })

  return {
    data,
    loading,
    searchForm,
    pagination,
    fetchData,
    handleSearch,
    handleReset,
    handlePageChange
  }
}
```

---

### 3.6 表单 Hook

```typescript
// packages/web/src/hooks/useForm.ts
import { ref, reactive } from 'vue'
import type { FormInstanceFunctions, FormRule } from 'tdesign-vue-next'
import { MessagePlugin } from 'tdesign-vue-next'

export function useForm<T extends Record<string, any>>(
  initialValues: T,
  rules?: Record<keyof T, FormRule[]>
) {
  // 表单引用
  const formRef = ref<FormInstanceFunctions>()

  // 表单数据
  const formData = reactive<T>({ ...initialValues })

  // 是否加载中
  const loading = ref(false)

  /**
   * 重置表单
   */
  const reset = () => {
    Object.assign(formData, initialValues)
    formRef.value?.reset()
  }

  /**
   * 验证表单
   */
  const validate = async (): Promise<boolean> => {
    try {
      const result = await formRef.value?.validate()
      return !result || Object.keys(result).length === 0
    } catch (error) {
      MessagePlugin.error('表单验证失败')
      return false
    }
  }

  /**
   * 提交表单
   */
  const submit = async (api: (data: T) => Promise<any>) => {
    const isValid = await validate()
    if (!isValid) {
      return false
    }

    loading.value = true
    try {
      await api(formData)
      MessagePlugin.success('操作成功')
      reset()
      return true
    } catch (error) {
      MessagePlugin.error('操作失败')
      return false
    } finally {
      loading.value = false
    }
  }

  return {
    formRef,
    formData,
    loading,
    reset,
    validate,
    submit
  }
}
```

---

### 3.7 通用 Hook: useRequest

```typescript
// packages/web/src/hooks/useRequest.ts
import { ref } from 'vue'

export function useRequest<T, P extends any[] = any[]>(
  api: (...args: P) => Promise<T>,
  options: {
    immediate?: boolean
    onSuccess?: (data: T) => void
    onError?: (error: any) => void
  } = {}
) {
  const { immediate = false, onSuccess, onError } = options

  const data = ref<T>()
  const loading = ref(false)
  const error = ref<any>()

  const execute = async (...args: P): Promise<T | undefined> => {
    loading.value = true
    error.value = undefined

    try {
      const result = await api(...args)
      data.value = result
      onSuccess?.(result)
      return result
    } catch (err) {
      error.value = err
      onError?.(err)
      throw err
    } finally {
      loading.value = false
    }
  }

  if (immediate) {
    execute()
  }

  return {
    data,
    loading,
    error,
    execute
  }
}
```

---

## 四、构建配置

### 4.1 Vite 配置

```typescript
// packages/web/vite.config.ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'
import Components from 'unplugin-vue-components/vite'
import { TDesignResolver } from 'unplugin-vue-components/resolvers'
import AutoImport from 'unplugin-auto-import/vite'

export default defineConfig({
  plugins: [
    vue(),
    // 自动导入 Vue API
    AutoImport({
      imports: [
        'vue',
        'vue-router',
        'pinia',
        '@vueuse/core'
      ],
      dts: true
    }),
    // 自动导入组件
    Components({
      resolvers: [
        TDesignResolver({
          library: 'vue-next'
        })
      ],
      dts: true
    })
  ],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
      '@shared': resolve(__dirname, '../../shared')
    }
  },
  server: {
    port: 5173,
    host: true,
    open: true,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '')
      }
    }
  },
  build: {
    target: 'es2015',
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true
      }
    },
    rollupOptions: {
      output: {
        manualChunks: {
          'tdesign': ['tdesign-vue-next'],
          'vue-vendor': ['vue', 'vue-router', 'pinia'],
          'echarts': ['echarts']
        }
      }
    },
    chunkSizeWarningLimit: 1000
  }
})
```

---

### 4.2 TypeScript 配置

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "preserve",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
      "@shared/*": ["shared/*"]
    }
  },
  "include": ["src/**/*.ts", "src/**/*.d.ts", "src/**/*.tsx", "src/**/*.vue"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

---

### 4.3 ESLint 配置

```javascript
// .eslintrc.cjs
module.exports = {
  root: true,
  env: {
    browser: true,
    es2021: true,
    node: true
  },
  extends: [
    'eslint:recommended',
    'plugin:@typescript-eslint/recommended',
    'plugin:vue/vue3-recommended',
    'prettier'
  ],
  parser: 'vue-eslint-parser',
  parserOptions: {
    ecmaVersion: 'latest',
    parser: '@typescript-eslint/parser',
    sourceType: 'module'
  },
  plugins: ['@typescript-eslint', 'vue'],
  rules: {
    'vue/multi-word-component-names': 'off',
    '@typescript-eslint/no-explicit-any': 'warn',
    '@typescript-eslint/no-unused-vars': ['warn', {
      argsIgnorePattern: '^_'
    }],
    'vue/no-v-html': 'off'
  }
}
```

---

### 4.4 Prettier 配置

```json
{
  "semi": false,
  "singleQuote": true,
  "printWidth": 100,
  "trailingComma": "none",
  "arrowParens": "avoid",
  "endOfLine": "auto"
}
```

---

## 五、性能优化策略

### 5.1 代码分割

```typescript
// 路由懒加载
const routes = [
  {
    path: '/system/params',
    component: () => import('@/views/system/Params.vue')
  }
]

// 组件懒加载
const HeavyComponent = defineAsyncComponent(() =>
  import('./HeavyComponent.vue')
)
```

---

### 5.2 虚拟滚动

```vue
<template>
  <t-virtual-list
    :data="largeData"
    :item-size="50"
    :buffer-size="10"
  >
    <template #default="{ item }">
      <div>{{ item.name }}</div>
    </template>
  </t-virtual-list>
</template>
```

---

### 5.3 图片优化

```typescript
// 图片懒加载
<img v-lazy="imageUrl" />

// 图片压缩
// 使用 sharp 或 imagemin 在构建时压缩图片
```

---

## 六、监控与日志

### 6.1 OpenTelemetry 集成

```typescript
// packages/web/src/utils/otel.ts
import { initOpenTelemetry } from '@opentelemetry/sdk-web'

const telemetry = initOpenTelemetry({
  serviceName: 'qooerp-web',
  exporter: {
    url: import.meta.env.VITE_OTEL_ENDPOINT
  },
  instrumentations: {
    '@opentelemetry/instrumentation-fetch': {},
    '@opentelemetry/instrumentation-xml-http-request': {}
  }
})

export default telemetry
```

---

### 6.2 错误监控

```typescript
// packages/web/src/utils/errorHandler.ts
import { trace } from '@opentelemetry/api'

export const errorHandler = (error: Error) => {
  const tracer = trace.getTracer('qooerp-web')
  const span = tracer.startSpan('error.capture')

  span.setAttribute('error.name', error.name)
  span.setAttribute('error.message', error.message)
  span.setAttribute('error.stack', error.stack)

  // 上报到监控系统
  reportError(error)

  span.end()
}
```

---

**文档版本**: v1.0
**更新日期**: 20xx-xx-xx
