# QooERP 统一前端工程 - 数据设计文档

> 文档版本: v1.0
> 创建日期: 2026-02-19
> 最后更新: 2026-02-19

---

## 一、数据架构概述

### 1.1 数据流架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        前端数据层                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐    │
│  │   视图层      │───→│   Store     │───→│   API 层     │    │
│  │  (Views)     │    │  (Pinia)     │    │  (Axios)     │    │
│  └──────────────┘    └──────────────┘    └──────────────┘    │
│         ↑                   ↑                    │             │
│         │                   │                    │             │
│         └───────────────────┴────────────────────┘             │
│                           ↓                                  │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐    │
│  │   组件层      │───→│  Composables│───→│   Types      │    │
│  │(Components)  │    │  (Hooks)     │    │(TypeScript)  │    │
│  └──────────────┘    └──────────────┘    └──────────────┘    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                        后端服务层                                │
│                  API Gateway → 微服务 → 数据库                   │
└─────────────────────────────────────────────────────────────────┘
```

---

### 1.2 数据分类

| 数据类型 | 存储位置 | 生命周期 | 同步方式 | 示例 |
|---------|---------|---------|---------|------|
| 用户状态 | Pinia Store | 会话级 | 内存 | 当前用户信息、菜单、权限 |
| 临时数据 | Pinia Store | 会话级 | 内存 | 表单草稿、搜索条件 |
| 配置数据 | Pinia Store + LocalStorage | 长期 | 持久化 | 字典、系统参数、用户设置 |
| 业务数据 | API 响应 | 请求级 | 实时请求 | 列表数据、详情数据 |
| 缓存数据 | Pinia Store + SessionStorage | 会话级 | 内存 | 频繁访问的数据 |
| 静态数据 | 常量/枚举 | 应用级 | 编译时 | 枚举值、常量配置 |

---

## 二、数据模型设计

### 2.1 核心数据类型

#### 2.1.1 基础实体类型

```typescript
// src/types/base.ts

/**
 * 基础实体接口
 * 所有实体都应继承此接口
 */
export interface BaseEntity {
  id: number | string
  createTime: string
  updateTime: string
  createBy?: number | string
  updateBy?: number | string
  delFlag?: 0 | 1
  tenantId?: number | string
  bizDate?: number
}

/**
 * 分页请求参数
 */
export interface PageParams {
  current: number
  pageSize: number
  sortField?: string
  sortOrder?: 'asc' | 'desc'
}

/**
 * 分页响应结果
 */
export interface PageResult<T> {
  records: T[]
  total: number
  current: number
  pageSize: number
}

/**
 * API 响应结果
 */
export interface ApiResponse<T = any> {
  code: number
  message: string
  data: T
  timestamp: number
}

/**
 * 树节点接口
 */
export interface TreeNode {
  id: number | string
  parentId?: number | string
  name: string
  children?: TreeNode[]
  level?: number
  path?: string
}
```

---

#### 2.1.2 用户相关类型

```typescript
// src/types/user.ts

import type { BaseEntity, TreeNode } from './base'

/**
 * 用户信息
 */
export interface User extends BaseEntity {
  username: string
  realName: string
  email?: string
  mobile?: string
  avatar?: string
  status: UserStatus
  deptId?: number
  deptName?: string
  positionId?: number
  positionName?: string
  roles?: Role[]
  permissions?: string[]
}

/**
 * 用户状态
 */
export enum UserStatus {
  ACTIVE = 'active',
  INACTIVE = 'inactive',
  LOCKED = 'locked',
  DELETED = 'deleted'
}

/**
 * 角色信息
 */
export interface Role extends BaseEntity {
  roleName: string
  roleCode: string
  status: UserStatus
  permissions?: Permission[]
  description?: string
}

/**
 * 权限信息
 */
export interface Permission extends BaseEntity, TreeNode {
  permissionCode: string
  permissionName: string
  permissionType: PermissionType
  resourceType: string
  resourceValue: string
  component?: string
  icon?: string
  sort?: number
  visible?: boolean
}

/**
 * 权限类型
 */
export enum PermissionType {
  MENU = 'menu',         // 菜单权限
  BUTTON = 'button',     // 按钮权限
  API = 'api',           // API权限
  DATA = 'data'          // 数据权限
}

/**
 * 登录参数
 */
export interface LoginParams {
  username: string
  password: string
  captcha?: string
  tenantCode?: string
  mfaCode?: string
}

/**
 * 登录结果
 */
export interface LoginResult {
  token: string
  refreshToken: string
  expiresIn: number
  userInfo: User
}
```

---

#### 2.1.3 组织架构类型

```typescript
// src/types/organization.ts

import type { BaseEntity, TreeNode } from './base'

/**
 * 组织单元
 */
export interface Organization extends BaseEntity, TreeNode {
  orgCode: string
  orgName: string
  orgType: OrgType
  leaderId?: number
  leaderName?: string
  phone?: string
  address?: string
  status: OrgStatus
  sort?: number
}

/**
 * 组织类型
 */
export enum OrgType {
  COMPANY = 'company',     // 公司
  DEPARTMENT = 'department', // 部门
  GROUP = 'group',         // 小组
  PROJECT = 'project'      // 项目组织
}

/**
 * 组织状态
 */
export enum OrgStatus {
  ACTIVE = 'active',
  INACTIVE = 'inactive',
  FROZEN = 'frozen'
}

/**
 * 岗位
 */
export interface Position extends BaseEntity {
  positionCode: string
  positionName: string
  positionLevel: string
  positionFamily?: string
  description?: string
  headcount?: number
  actualCount?: number
  salaryRange?: {
    min: number
    max: number
  }
  status: OrgStatus
}

/**
 * 职级
 */
export interface Rank extends BaseEntity {
  rankCode: string
  rankName: string
  rankLevel: number
  rankGrade: string
  description?: string
}
```

---

#### 2.1.4 系统管理类型

```typescript
// src/types/system.ts

import type { BaseEntity, TreeNode } from './base'

/**
 * 系统参数
 */
export interface SystemParam extends BaseEntity {
  paramKey: string
  paramName: string
  paramValue: string
  paramType: ParamType
  scope: ParamScope
  description?: string
  isSystem?: boolean
}

/**
 * 参数类型
 */
export enum ParamType {
  STRING = 'string',
  NUMBER = 'number',
  BOOLEAN = 'boolean',
  JSON = 'json'
}

/**
 * 参数作用域
 */
export enum ParamScope {
  GLOBAL = 'global',    // 全局
  TENANT = 'tenant',    // 租户
  USER = 'user'         // 用户
}

/**
 * 数据字典
 */
export interface Dictionary extends BaseEntity, TreeNode {
  dictCode: string
  dictName: string
  dictType: string
  dictValue: string
  sort?: number
  status: OrgStatus
  description?: string
}

/**
 * 菜单
 */
export interface Menu extends BaseEntity, TreeNode {
  menuName: string
  menuCode: string
  menuType: MenuType
  component?: string
  path?: string
  redirect?: string
  icon?: string
  permission?: string
  visible?: boolean
  sort?: number
  keepAlive?: boolean
  isExternal?: boolean
  isAffix?: boolean
}

/**
 * 菜单类型
 */
export enum MenuType {
  DIRECTORY = 'directory', // 目录
  MENU = 'menu',          // 菜单
  BUTTON = 'button'        // 按钮
}

/**
 * 操作日志
 */
export interface OperationLog extends BaseEntity {
  moduleName: string
  operationType: string
  operationDesc: string
  requestMethod: string
  requestUrl: string
  requestParams?: string
  responseData?: string
  ipAddress: string
  userAgent: string
  executionTime?: number
  status: 'success' | 'fail'
  errorMessage?: string
}

/**
 * 登录日志
 */
export interface LoginLog extends BaseEntity {
  username: string
  loginType: string
  ipAddress: string
  loginLocation?: string
  userAgent: string
  loginTime: string
  status: 'success' | 'fail'
  errorMessage?: string
}
```

---

#### 2.1.5 人力资源类型

```typescript
// src/types/hr.ts

import type { BaseEntity } from './base'

/**
 * 员工
 */
export interface Employee extends BaseEntity {
  employeeNo: string
  realName: string
  gender: Gender
  birthDate?: string
  idCard?: string
  email?: string
  mobile?: string
  address?: string
  deptId: number
  deptName?: string
  positionId: number
  positionName?: string
  rankId?: number
  rankName?: string
  entryDate: string
  probationDate?: string
  regularDate?: string
  employeeStatus: EmployeeStatus
  contractStatus: ContractStatus
}

/**
 * 性别
 */
export enum Gender {
  MALE = 'male',
  FEMALE = 'female',
  OTHER = 'other'
}

/**
 * 员工状态
 */
export enum EmployeeStatus {
  TRIAL = 'trial',         // 试用期
  REGULAR = 'regular',     // 正式
  TRANSFER = 'transfer',   // 调动中
  RESIGN = 'resign',       // 已离职
  RETIRE = 'retire'        // 已退休
}

/**
 * 合同状态
 */
export enum ContractStatus {
  VALID = 'valid',         // 有效
  EXPIRED = 'expired',     // 已过期
  TERMINATED = 'terminated' // 已终止
}

/**
 * 请假申请
 */
export interface LeaveApplication extends BaseEntity {
  employeeId: number
  employeeName: string
  leaveType: LeaveType
  startDate: string
  endDate: string
  leaveDays: number
  reason?: string
  approverId?: number
  approverName?: string
  approvalStatus: ApprovalStatus
  approvalComment?: string
  approvalTime?: string
}

/**
 * 请假类型
 */
export enum LeaveType {
  ANNUAL = 'annual',       // 年假
  SICK = 'sick',          // 病假
  PERSONAL = 'personal',   // 事假
  MATERNITY = 'maternity', // 产假
  PATERNITY = 'paternity', // 陪产假
  COMPENSATORY = 'compensatory' // 调休
}

/**
 * 审批状态
 */
export enum ApprovalStatus {
  PENDING = 'pending',     // 待审批
  APPROVED = 'approved',   // 已通过
  REJECTED = 'rejected',   // 已驳回
  CANCELLED = 'cancelled'  // 已取消
}

/**
 * 考勤记录
 */
export interface AttendanceRecord extends BaseEntity {
  employeeId: number
  employeeName: string
  deptId: number
  deptName?: string
  attendanceDate: string
  checkInTime?: string
  checkOutTime?: string
  workHours?: number
  attendanceStatus: AttendanceStatus
  lateMinutes?: number
  earlyLeaveMinutes?: number
  overtimeHours?: number
}

/**
 * 考勤状态
 */
export enum AttendanceStatus {
  NORMAL = 'normal',       // 正常
  LATE = 'late',          // 迟到
  EARLY_LEAVE = 'early_leave', // 早退
  ABSENT = 'absent',      // 缺勤
  LEAVE = 'leave',        // 请假
  HOLIDAY = 'holiday'     // 节假日
}

/**
 * 薪酬
 */
export interface Salary extends BaseEntity {
  employeeId: number
  employeeName: string
  deptId: number
  salaryMonth: string
  baseSalary: number
  performanceSalary: number
  bonus: number
  allowance: number
  subsidy: number
  overtimePay: number
  socialSecurity: number
  housingFund: number
  tax: number
  deduction: number
  netSalary: number
  status: SalaryStatus
}

/**
 * 薪酬状态
 */
export enum SalaryStatus {
  DRAFT = 'draft',         // 草稿
  CALCULATED = 'calculated', // 已计算
  APPROVED = 'approved',   // 已审核
  PAID = 'paid'            // 已发放
}

/**
 * 绩效考核
 */
export interface PerformanceAssessment extends BaseEntity {
  employeeId: number
  employeeName: string
  deptId: number
  assessmentPeriod: string
  kpiScore: number
  competencyScore: number
  attitudeScore: number
  totalScore: number
  performanceLevel: PerformanceLevel
  assessorId?: number
  assessorName?: string
  comment?: string
}

/**
 * 绩效等级
 */
export enum PerformanceLevel {
  S = 'S',                 // 卓越
  A = 'A',                 // 优秀
  B = 'B',                 // 良好
  C = 'C',                 // 合格
  D = 'D'                  // 不合格
}
```

---

#### 2.1.6 财务管理类型

```typescript
// src/types/finance.ts

import type { BaseEntity } from './base'

/**
 * 会计科目
 */
export interface Account extends BaseEntity {
  accountCode: string
  accountName: string
  accountType: AccountType
  direction: Direction
  parentId?: number
  level: number
  isLeaf: boolean
  auxiliary: boolean
  balance?: number
  debitBalance?: number
  creditBalance?: number
  status: OrgStatus
}

/**
 * 科目类型
 */
export enum AccountType {
  ASSETS = 'assets',       // 资产
  LIABILITIES = 'liabilities', // 负债
  EQUITY = 'equity',       // 所有者权益
  REVENUE = 'revenue',     // 收入
  EXPENSES = 'expenses',   // 费用
  COST = 'cost'            // 成本
}

/**
 * 借贷方向
 */
export enum Direction {
  DEBIT = 'debit',         // 借
  CREDIT = 'credit'        // 贷
}

/**
 * 会计凭证
 */
export interface Voucher extends BaseEntity {
  voucherNo: string
  voucherDate: string
  voucherType: VoucherType
  period: string
  entryCount: number
  totalDebit: number
  totalCredit: number
  description?: string
  status: VoucherStatus
  makerId?: number
  makerName?: string
  reviewerId?: number
  reviewerName?: string
  reviewTime?: string
  bookkeeperId?: number
  bookkeeperName?: string
  bookkeepingTime?: string
  details?: VoucherDetail[]
}

/**
 * 凭证类型
 */
export enum VoucherType {
  RECEIVING = 'receiving',     // 收款凭证
  PAYMENT = 'payment',         // 付款凭证
  TRANSFER = 'transfer',       // 转账凭证
  SALES = 'sales',            // 销售凭证
  PURCHASE = 'purchase'        // 采购凭证
}

/**
 * 凭证状态
 */
export enum VoucherStatus {
  DRAFT = 'draft',         // 草稿
  SUBMITTED = 'submitted', // 已提交
  APPROVED = 'approved',   // 已审核
  BOOKED = 'booked',       // 已记账
  CANCELLED = 'cancelled' // 已作废
}

/**
 * 凭证明细
 */
export interface VoucherDetail {
  id: number
  voucherId: number
  accountId: number
  accountCode: string
  accountName: string
  direction: Direction
  amount: number
  summary?: string
  auxiliary?: Record<string, any>
}

/**
 * 应收账款
 */
export interface Receivable extends BaseEntity {
  customerCode: string
  customerName: string
  invoiceNo: string
  invoiceDate: string
  amount: number
  paidAmount: number
  balance: number
  dueDate: string
  overdueDays?: number
  aging: Aging
}

/**
 * 账龄
 */
export enum Aging {
  WITHIN_30 = 'within_30',     // 30天内
  WITHIN_60 = 'within_60',     // 60天内
  WITHIN_90 = 'within_90',     // 90天内
  WITHIN_180 = 'within_180',   // 180天内
  OVER_180 = 'over_180'       // 超过180天
}

/**
 * 固定资产
 */
export interface FixedAsset extends BaseEntity {
  assetCode: string
  assetName: string
  assetCategory: string
  originalValue: number
  netValue: number
  depreciationMethod: DepreciationMethod
  usefulLife: number
  accumulatedDepreciation: number
  purchaseDate: string
  startDate: string
  status: AssetStatus
  location?: string
  user?: string
}

/**
 * 折旧方法
 */
export enum DepreciationMethod {
  STRAIGHT_LINE = 'straight_line', // 直线法
  DOUBLE_DECLINING = 'double_declining', // 双倍余额递减法
  SUM_OF_YEARS = 'sum_of_years'   // 年数总和法
}

/**
 * 资产状态
 */
export enum AssetStatus {
  IN_USE = 'in_use',       // 在用
  IDLE = 'idle',          // 闲置
  MAINTENANCE = 'maintenance', // 维修中
  SCRAPPED = 'scrapped',   // 已报废
  TRANSFERRED = 'transferred' // 已调拨
}
```

---

#### 2.1.7 供应链类型

```typescript
// src/types/scm.ts

import type { BaseEntity } from './base'

/**
 * 供应商
 */
export interface Supplier extends BaseEntity {
  supplierCode: string
  supplierName: string
  supplierType: SupplierType
  contact?: string
  phone?: string
  email?: string
  address?: string
  creditLevel: CreditLevel
  status: OrgStatus
  balance?: number
}

/**
 * 供应商类型
 */
export enum SupplierType {
  MANUFACTURER = 'manufacturer', // 生产商
  WHOLESALER = 'wholesaler',     // 批发商
  RETAILER = 'retailer',         // 零售商
  SERVICE = 'service'           // 服务商
}

/**
 * 信用等级
 */
export enum CreditLevel {
  A = 'A',
  B = 'B',
  C = 'C',
  D = 'D'
}

/**
 * 采购订单
 */
export interface PurchaseOrder extends BaseEntity {
  orderNo: string
  supplierId: number
  supplierName: string
  orderDate: string
  deliveryDate: string
  totalAmount: number
  paidAmount: number
  status: OrderStatus
  details?: PurchaseOrderDetail[]
}

/**
 * 订单状态
 */
export enum OrderStatus {
  DRAFT = 'draft',         // 草稿
  SUBMITTED = 'submitted', // 已提交
  APPROVED = 'approved',   // 已审核
  SHIPPED = 'shipped',    // 已发货
  RECEIVED = 'received',   // 已收货
  CANCELLED = 'cancelled' // 已取消
}

/**
 * 采购订单明细
 */
export interface PurchaseOrderDetail {
  id: number
  orderId: number
  materialId: number
  materialCode: string
  materialName: string
  quantity: number
  unit: string
  price: number
  amount: number
  receivedQuantity: number
}
```

---

#### 2.1.8 销售管理类型

```typescript
// src/types/sales.ts

import type { BaseEntity } from './base'

/**
 * 客户
 */
export interface Customer extends BaseEntity {
  customerCode: string
  customerName: string
  customerType: CustomerType
  contact?: string
  phone?: string
  email?: string
  address?: string
  customerLevel: CustomerLevel
  creditLimit?: number
  balance?: number
  status: OrgStatus
}

/**
 * 客户类型
 */
export enum CustomerType {
  INDIVIDUAL = 'individual', // 个人
  ENTERPRISE = 'enterprise', // 企业
  GOVERNMENT = 'government'  // 政府
}

/**
 * 客户等级
 */
export enum CustomerLevel {
  VIP = 'vip',
  IMPORTANT = 'important',
  NORMAL = 'normal',
  POTENTIAL = 'potential'
}

/**
 * 销售订单
 */
export interface SalesOrder extends BaseEntity {
  orderNo: string
  customerId: number
  customerName: string
  orderDate: string
  deliveryDate: string
  totalAmount: number
  receivedAmount: number
  status: OrderStatus
  details?: SalesOrderDetail[]
}

/**
 * 销售订单明细
 */
export interface SalesOrderDetail {
  id: number
  orderId: number
  materialId: number
  materialCode: string
  materialName: string
  quantity: number
  unit: string
  price: number
  amount: number
  shippedQuantity: number
}
```

---

#### 2.1.9 库存管理类型

```typescript
// src/types/inventory.ts

import type { BaseEntity } from './base'

/**
 * 物料
 */
export interface Material extends BaseEntity {
  materialCode: string
  materialName: string
  materialType: string
  specification?: string
  unit: string
  safetyStock?: number
  maxStock?: number
  minStock?: number
  status: OrgStatus
}

/**
 * 库存
 */
export interface Stock extends BaseEntity {
  materialId: number
  materialCode: string
  materialName: string
  warehouseId: number
  warehouseName: string
  quantity: number
  availableQuantity: number
  lockedQuantity: number
  costPrice?: number
  totalCost?: number
}

/**
 * 入库单
 */
export interface InboundOrder extends BaseEntity {
  orderNo: string
  orderType: InboundType
  warehouseId: number
  warehouseName: string
  sourceOrderId?: number
  sourceOrderNo?: string
  orderDate: string
  totalQuantity: number
  status: OrderStatus
  details?: InboundOrderDetail[]
}

/**
 * 入库类型
 */
export enum InboundType {
  PURCHASE = 'purchase',     // 采购入库
  PRODUCTION = 'production', // 生产入库
  TRANSFER = 'transfer',     // 调拨入库
  RETURN = 'return',        // 退货入库
  OTHER = 'other'           // 其他入库
}

/**
 * 入库单明细
 */
export interface InboundOrderDetail {
  id: number
  orderId: number
  materialId: number
  materialCode: string
  materialName: string
  quantity: number
  unit: string
  batchNo?: string
}

/**
 * 出库单
 */
export interface OutboundOrder extends BaseEntity {
  orderNo: string
  orderType: OutboundType
  warehouseId: number
  warehouseName: string
  sourceOrderId?: number
  sourceOrderNo?: string
  orderDate: string
  totalQuantity: number
  status: OrderStatus
  details?: OutboundOrderDetail[]
}

/**
 * 出库类型
 */
export enum OutboundType {
  SALES = 'sales',         // 销售出库
  PRODUCTION = 'production', // 生产出库
  TRANSFER = 'transfer',   // 调拨出库
  USAGE = 'usage',        // 领用出库
  OTHER = 'other'         // 其他出库
}
```

---

### 2.2 数据转换工具

```typescript
// src/utils/transform.ts

/**
 * 格式化日期时间
 */
export function formatDateTime(timestamp: string | number): string {
  return dayjs(timestamp).format('YYYY-MM-DD HH:mm:ss')
}

/**
 * 格式化日期
 */
export function formatDate(timestamp: string | number): string {
  return dayjs(timestamp).format('YYYY-MM-DD')
}

/**
 * 格式化金额
 */
export function formatAmount(amount: number | string): string {
  return new Intl.NumberFormat('zh-CN', {
    style: 'currency',
    currency: 'CNY'
  }).format(Number(amount))
}

/**
 * 构建树形结构
 */
export function buildTree<T extends TreeNode>(items: T[]): T[] {
  const map = new Map<number | string, T>()
  const tree: T[] = []

  // 构建映射
  items.forEach(item => {
    map.set(item.id, { ...item, children: [] } as any)
  })

  // 构建树
  items.forEach(item => {
    const node = map.get(item.id)!
    if (item.parentId && map.has(item.parentId)) {
      const parent = map.get(item.parentId)!
      if (!parent.children) parent.children = []
      parent.children.push(node)
    } else {
      tree.push(node)
    }
  })

  return tree
}

/**
 * 扁平化树形结构
 */
export function flattenTree<T extends TreeNode>(tree: T[]): T[] {
  const result: T[] = []

  function traverse(nodes: T[]) {
    nodes.forEach(node => {
      result.push(node)
      if (node.children && node.children.length > 0) {
        traverse(node.children)
      }
    })
  }

  traverse(tree)
  return result
}

/**
 * 深拷贝
 */
export function deepClone<T>(obj: T): T {
  return JSON.parse(JSON.stringify(obj))
}

/**
 * 对象转URL参数
 */
export function objectToQueryString(obj: Record<string, any>): string {
  const params = new URLSearchParams()
  Object.entries(obj).forEach(([key, value]) => {
    if (value !== undefined && value !== null) {
      params.append(key, String(value))
    }
  })
  return params.toString()
}
```

---

## 三、缓存策略设计

### 3.1 缓存层级

```
┌─────────────────────────────────────────────────────────────────┐
│                        缓存层级                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  L1: 内存缓存 (Pinia Store)                                     │
│  ├─ 用户信息        (会话级)                                     │
│  ├─ 菜单权限        (会话级)                                     │
│  ├─ 字典数据        (持久化 LocalStorage)                        │
│  └─ 搜索条件        (临时)                                       │
│                                                                 │
│  L2: 浏览器缓存 (LocalStorage/SessionStorage)                    │
│  ├─ Token          (持久化)                                     │
│  ├─ 用户设置        (持久化)                                     │
│  └─ 主题语言        (持久化)                                     │
│                                                                 │
│  L3: 服务端缓存 (Redis)                                          │
│  └─ 共享数据        (跨用户)                                     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

### 3.2 缓存配置

```typescript
// src/config/cache.ts

export interface CacheConfig {
  key: string
  ttl?: number           // 过期时间(毫秒)
  storage?: 'memory' | 'localStorage' | 'sessionStorage'
  persistent?: boolean    // 是否持久化
}

/**
 * 缓存配置
 */
export const CACHE_CONFIG: Record<string, CacheConfig> = {
  // 用户信息
  USER_INFO: {
    key: 'user_info',
    ttl: 30 * 60 * 1000,  // 30分钟
    storage: 'localStorage',
    persistent: true
  },

  // 权限信息
  PERMISSIONS: {
    key: 'permissions',
    ttl: 60 * 60 * 1000,  // 1小时
    storage: 'localStorage',
    persistent: true
  },

  // 字典数据
  DICTIONARY: {
    key: 'dictionary',
    ttl: 24 * 60 * 60 * 1000, // 1天
    storage: 'localStorage',
    persistent: true
  },

  // 系统参数
  SYSTEM_PARAMS: {
    key: 'system_params',
    ttl: 24 * 60 * 60 * 1000, // 1天
    storage: 'localStorage',
    persistent: true
  }
}
```

---

### 3.3 缓存工具类

```typescript
// src/utils/cache.ts

import type { CacheConfig } from '@/config/cache'

class CacheManager {
  /**
   * 设置缓存
   */
  set<T>(config: CacheConfig, value: T): void {
    const cacheItem = {
      value,
      expireTime: config.ttl ? Date.now() + config.ttl : null
    }

    const cacheKey = config.key
    const cacheValue = JSON.stringify(cacheItem)

    switch (config.storage) {
      case 'localStorage':
        localStorage.setItem(cacheKey, cacheValue)
        break
      case 'sessionStorage':
        sessionStorage.setItem(cacheKey, cacheValue)
        break
      case 'memory':
        // 使用内存缓存,实际项目中可使用 Map
        break
    }
  }

  /**
   * 获取缓存
   */
  get<T>(config: CacheConfig): T | null {
    const cacheKey = config.key

    let cacheValue: string | null = null
    switch (config.storage) {
      case 'localStorage':
        cacheValue = localStorage.getItem(cacheKey)
        break
      case 'sessionStorage':
        cacheValue = sessionStorage.getItem(cacheKey)
        break
      case 'memory':
        // 从内存获取
        break
    }

    if (!cacheValue) {
      return null
    }

    const cacheItem = JSON.parse(cacheValue)

    // 检查是否过期
    if (cacheItem.expireTime && Date.now() > cacheItem.expireTime) {
      this.remove(config)
      return null
    }

    return cacheItem.value as T
  }

  /**
   * 移除缓存
   */
  remove(config: CacheConfig): void {
    const cacheKey = config.key

    switch (config.storage) {
      case 'localStorage':
        localStorage.removeItem(cacheKey)
        break
      case 'sessionStorage':
        sessionStorage.removeItem(cacheKey)
        break
      case 'memory':
        // 从内存移除
        break
    }
  }

  /**
   * 清空所有缓存
   */
  clear(): void {
    localStorage.clear()
    sessionStorage.clear()
  }
}

export const cacheManager = new CacheManager()
```

---

## 四、数据验证设计

### 4.1 表单验证规则

```typescript
// src/utils/validate.ts

import type { FormRule } from 'tdesign-vue-next'

/**
 * 常用验证规则
 */
export const VALIDATE_RULES: Record<string, FormRule[]> = {
  // 必填
  required: [{ required: true, message: '此项为必填项' }],

  // 用户名
  username: [
    { required: true, message: '请输入用户名' },
    { pattern: /^[a-zA-Z0-9_]{4,20}$/, message: '用户名长度4-20位,只能包含字母、数字、下划线' }
  ],

  // 密码
  password: [
    { required: true, message: '请输入密码' },
    { min: 6, message: '密码长度至少6位' },
    { max: 20, message: '密码长度最多20位' }
  ],

  // 手机号
  mobile: [
    { required: true, message: '请输入手机号' },
    { pattern: /^1[3-9]\d{9}$/, message: '请输入正确的手机号' }
  ],

  // 邮箱
  email: [
    { required: true, message: '请输入邮箱' },
    { type: 'email', message: '请输入正确的邮箱地址' }
  ],

  // 身份证号
  idCard: [
    { required: true, message: '请输入身份证号' },
    { pattern: /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/, message: '请输入正确的身份证号' }
  ],

  // 金额
  amount: [
    { required: true, message: '请输入金额' },
    { pattern: /^\d+(\.\d{1,2})?$/, message: '请输入正确的金额格式' }
  ],

  // 日期
  date: [
    { required: true, message: '请选择日期' }
  ],

  // 数字
  number: [
    { required: true, message: '请输入数字' },
    { type: 'number', message: '请输入有效的数字' }
  ]
}

/**
 * 自定义验证规则
 */
export const CUSTOM_VALIDATORS = {
  // 确认密码
  confirmPassword: (passwordField: string = 'password') => ({
    validator: (value: string, formData: any) => {
      if (value !== formData[passwordField]) {
        return { result: false, message: '两次密码输入不一致' }
      }
      return { result: true }
    }
  }),

  // 范围验证
  range: (min: number, max: number, message?: string) => ({
    validator: (value: number) => {
      if (value < min || value > max) {
        return { result: false, message: message || `数值必须在${min}-${max}之间` }
      }
      return { result: true }
    }
  })
}
```

---

### 4.2 数据验证 Hook

```typescript
// src/hooks/useValidation.ts

import { ref, computed } from 'vue'
import type { FormRule } from 'tdesign-vue-next'
import { VALIDATE_RULES, CUSTOM_VALIDATORS } from '@/utils/validate'

export function useValidation<T extends Record<string, any>>(formData: T) {
  const errors = ref<Record<keyof T, string>>({} as any)
  const isValid = computed(() => Object.values(errors.value).every(e => !e))

  /**
   * 验证单个字段
   */
  const validateField = (field: keyof T, rules: FormRule[]) => {
    let errorMessage = ''

    for (const rule of rules) {
      if (rule.required && !formData[field]) {
        errorMessage = rule.message as string
        break
      }

      if (rule.pattern && !rule.pattern.test(String(formData[field]))) {
        errorMessage = rule.message as string
        break
      }

      if (rule.validator) {
        const result = rule.validator(formData[field], formData)
        if (!result.result) {
          errorMessage = result.message
          break
        }
      }
    }

    errors.value[field] = errorMessage
    return !errorMessage
  }

  /**
   * 验证整个表单
   */
  const validateForm = (rules: Record<keyof T, FormRule[]>) => {
    let isAllValid = true

    Object.keys(rules).forEach(field => {
      const isValidField = validateField(field as keyof T, rules[field])
      if (!isValidField) {
        isAllValid = false
      }
    })

    return isAllValid
  }

  /**
   * 清除验证错误
   */
  const clearErrors = () => {
    errors.value = {} as any
  }

  return {
    errors,
    isValid,
    validateField,
    validateForm,
    clearErrors
  }
}
```

---

**文档版本**: v1.0
**更新日期**: 2026-02-19
