# QooERP 工作流引擎模块 - 应用设计文档

> 模块名称: qooerp-workflow  
> 模块版本: v1.0  
> 创建日期: 2026-02-17  
> 作者: Auto  

---

## 一、应用架构

### 1.1 分层架构

```
Presentation Layer (Controller)
Business Layer (Service, Domain)
Data Access Layer (Mapper, Entity)
Infrastructure Layer (Database, Cache)
```

### 1.2 核心模块

| 模块 | 说明 |
|------|------|
| definition | 流程定义管理 |
| instance | 流程实例管理 |
| task | 任务管理 |
| monitor | 流程监控 |

---

## 二、核心类设计

### 2.1 WorkflowDefinition Service

```java
public interface WorkflowDefinitionService {
    WorkflowDefinitionDTO createDefinition(WorkflowDefinitionDTO dto);
    void deployDefinition(Long definitionId);
    WorkflowDefinitionDTO getDefinition(String processDefinitionId);
    void suspendDefinition(String processDefinitionId);
    void activateDefinition(String processDefinitionId);
}
```

### 2.2 WorkflowInstance Service

```java
public interface WorkflowInstanceService {
    WorkflowInstanceDTO startInstance(String processDefinitionId, 
        Map<String, Object> variables);
    WorkflowInstanceDTO getInstance(String instanceId);
    void cancelInstance(String instanceId);
    void suspendInstance(String instanceId);
    void activateInstance(String instanceId);
}
```

### 2.3 WorkflowTask Service

```java
public interface WorkflowTaskService {
    List<WorkflowTaskDTO> getTodoTasks(String userId);
    List<WorkflowTaskDTO> getDoneTasks(String userId);
    void completeTask(String taskId, 
        Map<String, Object> variables);
    void rejectTask(String taskId, String comment);
    void delegateTask(String taskId, String userId);
    void transferTask(String taskId, String userId);
}
```

---

## 三、接口设计

### 3.1 Controller

```java
@RestController
@RequestMapping("/api/workflow/definitions")
public class WorkflowDefinitionController {
    @PostMapping
    public Result<WorkflowDefinitionDTO> createDefinition(
        @RequestBody WorkflowDefinitionDTO dto);
    
    @PostMapping("/{id}/deploy")
    public Result<Void> deployDefinition(@PathVariable Long id);
    
    @GetMapping
    public Result<Page<WorkflowDefinitionDTO>> listDefinitions();
}

@RestController
@RequestMapping("/api/workflow/tasks")
public class WorkflowTaskController {
    @GetMapping("/todo")
    public Result<List<WorkflowTaskDTO>> getTodoTasks();
    
    @PostMapping("/{id}/complete")
    public Result<Void> completeTask(@PathVariable String id,
        @RequestBody TaskCompleteDTO dto);
    
    @PostMapping("/{id}/reject")
    public Result<Void> rejectTask(@PathVariable String id,
        @RequestBody TaskRejectDTO dto);
}
```

---

## 四、配置设计

```yaml
spring:
  application:
    name: qooerp-workflow
  datasource:
    url: jdbc:postgresql://localhost:5432/qooerp_workflow

flowable:
  database-schema-update: true
  async-executor-activate: true
```

---

**文档版本**: v1.0  
**最后更新**: 2026-02-17
