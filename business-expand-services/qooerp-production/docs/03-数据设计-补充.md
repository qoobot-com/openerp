# QooERP 生产管理模块 - 数据设计补充文档

> 模块名称: qooerp-production  
> 模块版本: v1.0  
> 创建日期: 20xx-xx-xx  
> 作者: Auto

---

## 一、补充说明

经过对生产管理模块设计文档的全面审查，发现以下功能需要补充：

1. **工序列表管理** - 生产订单中的工序信息需要单独管理
2. **设备管理** - 生产设备与生产订单的关联
3. **生产排程** - 生产计划的排程管理
4. **生产报废管理** - 生产过程中的报废记录
5. **生产返工管理** - 质检不合格后的返工流程

---

## 二、补充表设计

### 2.1 production_process（工序列表表）

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | BIGINT | 20 | NO | | 主键 |
| process_no | VARCHAR | 50 | NO | | 工序编号 |
| process_name | VARCHAR | 100 | NO | | 工序名称 |
| process_code | VARCHAR | 50 | NO | | 工序代码 |
| product_id | BIGINT | 20 | YES | | 产品ID |
| sequence | INT | 11 | NO | 0 | 工序顺序 |
| standard_hours | DECIMAL | 10,2 | YES | | 标准工时(小时) |
| status | TINYINT | 4 | NO | 1 | 状态(0-禁用,1-启用) |
| remark | VARCHAR | 500 | YES | | 备注 |
| tenant_id | BIGINT | 20 | NO | | 租户ID |
| create_time | DATETIME | | NO | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | | NO | CURRENT_TIMESTAMP | 更新时间 |
| create_by | VARCHAR | 50 | YES | | 创建人 |
| update_by | VARCHAR | 50 | YES | | 更新人 |
| deleted | TINYINT | 1 | NO | 0 | 删除标记(0-未删除,1-已删除) |

**索引:**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_process_no` (`process_no`, `tenant_id`, `deleted`)
- KEY `idx_product_id` (`product_id`)
- KEY `idx_sequence` (`sequence`)

---

### 2.2 production_equipment（生产设备表）

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | BIGINT | 20 | NO | | 主键 |
| equipment_no | VARCHAR | 50 | NO | | 设备编号 |
| equipment_name | VARCHAR | 100 | NO | | 设备名称 |
| equipment_type | VARCHAR | 50 | YES | | 设备类型 |
| model | VARCHAR | 50 | YES | | 规格型号 |
| workshop_id | BIGINT | 20 | YES | | 车间ID |
| workshop_name | VARCHAR | 100 | YES | | 车间名称 |
| capacity | DECIMAL | 18,4 | YES | | 产能 |
| status | TINYINT | 4 | NO | 1 | 状态(0-停用,1-正常,2-维修中) |
| purchase_date | DATE | | YES | | 购买日期 |
| remark | VARCHAR | 500 | YES | | 备注 |
| tenant_id | BIGINT | 20 | NO | | 租户ID |
| create_time | DATETIME | | NO | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | | NO | CURRENT_TIMESTAMP | 更新时间 |
| create_by | VARCHAR | 50 | YES | | 创建人 |
| update_by | VARCHAR | 50 | YES | | 更新人 |
| deleted | TINYINT | 1 | NO | 0 | 删除标记(0-未删除,1-已删除) |

**索引:**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_equipment_no` (`equipment_no`, `tenant_id`, `deleted`)
- KEY `idx_workshop_id` (`workshop_id`)
- KEY `idx_status` (`status`)

---

### 2.3 production_schedule（生产排程表）

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | BIGINT | 20 | NO | | 主键 |
| schedule_no | VARCHAR | 50 | NO | | 排程编号 |
| order_id | BIGINT | 20 | NO | | 订单ID |
| order_no | VARCHAR | 50 | NO | | 订单编号 |
| process_id | BIGINT | 20 | YES | | 工序ID |
| process_name | VARCHAR | 100 | YES | | 工序名称 |
| equipment_id | BIGINT | 20 | YES | | 设备ID |
| equipment_name | VARCHAR | 100 | YES | | 设备名称 |
| worker_id | BIGINT | 20 | YES | | 工人ID |
| worker_name | VARCHAR | 50 | YES | | 工人姓名 |
| plan_start_time | DATETIME | | NO | | 计划开始时间 |
| plan_end_time | DATETIME | | NO | | 计划结束时间 |
| actual_start_time | DATETIME | | YES | | 实际开始时间 |
| actual_end_time | DATETIME | | YES | | 实际结束时间 |
| plan_quantity | DECIMAL | 18,4 | NO | | 计划数量 |
| actual_quantity | DECIMAL | 18,4 | NO | 0 | 实际数量 |
| status | TINYINT | 4 | NO | 0 | 状态(0-未开始,1-进行中,2-已完成,3-已取消) |
| remark | VARCHAR | 500 | YES | | 备注 |
| tenant_id | BIGINT | 20 | NO | | 租户ID |
| create_time | DATETIME | | NO | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | | NO | CURRENT_TIMESTAMP | 更新时间 |
| create_by | VARCHAR | 50 | YES | | 创建人 |
| update_by | VARCHAR | 50 | YES | | 更新人 |
| deleted | TINYINT | 1 | NO | 0 | 删除标记(0-未删除,1-已删除) |

**索引:**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_schedule_no` (`schedule_no`, `tenant_id`, `deleted`)
- KEY `idx_order_id` (`order_id`)
- KEY `idx_equipment_id` (`equipment_id`)
- KEY `idx_worker_id` (`worker_id`)
- KEY `idx_plan_start_time` (`plan_start_time`)

---

### 2.4 production_scrap（生产报废表）

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | BIGINT | 20 | NO | | 主键 |
| scrap_no | VARCHAR | 50 | NO | | 报废单号 |
| order_id | BIGINT | 20 | NO | | 订单ID |
| order_no | VARCHAR | 50 | NO | | 订单编号 |
| product_id | BIGINT | 20 | NO | | 产品ID |
| product_code | VARCHAR | 50 | NO | | 产品编码 |
| product_name | VARCHAR | 200 | NO | | 产品名称 |
| scrap_quantity | DECIMAL | 18,4 | NO | | 报废数量 |
| scrap_reason | VARCHAR | 500 | YES | | 报废原因 |
| scrap_date | DATE | | NO | | 报废日期 |
| scrap_cost | DECIMAL | 18,4 | NO | 0 | 报废成本 |
| approver_id | BIGINT | 20 | YES | | 审批人ID |
| approver_name | VARCHAR | 50 | YES | | 审批人姓名 |
| approve_time | DATETIME | | YES | | 审批时间 |
| status | TINYINT | 4 | NO | 0 | 状态(0-待审批,1-已审批,2-已拒绝) |
| remark | VARCHAR | 500 | YES | | 备注 |
| tenant_id | BIGINT | 20 | NO | | 租户ID |
| create_time | DATETIME | | NO | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | | NO | CURRENT_TIMESTAMP | 更新时间 |
| create_by | VARCHAR | 50 | YES | | 创建人 |
| update_by | VARCHAR | 50 | YES | | 更新人 |
| deleted | TINYINT | 1 | NO | 0 | 删除标记(0-未删除,1-已删除) |

**索引:**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_scrap_no` (`scrap_no`, `tenant_id`, `deleted`)
- KEY `idx_order_id` (`order_id`)
- KEY `idx_scrap_date` (`scrap_date`)
- KEY `idx_status` (`status`)

---

### 2.5 production_rework（生产返工表）

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | BIGINT | 20 | NO | | 主键 |
| rework_no | VARCHAR | 50 | NO | | 返工单号 |
| order_id | BIGINT | 20 | NO | | 订单ID |
| order_no | VARCHAR | 50 | NO | | 订单编号 |
| quality_id | BIGINT | 20 | YES | | 质检单ID |
| quality_no | VARCHAR | 50 | YES | | 质检单号 |
| product_id | BIGINT | 20 | NO | | 产品ID |
| product_code | VARCHAR | 50 | NO | | 产品编码 |
| product_name | VARCHAR | 200 | NO | | 产品名称 |
| rework_quantity | DECIMAL | 18,4 | NO | | 返工数量 |
| defect_description | VARCHAR | 500 | YES | | 缺陷描述 |
| rework_reason | VARCHAR | 500 | YES | | 返工原因 |
| rework_date | DATE | | NO | | 返工日期 |
| rework_hours | DECIMAL | 10,2 | NO | 0 | 返工工时 |
| rework_cost | DECIMAL | 18,4 | NO | 0 | 返工成本 |
| qualified_quantity | DECIMAL | 18,4 | NO | | 返工后合格数量 |
| status | TINYINT | 4 | NO | 0 | 状态(0-待返工,1-返工中,2-已完成) |
| remark | VARCHAR | 500 | YES | | 备注 |
| tenant_id | BIGINT | 20 | NO | | 租户ID |
| create_time | DATETIME | | NO | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | | NO | CURRENT_TIMESTAMP | 更新时间 |
| create_by | VARCHAR | 50 | YES | | 创建人 |
| update_by | VARCHAR | 50 | YES | | 更新人 |
| deleted | TINYINT | 1 | NO | 0 | 删除标记(0-未删除,1-已删除) |

**索引:**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_rework_no` (`rework_no`, `tenant_id`, `deleted`)
- KEY `idx_order_id` (`order_id`)
- KEY `idx_quality_id` (`quality_id`)
- KEY `idx_rework_date` (`rework_date`)
- KEY `idx_status` (`status`)

---

## 三、补充数据字典

### 3.1 工序状态 (production_process.status)

| 值 | 说明 |
|----|------|
| 0 | 禁用 |
| 1 | 启用 |

### 3.2 设备状态 (production_equipment.status)

| 值 | 说明 |
|----|------|
| 0 | 停用 |
| 1 | 正常 |
| 2 | 维修中 |

### 3.3 排程状态 (production_schedule.status)

| 值 | 说明 |
|----|------|
| 0 | 未开始 |
| 1 | 进行中 |
| 2 | 已完成 |
| 3 | 已取消 |

### 3.4 报废状态 (production_scrap.status)

| 值 | 说明 |
|----|------|
| 0 | 待审批 |
| 1 | 已审批 |
| 2 | 已拒绝 |

### 3.5 返工状态 (production_rework.status)

| 值 | 说明 |
|----|------|
| 0 | 待返工 |
| 1 | 返工中 |
| 2 | 已完成 |

---

## 四、补充ER图

```
production_order (生产订单)
    │
    ├── production_schedule (生产排程) [1:N]
    │       │
    │       ├── production_process (工序列表) [N:1]
    │       ├── production_equipment (生产设备) [N:1]
    │       └── user (工人) [N:1]
    │
    ├── production_scrap (生产报废) [1:N]
    │
    └── production_rework (生产返工) [1:N]
            │
            └── production_quality (生产质检) [N:1]

production_process (工序列表)
    │
    └── production_bom (物料清单) [N:1]

production_equipment (生产设备)
    │
    └── production_organization (组织-车间) [N:1]
```

---

## 五、补充业务规则

### 5.1 工序管理规则

- 工序必须设置顺序号
- 同一产品的工序顺序不能重复
- 标准工时用于生产排程计算

### 5.2 设备管理规则

- 设备状态影响排程分配
- 维修中的设备不能安排生产
- 产能用于排程负载计算

### 5.3 排程管理规则

- 排程必须关联生产订单
- 排程时间段不能冲突
- 设备和工人资源需要可用

### 5.4 报废管理规则

- 报废数量不能超过订单数量
- 报废需要经过审批
- 报废影响生产订单完成率

### 5.5 返工管理规则

- 返工必须关联质检记录
- 返工完成后需要重新质检
- 返工工时计入生产成本

---

**文档版本**: v1.0  
**最后更新**: 20xx-xx-xx
