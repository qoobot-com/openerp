# QooERP 项目管理模块 - 测试计划

> 版本：v1.0
> 创建日期：2026-02-18
> 最后更新：2026-02-18
> 模块状态：🚧 规划中

---

## 一、测试概述

本文档定义了 qooerp-project 项目管理模块的测试策略、测试范围、测试用例和测试目标。

---

## 二、测试目标

| 测试类型 | 目标指标 | 说明 |
|---------|---------|------|
| 单元测试 | 代码覆盖率 ≥ 80% | 覆盖核心业务逻辑 |
| 集成测试 | API接口覆盖率 100% | 所有RESTful接口 |
| 性能测试 | 响应时间 < 500ms (P95) | 核心接口性能要求 |
| 并发测试 | 支持100并发 | 项目查询、任务创建 |

---

## 三、测试范围

### 3.1 单元测试范围

| 模块 | 测试类 | 测试用例数 |
|------|--------|-----------|
| 项目管理 | ProjectServiceTest | 15 |
| 任务管理 | ProjectTaskServiceTest | 20 |
| 里程碑管理 | ProjectMilestoneServiceTest | 12 |
| 成员管理 | ProjectMemberServiceTest | 10 |
| 报表管理 | ProjectReportServiceTest | 8 |
| 评论管理 | ProjectCommentServiceTest | 8 |
| 附件管理 | ProjectAttachmentServiceTest | 8 |
| 风险管理 | ProjectRiskServiceTest | 6 |
| 工时管理 | ProjectTimeLogServiceTest | 6 |
| **合计** | **9** | **93** |

### 3.2 集成测试范围

| 接口分类 | 接口数量 | 测试点 |
|---------|---------|--------|
| 项目管理接口 | 8 | CRUD、审批、关闭、进度、成员 |
| 任务管理接口 | 9 | CRUD、分配、完成、依赖 |
| 里程碑管理接口 | 6 | CRUD、完成确认 |
| 报表管理接口 | 4 | 进度、成本、资源、统计 |
| 评论管理接口 | 4 | CRUD、@提及 |
| 附件管理接口 | 4 | 上传、下载、删除 |
| 风险管理接口 | 3 | CRUD、评估 |
| 工时管理接口 | 3 | CRUD、统计 |
| **合计** | **41** | - |

---

## 四、单元测试计划

### 4.1 项目管理单元测试

```java
@SpringBootTest
class ProjectServiceTest {

    @Autowired
    private IProjectService projectService;

    @Test
    void testCreateProject() {
        // 测试项目创建
        ProjectDTO dto = new ProjectDTO();
        dto.setProjectName("测试项目");
        dto.setStartDate(LocalDate.now());
        dto.setEndDate(LocalDate.now().plusDays(30));

        ProjectDTO result = projectService.createProject(dto);
        assertNotNull(result);
        assertNotNull(result.getId());
        assertEquals("测试项目", result.getProjectName());
    }

    @Test
    void testUpdateProject() {
        // 测试项目更新
    }

    @Test
    void testApproveProject() {
        // 测试项目审批
    }

    @Test
    void testCloseProject() {
        // 测试项目关闭
    }

    @Test
    void testGetProjectProgress() {
        // 测试项目进度计算
    }

    @Test
    void testCalculateProgress_ZeroTasks() {
        // 测试零任务场景
    }

    @Test
    void testCalculateProgress_AllCompleted() {
        // 测试全部完成场景
    }

    @Test
    void testListProjects() {
        // 测试分页查询
    }

    @Test
    void testGetProjectById() {
        // 测试获取详情
    }

    @Test
    void testDeleteProject() {
        // 测试删除项目
    }

    @Test
    void testValidateProjectDate() {
        // 测试日期校验
    }

    @Test
    void testApproveDraftProject() {
        // 测试草稿状态项目审批
    }

    @Test
    void testCloseRunningProject() {
        // 测试进行中项目关闭
    }

    @Test
    void testEditClosedProject() {
        // 测试编辑已关闭项目（应该失败）
    }
}
```

### 4.2 任务管理单元测试

```java
@SpringBootTest
class ProjectTaskServiceTest {

    @Autowired
    private IProjectTaskService taskService;

    @Autowired
    private IProjectService projectService;

    @Test
    void testCreateTask() {
        // 测试任务创建
    }

    @Test
    void testUpdateTask() {
        // 测试任务更新
    }

    @Test
    void testAssignTask() {
        // 测试任务分配
    }

    @Test
    void testCompleteTask() {
        // 测试任务完成
    }

    @Test
    void testStartTask() {
        // 测试开始任务
    }

    @Test
    void testAddTaskDependency() {
        // 测试添加任务依赖
    }

    @Test
    void testValidateDependency_Circular() {
        // 测试循环依赖（应该失败）
    }

    @Test
    void testGetProjectTasks() {
        // 测试获取项目任务列表
    }

    @Test
    void testGetTaskById() {
        // 测试获取任务详情
    }

    @Test
    void testDeleteTask() {
        // 测试删除任务
    }

    @Test
    void testAssignTask_InvalidUser() {
        // 测试分配给非项目成员（应该失败）
    }

    @Test
    void testCompleteTask_BlockedByDependency() {
        // 测试依赖未完成时完成任务（应该失败）
    }

    @Test
    void testUpdateTaskPriority() {
        // 测试更新任务优先级
    }

    @Test
    void testUpdateTaskStatus() {
        // 测试更新任务状态
    }

    @Test
    void testGetTasksByAssignee() {
        // 测试按负责人查询任务
    }

    @Test
    void testGetTasksByStatus() {
        // 测试按状态查询任务
    }

    @Test
    void testGetTasksByPriority() {
        // 测试按优先级查询任务
    }

    @Test
    void testGetHighPriorityTasks() {
        // 测试查询高优先级任务
    }

    @Test
    void testGetOverdueTasks() {
        // 测试查询逾期任务
    }

    @Test
    void testGetBlockedTasks() {
        // 测试查询阻塞任务
    }
}
```

### 4.3 里程碑管理单元测试

```java
@SpringBootTest
class ProjectMilestoneServiceTest {

    @Autowired
    private IProjectMilestoneService milestoneService;

    @Test
    void testCreateMilestone() {
        // 测试创建里程碑
    }

    @Test
    void testUpdateMilestone() {
        // 测试更新里程碑
    }

    @Test
    void testCompleteMilestone() {
        // 测试完成里程碑
    }

    @Test
    void testGetProjectMilestones() {
        // 测试获取项目里程碑
    }

    @Test
    void testGetMilestoneById() {
        // 测试获取里程碑详情
    }

    @Test
    void testDeleteMilestone() {
        // 测试删除里程碑
    }

    @Test
    void testCompleteMilestone_ValidateTasks() {
        // 测试验证关联任务是否完成
    }

    @Test
    void testGetMilestonesByStatus() {
        // 测试按状态查询里程碑
    }

    @Test
    void testGetUpcomingMilestones() {
        // 测试查询即将到来的里程碑
    }

    @Test
    void testGetOverdueMilestones() {
        // 测试查询逾期里程碑
    }

    @Test
    void testGetCompletedMilestones() {
        // 测试查询已完成的里程碑
    }

    @Test
    void testGetMilestoneProgress() {
        // 测试获取里程碑进度
    }

    @Test
    void testValidateMilestoneDate() {
        // 测试验证里程碑日期
    }
}
```

### 4.4 成员管理单元测试

```java
@SpringBootTest
class ProjectMemberServiceTest {

    @Autowired
    private IProjectMemberService memberService;

    @Autowired
    private IProjectService projectService;

    @Test
    void testAddMember() {
        // 测试添加成员
    }

    @Test
    void testRemoveMember() {
        // 测试移除成员
    }

    @Test
    void testUpdateMemberRole() {
        // 测试更新成员角色
    }

    @Test
    void testGetProjectMembers() {
        // 测试获取项目成员
    }

    @Test
    void testGetMemberRole() {
        // 测试获取成员角色
    }

    @Test
    void testValidateMemberPermission() {
        // 测试验证成员权限
    }

    @Test
    void testAddMember_Duplicate() {
        // 测试添加重复成员（应该失败）
    }

    @Test
    void testRemoveManager() {
        // 测试移除项目经理（应该失败）
    }

    @Test
    void testGetMembersByRole() {
        // 测试按角色查询成员
    }

    @Test
    void testGetUserProjects() {
        // 测试获取用户参与的项目
    }
}
```

### 4.5 报表管理单元测试

```java
@SpringBootTest
class ProjectReportServiceTest {

    @Autowired
    private IProjectReportService reportService;

    @Test
    void testGenerateProgressReport() {
        // 测试生成进度报表
    }

    @Test
    void testGenerateCostReport() {
        // 测试生成成本报表
    }

    @Test
    void testGenerateResourceReport() {
        // 测试生成资源报表
    }

    @Test
    void testGenerateStatistics() {
        // 测试生成统计分析
    }

    @Test
    void testCalculateProjectProgress() {
        // 测试计算项目进度
    }

    @Test
    void testCalculateProjectCost() {
        // 测试计算项目成本
    }

    @Test
    void testCalculateResourceUsage() {
        // 测试计算资源使用率
    }

    @Test
    void testGetProjectSummary() {
        // 测试获取项目摘要
    }
}
```

---

## 五、集成测试计划

### 5.1 API接口测试

使用 Postman/Apifox 进行API接口测试。

#### 项目管理接口测试

```yaml
# 测试用例1: 创建项目
name: 创建项目
method: POST
url: /api/project/projects
body:
  projectName: "测试项目20260218"
  startDate: "2026-02-18"
  endDate: "2026-03-18"
  managerId: 1
  managerName: "张三"
  description: "这是一个测试项目"
assert:
  status: 200
  body.projectName: "测试项目20260218"
  body.status: 0

# 测试用例2: 审批项目
name: 审批项目
method: POST
url: /api/project/projects/{id}/approve
assert:
  status: 200

# 测试用例3: 查询项目列表
name: 查询项目列表
method: GET
url: /api/project/projects?page=1&size=10
assert:
  status: 200
  body.records: array
```

#### 任务管理接口测试

```yaml
# 测试用例1: 创建任务
name: 创建任务
method: POST
url: /api/project/tasks
body:
  projectId: 1
  taskName: "开发用户管理模块"
  priority: 3
  startDate: "2026-02-18"
  endDate: "2026-02-28"
assert:
  status: 200

# 测试用例2: 分配任务
name: 分配任务
method: POST
url: /api/project/tasks/{id}/assign
body:
  assigneeId: 2
  assigneeName: "李四"
assert:
  status: 200

# 测试用例3: 完成任务
name: 完成任务
method: POST
url: /api/project/tasks/{id}/complete
assert:
  status: 200
```

#### 里程碑管理接口测试

```yaml
# 测试用例1: 创建里程碑
name: 创建里程碑
method: POST
url: /api/project/milestones
body:
  projectId: 1
  milestoneName: "第一阶段完成"
  targetDate: "2026-02-28"
assert:
  status: 200

# 测试用例2: 完成里程碑
name: 完成里程碑
method: POST
url: /api/project/milestones/{id}/complete
assert:
  status: 200
```

### 5.2 端到端业务流程测试

#### 测试场景1：完整项目流程

```
1. 创建项目
2. 添加项目成员（项目经理、开发人员）
3. 创建里程碑
4. 创建多个任务
5. 分配任务给成员
6. 成员开始并完成任务
7. 里程碑达成确认
8. 查看项目进度报表
9. 关闭项目
```

#### 测试场景2：任务依赖流程

```
1. 创建项目
2. 创建任务A（前置任务）
3. 创建任务B（依赖任务A）
4. 尝试完成任务B（应该失败，因为任务A未完成）
5. 完成任务A
6. 完成任务B（应该成功）
```

#### 测试场景3：权限验证流程

```
1. 创建项目，指定项目经理
2. 添加开发人员
3. 开发人员尝试修改项目信息（应该失败）
4. 开发人员创建任务（应该成功）
5. 观察者尝试删除任务（应该失败）
```

### 5.3 数据一致性测试

| 测试场景 | 验证点 |
|---------|--------|
| 删除项目 | 关联的任务、里程碑应被标记为删除状态 |
| 删除任务 | 关联的依赖关系应被清理 |
| 删除成员 | 该成员的任务应重新分配 |
| 完成任务 | 项目进度应自动更新 |
| 完成里程碑 | 项目里程碑状态应更新 |

---

## 六、性能测试计划

### 6.1 性能指标

| 接口 | 目标响应时间 | 目标并发数 | 测试工具 |
|------|-------------|-----------|---------|
| GET /projects | < 300ms (P95) | 100 | JMeter |
| POST /projects | < 500ms (P95) | 50 | JMeter |
| GET /tasks | < 300ms (P95) | 100 | JMeter |
| POST /tasks | < 500ms (P95) | 50 | JMeter |
| GET /reports/progress | < 1s (P95) | 50 | JMeter |

### 6.2 压力测试场景

```xml
<!-- JMeter测试计划示例 -->
<ThreadGroup>
  <stringProp name="ThreadGroup.num_threads">100</stringProp>
  <stringProp name="ThreadGroup.ramp_time">10</stringProp>
  <LoopController>
    <stringProp name="LoopController.loops">1000</stringProp>
  </LoopController>
</ThreadGroup>
```

### 6.3 性能优化检查点

- [ ] 数据库查询优化（添加索引）
- [ ] 慢查询分析（> 1s）
- [ ] 缓存策略（Redis）
- [ ] 分页查询性能
- [ ] 关联查询优化（N+1问题）
- [ ] 批量操作优化

---

## 七、测试工具和环境

### 7.1 测试工具

| 工具 | 用途 | 版本 |
|------|------|------|
| JUnit 5 | 单元测试框架 | 5.10+ |
| Mockito | Mock框架 | 5.x |
| Spring Boot Test | 集成测试支持 | 3.3.x |
| Postman | API测试 | 最新版 |
| JMeter | 性能测试 | 5.6+ |
| Testcontainers | 集成测试数据库 | 1.19+ |

### 7.2 测试环境

| 环境 | 数据库 | Redis | 用途 |
|------|--------|-------|------|
| 开发环境 | PostgreSQL 15 | Redis 7 | 开发调试 |
| 测试环境 | PostgreSQL 15 | Redis 7 | 功能测试 |
| 性能测试环境 | PostgreSQL 15 | Redis 7 | 性能测试 |

---

## 八、测试执行计划

### 8.1 测试时间安排

| 测试阶段 | 时间 | 产出 |
|---------|------|------|
| 单元测试（Day 10-11） | 2天 | 单元测试报告 |
| 集成测试（Day 12） | 1天 | API测试报告 |
| 性能测试（Day 13） | 0.5天 | 性能测试报告 |

### 8.2 测试验收标准

| 测试类型 | 验收标准 |
|---------|---------|
| 单元测试 | 代码覆盖率 ≥ 80%，所有测试通过 |
| 集成测试 | API接口覆盖率 100%，所有测试通过 |
| 性能测试 | 核心接口响应时间达标，无内存泄漏 |

---

## 九、缺陷管理

### 9.1 缺陷等级

| 等级 | 说明 | 修复优先级 |
|------|------|-----------|
| P0 | 阻塞性缺陷，影响核心功能 | 立即修复 |
| P1 | 严重缺陷，影响重要功能 | 1天内修复 |
| P2 | 一般缺陷，不影响核心功能 | 3天内修复 |
| P3 | 轻微缺陷，建议性改进 | 下个版本修复 |

### 9.2 缺陷跟踪

使用 Jira 或 Git Issues 跟踪缺陷，记录：
- 缺陷描述
- 重现步骤
- 预期结果
- 实际结果
- 优先级
- 负责人
- 修复状态

---

## 十、测试报告

### 10.1 测试报告内容

1. **测试概览**
   - 测试范围
   - 测试时间
   - 测试人员

2. **测试结果**
   - 用例总数
   - 通过数
   - 失败数
   - 通过率

3. **代码覆盖率**
   - 按模块统计
   - 按类统计
   - 覆盖率报表

4. **缺陷列表**
   - 缺陷总数
   - 按等级分类
   - 修复状态

5. **性能测试结果**
   - 响应时间
   - 吞吐量
   - 资源使用

6. **测试结论**
   - 是否达到发布标准
   - 遗留问题
   - 建议

---

## 十一、总结

本测试计划覆盖了 qooerp-project 项目管理模块的单元测试、集成测试和性能测试，确保模块质量和性能达到预期目标。

---

*文档维护：请保持此文档的及时更新，确保测试信息的准确性*
