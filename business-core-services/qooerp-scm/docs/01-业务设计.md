# QooERP 供应链管理 - 业务设计文档

> 版本：v2.0
> 创建日期：2026-02-17
> 更新日期：2026-02-18
> 服务名称：qooerp-scm
> 优先级：P1-B（核心业务）
> 端口：8088
> **数据库**: PostgreSQL 15+

---

## 一、概述

### 1.1 服务定位

供应链管理（Supply Chain Management, SCM）是 QooERP 的核心业务模块之一，负责**供应商管理、物流管理、供应商报价管理、对账结算**等供应链核心业务。

### 1.2 核心能力

| 能力模块 | 功能描述 |
|---------|---------|
| 供应商管理 | 供应商档案、供应商评估、供应商信用、供应商查询 |
| 供应商报价 | 供应商报价单、报价审批、报价对比、报价转采购 |
| 物流管理 | 物流跟踪、物流费用、物流单管理、物流轨迹查询 |
| 供应商对账 | 供应商对账单、对账审核、对账结算、对账统计 |

### 1.3 业务目标

1. 建立完善的供应商管理体系，实现供应商全生命周期管理
2. 建立科学的供应商评估体系，提升供应商质量
3. 建立高效的物流跟踪体系，实现物流全程可视化
4. 建立规范的供应商报价体系，优化采购成本
5. 建立准确的供应商对账体系，确保账务准确

---

## 二、模块边界划分

### 2.1 与其他模块的关系

```
供应链管理（SCM）
├── 供应商管理（SCM独有）
│   ├── 供应商档案
│   ├── 供应商评估
│   └── 供应商信用
├── 供应商报价（SCM独有）
│   ├── 报价单创建
│   ├── 报价审批
│   └── 报价转采购
├── 物流管理（SCM独有）
│   ├── 物流单管理
│   └── 物流跟踪
└── 供应商对账（SCM独有）
    ├── 对账单创建
    └── 对账结算
```

### 2.2 模块功能矩阵

| 功能 | SCM | Purchase | Sales | CRM | Inventory | Finance | 说明 |
|------|-----|----------|-------|-----|-----------|---------|------|
| 供应商档案 | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | SCM专属 |
| 供应商评估 | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | SCM专属 |
| 供应商信用 | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | SCM专属 |
| 供应商报价 | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | SCM专属 |
| 采购订单 | ❌ | ✅ | ❌ | ❌ | ❌ | ❌ | Purchase专属 |
| 采购入库 | ❌ | ✅ | ❌ | ❌ | ❌ | ❌ | Purchase专属 |
| 采购退货 | ❌ | ✅ | ❌ | ❌ | ❌ | ❌ | Purchase专属 |
| 客户档案 | ❌ | ❌ | ❌ | ✅ | ❌ | ❌ | CRM专属 |
| 客户商机 | ❌ | ❌ | ❌ | ✅ | ❌ | ❌ | CRM专属 |
| 客户合同 | ❌ | ❌ | ❌ | ✅ | ❌ | ❌ | CRM专属 |
| 客户分级 | ❌ | ❌ | ❌ | ✅ | ❌ | ❌ | CRM专属 |
| 销售报价 | ❌ | ❌ | ✅ | ❌ | ❌ | ❌ | Sales专属 |
| 销售合同 | ❌ | ❌ | ✅ | ❌ | ❌ | ❌ | Sales专属 |
| 销售订单 | ❌ | ❌ | ✅ | ❌ | ❌ | ❌ | Sales专属 |
| 销售发货 | ❌ | ❌ | ✅ | ❌ | ❌ | ❌ | Sales专属 |
| 销售退货 | ❌ | ❌ | ✅ | ❌ | ❌ | ❌ | Sales专属 |
| 物流跟踪（供应商） | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | SCM负责 |
| 物流跟踪（客户） | ❌ | ❌ | ✅ | ❌ | ❌ | ❌ | Sales负责 |
| 库存管理 | ❌ | ❌ | ❌ | ❌ | ✅ | ❌ | Inventory专属 |
| 财务对账（供应商） | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | SCM负责业务对账 |
| 财务对账（客户） | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | Finance负责财务对账 |

### 2.3 跨模块协作流程

```
供应商报价 → 采购订单（Purchase）
采购订单 → 采购入库（Inventory）→ 供应商对账（SCM）
销售订单（Sales）→ 销售发货（Sales）→ 客户物流跟踪（Sales）
供应商对账（SCM）→ 应付账款（Finance）
```

---

## 三、核心实体

### 3.1 供应商（ScmSupplier）

供应商实体是供应链管理的核心实体之一，包含以下信息：

```
ScmSupplier（供应商）
├── 基本信息
│   ├── 供应商编码（唯一标识）
│   ├── 供应商名称
│   ├── 供应商类型（制造商/分销商/零售商）
│   ├── 所属行业
│   └── 企业规模（大型/中型/小型）
├── 联系方式
│   ├── 联系人
│   ├── 联系电话
│   ├── 联系邮箱
│   └── 联系地址
├── 财务信息
│   ├── 税号
│   ├── 开户银行
│   ├── 银行账号
│   ├── 信用等级（A/B/C/D）
│   ├── 信用额度
│   ├── 结算方式（现金/信用/月结/季结）
│   └── 付款期限（天）
├── 评估信息
│   ├── 评估总分
│   ├── 质量评分
│   ├── 交付评分
│   ├── 服务评分
│   └── 价格评分
└── 状态信息
    ├── 状态（启用/停用/禁用）
    └── 备注
```

### 3.2 供应商评估（ScmSupplierEvaluation）

```
ScmSupplierEvaluation（供应商评估）
├── 评估信息
│   ├── 供应商ID
│   ├── 供应商编码
│   ├── 评估日期
│   └── 评估人
├── 评分信息
│   ├── 质量评分（0-100）
│   ├── 交付评分（0-100）
│   ├── 服务评分（0-100）
│   ├── 价格评分（0-100）
│   └── 综合评分（0-100）
└── 评估结果
    ├── 信用等级（A/B/C/D）
    └── 评估意见
```

### 3.3 供应商报价（ScmSupplierQuotation）

```
ScmSupplierQuotation（供应商报价单）
├── 基本信息
│   ├── 报价单号（唯一标识）
│   ├── 供应商ID
│   ├── 供应商名称
│   ├── 报价日期
│   ├── 报价有效期
│   └── 报价类型（正常报价/紧急报价）
├── 报价明细
│   ├── 物料编码
│   ├── 物料名称
│   ├── 规格型号
│   ├── 单位
│   ├── 数量
│   ├── 单价
│   ├── 金额
│   ├── 交货期（天）
│   └── 备注
├── 审核信息
│   ├── 审核状态（待审核/已通过/已拒绝）
│   ├── 审核人
│   ├── 审核时间
│   └── 审核意见
└── 转采购信息
    ├── 是否转采购订单
    ├── 采购订单号
    └── 转换时间
```

### 3.4 物流（ScmLogistics）

```
ScmLogistics（物流）
├── 物流信息
│   ├── 物流单号（唯一标识）
│   ├── 业务类型（采购/销售）
│   ├── 关联单据ID
│   ├── 关联单据号
│   ├── 物流公司
│   └── 物流单号（快递单号）
├── 发货信息
│   ├── 发货人
│   ├── 发货人电话
│   └── 发货地址
├── 收货信息
│   ├── 收货人
│   ├── 收货人电话
│   └── 收货地址
├── 时间信息
│   ├── 发货日期
│   ├── 预计到达日期
│   └── 实际到达日期
├── 费用信息
│   └── 物流费用
└── 状态信息
    ├── 物流状态
    └── 状态更新时间
```

### 3.5 物流跟踪（ScmLogisticsTracking）

```
ScmLogisticsTracking（物流跟踪）
├── 跟踪信息
│   ├── 物流ID
│   ├── 物流单号
│   ├── 跟踪时间
│   └── 操作人
├── 位置信息
│   ├── 位置
│   └── 经纬度
└── 状态信息
    ├── 状态
    └── 描述
```

### 3.6 供应商对账（ScmSupplierStatement）

```
ScmSupplierStatement（供应商对账单）
├── 对账信息
│   ├── 对账单号（唯一标识）
│   ├── 供应商ID
│   ├── 供应商名称
│   ├── 对账周期（起始日期/结束日期）
│   ├── 对账日期
│   └── 对账类型（月度/季度/年度）
├── 对账明细
│   ├── 采购订单号
│   ├── 入库单号
│   ├── 物料编码
│   ├── 物料名称
│   ├── 数量
│   ├── 单价
│   ├── 金额
│   └── 入库日期
├── 对账汇总
│   ├── 采购总金额
│   ├── 退货总金额
│   ├── 运费
│   ├── 其他费用
│   └── 应付总额
├── 审核信息
│   ├── 审核状态（待审核/已通过/已拒绝）
│   ├── 审核人
│   ├── 审核时间
│   └── 审核意见
└── 结算信息
    ├── 结算状态（待结算/已结算）
    ├── 结算日期
    └── 结算方式
```

---

## 四、功能模块

### 4.1 供应商管理

#### 4.1.1 供应商档案管理
- 供应商创建
- 供应商编辑
- 供应商查询（按编码、名称、类型、状态）
- 供应商删除（逻辑删除）
- 供应商启用/停用

#### 4.1.2 供应商评估
- 评估维度：质量、交付、服务、价格
- 评估周期：季度评估
- 评估等级：A（90-100）、B（80-89）、C（70-79）、D（70以下）
- 评估历史查询

#### 4.1.3 供应商信用
- 信用等级管理
- 信用额度设置
- 信用记录查询
- 信用预警

#### 4.1.4 供应商查询
- 综合查询（支持多条件组合）
- 分页查询
- 导出查询结果

### 4.2 供应商报价管理

#### 4.2.1 报价单创建
- 报价单创建
- 报价明细录入
- 报价有效期设置
- 报价附件上传

#### 4.2.2 报价审批
- 报价审核
- 报价审批
- 报价修改
- 报价拒绝

#### 4.2.3 报价查询
- 报价单查询
- 报价对比
- 报价统计
- 报价历史

#### 4.2.4 报价转采购
- 报价转采购订单
- 批量转采购
- 转换记录查询

### 4.3 物流管理

#### 4.3.1 物流跟踪（供应商物流）
- 物流单创建（采购物流）
- 物流状态更新
- 物流轨迹查询
- 物流实时跟踪

#### 4.3.2 物流费用
- 物流费用录入
- 物流费用审核
- 物流费用统计

#### 4.3.3 物流查询
- 综合查询（按单号、状态、时间）
- 分页查询
- 导出查询结果

### 4.4 供应商对账管理

#### 4.4.1 对账单创建
- 自动生成对账单
- 手动创建对账单
- 对账周期选择
- 对账明细确认

#### 4.4.2 对账审核
- 对账单审核
- 对账差异处理
- 对账单修改
- 对账确认

#### 4.4.3 对账结算
- 对账单结算
- 结算方式选择
- 结算记录查询
- 应付账款生成（调用Finance）

#### 4.4.4 对账统计
- 对账统计报表
- 供应商付款统计
- 对账周期分析

---

## 五、业务流程

### 5.1 供应商评估流程

```
1. 创建供应商档案
   ↓
2. 季度评估触发
   ↓
3. 收集评估数据
   ├── 质量评分（退货率、合格率）
   ├── 交付评分（准时率、交付速度）
   ├── 服务评分（响应速度、服务质量）
   └── 价格评分（价格竞争力、价格稳定性）
   ↓
4. 计算综合评分
   ↓
5. 确定信用等级
   ├── A级（90-100分）
   ├── B级（80-89分）
   ├── C级（70-79分）
   └── D级（70分以下）
   ↓
6. 更新供应商档案
   ↓
7. 生成评估报告
```

### 5.2 供应商报价流程

```
1. 供应商提交报价
   ↓
2. 采购人员录入报价单
   ↓
3. 报价审核
   ↓
4. 审核通过
   ↓
5. 报价对比分析
   ↓
6. 选择最优报价
   ↓
7. 转为采购订单（调用Purchase）
```

### 5.3 物流跟踪流程（采购）

```
1. 采购订单生成（Purchase）
   ↓
2. 采购入库（Purchase）
   ↓
3. 创建物流单（SCM）
   ↓
4. PENDING（待发货）
   ↓
5. SHIPPED（已发货）
   ↓
6. IN_TRANSIT（运输中）
   ├── 录入物流信息
   ├── 更新物流状态
   └── 记录物流轨迹
   ↓
7. DELIVERED（已送达）
   ├── 确认签收
   ├── 更新实际到达日期
   └── 完成物流跟踪
   ↓
8. 异常处理
   ├── 物流异常记录
   └── 异常处理流程
```

### 5.4 供应商对账流程

```
1. 对账周期到达
   ↓
2. 自动生成对账单
   ├── 汇总采购订单数据（从Purchase获取）
   ├── 汇总入库单数据（从Purchase获取）
   ├── 汇总退货单数据（从Purchase获取）
   └── 计算应付总额
   ↓
3. 对账单审核
   ↓
4. 对账差异处理
   ↓
5. 对账确认
   ↓
6. 对账结算
   ↓
7. 生成应付账款（调用Finance）
   ↓
8. 供应商付款
```

---

## 六、数据字典

### 6.1 供应商类型（supplier_type）

| 编码 | 名称 | 说明 |
|------|------|------|
| MANUFACTURER | 制造商 | 生产型企业 |
| DISTRIBUTOR | 分销商 | 批发分销企业 |
| RETAILER | 零售商 | 零售企业 |

### 6.2 企业规模（scale）

| 编码 | 名称 | 说明 |
|------|------|------|
| LARGE | 大型 | 员工数 > 1000 或年营收 > 4亿 |
| MEDIUM | 中型 | 100 <= 员工数 <= 1000 或 2000万 <= 年营收 <= 4亿 |
| SMALL | 小型 | 员工数 < 100 或年营收 < 2000万 |

### 6.3 信用等级（credit_level）

| 编码 | 名称 | 评分范围 | 信用额度范围 |
|------|------|---------|-------------|
| A | 优秀 | 90-100 | 500万-1000万 |
| B | 良好 | 80-89 | 200万-500万 |
| C | 一般 | 70-79 | 50万-200万 |
| D | 较差 | < 70 | 0-50万 |

### 6.4 结算方式（payment_method）

| 编码 | 名称 | 说明 |
|------|------|------|
| CASH | 现金 | 即时付款 |
| CREDIT | 信用 | 账期付款 |
| MONTHLY | 月结 | 每月结算一次 |
| QUARTERLY | 季结 | 每季度结算一次 |

### 6.5 报价类型（quotation_type）

| 编码 | 名称 | 说明 |
|------|------|------|
| NORMAL | 正常报价 | 正常报价流程 |
| URGENT | 紧急报价 | 紧急采购报价 |

### 6.6 审核状态（audit_status）

| 编码 | 名称 | 说明 |
|------|------|------|
| PENDING | 待审核 | 等待审核 |
| APPROVED | 已通过 | 审核通过 |
| REJECTED | 已拒绝 | 审核拒绝 |

### 6.7 物流状态（logistics_status）

| 编码 | 名称 | 说明 |
|------|------|------|
| PENDING | 待发货 | 物流单已创建，等待发货 |
| SHIPPED | 已发货 | 物流已发出 |
| IN_TRANSIT | 运输中 | 物流在运输途中 |
| DELIVERED | 已送达 | 物流已签收 |
| CANCELLED | 已取消 | 物流已取消 |

### 6.8 对账类型（statement_type）

| 编码 | 名称 | 说明 |
|------|------|------|
| MONTHLY | 月度对账 | 每月对账一次 |
| QUARTERLY | 季度对账 | 每季度对账一次 |
| YEARLY | 年度对账 | 每年对账一次 |

### 6.9 结算状态（settlement_status）

| 编码 | 名称 | 说明 |
|------|------|------|
| PENDING | 待结算 | 等待结算 |
| SETTLED | 已结算 | 已完成结算 |

---

## 七、核心表清单

| 表名 | 说明 | 主键 | 索引 |
|------|------|------|------|
| scm_supplier | 供应商表 | id | supplier_code, status, tenant_id |
| scm_supplier_evaluation | 供应商评估表 | id | supplier_id, evaluation_date |
| scm_supplier_quotation | 供应商报价表 | id | quotation_code, supplier_id, audit_status |
| scm_supplier_quotation_detail | 报价明细表 | id | quotation_id, material_code |
| scm_logistics | 物流表 | id | logistics_code, related_order_id, logistics_status, tenant_id |
| scm_logistics_tracking | 物流跟踪表 | id | logistics_id, tracking_time |
| scm_supplier_statement | 供应商对账表 | id | statement_code, supplier_id, statement_period, audit_status |
| scm_supplier_statement_detail | 对账明细表 | id | statement_id, order_id |

---

## 八、跨模块接口设计

### 8.1 调用其他模块

| 接口名称 | 调用模块 | 说明 |
|---------|---------|------|
| createPurchaseOrder | qooerp-purchase | 报价转采购订单 |
| getPurchaseOrders | qooerp-purchase | 获取采购订单（对账用） |
| getPurchaseReceipts | qooerp-purchase | 获取入库单（对账用） |
| getPurchaseReturns | qooerp-purchase | 获取退货单（对账用） |
| createPayable | qooerp-finance | 生成应付账款 |

### 8.2 被其他模块调用

| 接口名称 | 调用模块 | 说明 |
|---------|---------|------|
| getSupplier | qooerp-purchase | 获取供应商信息 |
| getSupplierList | qooerp-purchase | 获取供应商列表 |
| getSupplierQuotation | qooerp-purchase | 获取供应商报价 |

---

## 九、技术约束

### 9.1 数据一致性

- 供应商评估更新时，同步更新供应商表的信用等级
- 报价转采购订单时，需要回写报价单的转换记录
- 对账结算时，需要生成应付账款（调用Finance）

### 9.2 业务规则

- 供应商必须通过评估才能转为正式供应商
- 报价单必须审核通过才能转采购订单
- 对账单必须审核通过才能结算
- 物流单只能关联采购订单（销售物流由Sales负责）

### 9.3 权限控制

- 供应商档案管理：采购管理员权限
- 供应商评估：采购主管权限
- 报价审核：采购经理权限
- 对账审核：财务主管权限

---

*文档维护：请保持此文档的及时更新*
