# QooERP 财务管理 - 应用设计文档

> 版本：v1.0
> 创建日期：2026-02-17

---

## 一、核心实体设计

### 1.1 FinanceVoucher（凭证实体）

```java
package com.qoobot.qooerp.finance.voucher.domain;

import com.qoobot.qooerp.common.entity.BaseEntity;
import lombok.Data;
import lombok.EqualsAndHashCode;
import java.math.BigDecimal;
import java.time.LocalDate;

/**
 * 会计凭证
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class FinanceVoucher extends BaseEntity {
    
    /** 凭证编号 */
    private String voucherCode;
    
    /** 凭证日期 */
    private LocalDate voucherDate;
    
    /** 凭证类型 */
    private String voucherType; // RECEIPT, PAYMENT, TRANSFER, ADJUSTMENT
    
    /** 会计期间 */
    private String accountingPeriod; // YYYY-MM
    
    /** 借方金额 */
    private BigDecimal debitAmount;
    
    /** 贷方金额 */
    private BigDecimal creditAmount;
    
    /** 凭证摘要 */
    private String summary;
    
    /** 制单人ID */
    private Long creatorId;
    
    /** 审核人ID */
    private Long reviewerId;
    
    /** 审核状态 */
    private String reviewStatus; // DRAFT, REVIEWED, POSTED, CANCELLED
    
    /** 审核时间 */
    private LocalDateTime reviewTime;
    
    /** 记账状态 */
    private String postingStatus; // UNPOSTED, POSTED
    
    /** 记账时间 */
    private LocalDateTime postingTime;
    
    /** 附件数 */
    private Integer attachmentCount;
    
    /** 备注 */
    private String remark;
}
```

### 1.2 FinanceVoucherDetail（凭证明细实体）

```java
package com.qoobot.qooerp.finance.voucher.domain;

import com.qoobot.qooerp.common.entity.BaseEntity;
import lombok.Data;
import lombok.EqualsAndHashCode;
import java.math.BigDecimal;

/**
 * 凭证明细
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class FinanceVoucherDetail extends BaseEntity {
    
    /** 凭证ID */
    private Long voucherId;
    
    /** 科目编码 */
    private String accountCode;
    
    /** 科目名称 */
    private String accountName;
    
    /** 借贷方向 */
    private String direction; // DEBIT, CREDIT
    
    /** 金额 */
    private BigDecimal amount;
    
    /** 摘要 */
    private String summary;
    
    /** 辅助核算类型 */
    private String auxiliaryType; // CUSTOMER, SUPPLIER, EMPLOYEE, PROJECT
    
    /** 辅助核算ID */
    private Long auxiliaryId;
    
    /** 排序号 */
    private Integer sortOrder;
}
```

### 1.3 FinanceAccount（科目实体）

```java
package com.qoobot.qooerp.finance.account.domain;

import com.qoobot.qooerp.common.entity.BaseEntity;
import lombok.Data;
import lombok.EqualsAndHashCode;

/**
 * 会计科目
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class FinanceAccount extends BaseEntity {
    
    /** 科目编码 */
    private String accountCode;
    
    /** 科目名称 */
    private String accountName;
    
    /** 科目类型 */
    private String accountType; // ASSET, LIABILITY, EQUITY, REVENUE, EXPENSE
    
    /** 科目级次 */
    private Integer level;
    
    /** 父科目ID */
    private Long parentId;
    
    /** 是否末级 */
    private Boolean isLeaf;
    
    /** 借贷方向 */
    private String direction; // DEBIT, CREDIT
    
    /** 余额方向 */
    private String balanceDirection; // DEBIT, CREDIT
    
    /** 是否启用 */
    private Boolean isEnabled;
    
    /** 是否现金科目 */
    private Boolean isCashAccount;
    
    /** 是否银行科目 */
    private Boolean isBankAccount;
    
    /** 排序号 */
    private Integer sortOrder;
}
```

### 1.4 FinanceReceivable（应收账款实体）

```java
package com.qoobot.qooerp.finance.receivable.domain;

import com.qoobot.qooerp.common.entity.BaseEntity;
import lombok.Data;
import lombok.EqualsAndHashCode;
import java.math.BigDecimal;
import java.time.LocalDate;

/**
 * 应收账款
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class FinanceReceivable extends BaseEntity {
    
    /** 应收单号 */
    private String receivableCode;
    
    /** 客户ID */
    private Long customerId;
    
    /** 客户名称 */
    private String customerName;
    
    /** 业务类型 */
    private String businessType; // SALES, OTHER
    
    /** 关联单据ID */
    private Long relatedOrderId;
    
    /** 关联单据号 */
    private String relatedOrderCode;
    
    /** 应收金额 */
    private BigDecimal receivableAmount;
    
    /** 已收金额 */
    private BigDecimal receivedAmount;
    
    /** 未收金额 */
    private BigDecimal unpaidAmount;
    
    /** 应收日期 */
    private LocalDate receivableDate;
    
    /** 到期日期 */
    private LocalDate dueDate;
    
    /** 账龄（天） */
    private Integer agingDays;
    
    /** 单据状态 */
    private String status; // UNPAID, PARTIAL_PAID, FULL_PAID, CANCELLED
    
    /** 备注 */
    private String remark;
}
```

### 1.5 FinancePayable（应付账款实体）

```java
package com.qoobot.qooerp.finance.payable.domain;

import com.qoobot.qooerp.common.entity.BaseEntity;
import lombok.Data;
import lombok.EqualsAndHashCode;
import java.math.BigDecimal;
import java.time.LocalDate;

/**
 * 应付账款
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class FinancePayable extends BaseEntity {
    
    /** 应付单号 */
    private String payableCode;
    
    /** 供应商ID */
    private Long supplierId;
    
    /** 供应商名称 */
    private String supplierName;
    
    /** 业务类型 */
    private String businessType; // PURCHASE, OTHER
    
    /** 关联单据ID */
    private Long relatedOrderId;
    
    /** 关联单据号 */
    private String relatedOrderCode;
    
    /** 应付金额 */
    private BigDecimal payableAmount;
    
    /** 已付金额 */
    private BigDecimal paidAmount;
    
    /** 未付金额 */
    private BigDecimal unpaidAmount;
    
    /** 应付日期 */
    private LocalDate payableDate;
    
    /** 到期日期 */
    private LocalDate dueDate;
    
    /** 账龄（天） */
    private Integer agingDays;
    
    /** 单据状态 */
    private String status; // UNPAID, PARTIAL_PAID, FULL_PAID, CANCELLED
    
    /** 备注 */
    private String remark;
}
```

### 1.6 FinanceAsset（固定资产实体）

```java
package com.qoobot.qooerp.finance.asset.domain;

import com.qoobot.qooerp.common.entity.BaseEntity;
import lombok.Data;
import lombok.EqualsAndHashCode;
import java.math.BigDecimal;
import java.time.LocalDate;

/**
 * 固定资产
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class FinanceAsset extends BaseEntity {
    
    /** 资产编码 */
    private String assetCode;
    
    /** 资产名称 */
    private String assetName;
    
    /** 资产分类ID */
    private Long categoryId;
    
    /** 资产分类名称 */
    private String categoryName;
    
    /** 规格型号 */
    private String specification;
    
    /** 计量单位 */
    private String unit;
    
    /** 数量 */
    private BigDecimal quantity;
    
    /** 原值 */
    private BigDecimal originalValue;
    
    /** 累计折旧 */
    private BigDecimal accumulatedDepreciation;
    
    /** 净值 */
    private BigDecimal netValue;
    
    /** 使用部门ID */
    private Long departmentId;
    
    /** 使用部门名称 */
    private String departmentName;
    
    /** 使用人ID */
    private Long userId;
    
    /** 使用人姓名 */
    private String userName;
    
    /** 存放地点 */
    private String location;
    
    /** 入账日期 */
    private LocalDate entryDate;
    
    /** 开始使用日期 */
    private LocalDate startDate;
    
    /** 使用年限（年） */
    private Integer usefulLife;
    
    /** 折旧方法 */
    private String depreciationMethod; // STRAIGHT_LINE, DOUBLE_DECLINING, SUM_OF_YEARS
    
    /** 折旧状态 */
    private String depreciationStatus; // NORMAL, SUSPENDED, COMPLETED
    
    /** 资产状态 */
    private String status; // NORMAL, IDLE, DISPOSAL
    
    /** 备注 */
    private String remark;
}
```

---

## 二、核心服务接口

### 2.1 总账服务接口

```java
package com.qoobot.qooerp.finance.voucher.service;

import com.qoobot.qooerp.finance.voucher.domain.FinanceVoucher;
import com.qoobot.qooerp.finance.voucher.dto.VoucherDTO;
import com.qoobot.qooerp.finance.voucher.dto.VoucherQueryDTO;
import com.qoobot.qooerp.common.response.Result;
import com.qoobot.qooerp.common.core.page.PageResult;

/**
 * 总账服务
 */
public interface FinanceVoucherService {
    
    /**
     * 创建凭证
     */
    Result<Long> createVoucher(VoucherDTO voucherDTO);
    
    /**
     * 更新凭证
     */
    Result<Void> updateVoucher(Long id, VoucherDTO voucherDTO);
    
    /**
     * 删除凭证
     */
    Result<Void> deleteVoucher(Long id);
    
    /**
     * 审核凭证
     */
    Result<Void> reviewVoucher(Long id, Long reviewerId);
    
    /**
     * 反审核凭证
     */
    Result<Void> unreviewVoucher(Long id, Long reviewerId);
    
    /**
     * 记账凭证
     */
    Result<Void> postVoucher(Long id);
    
    /**
     * 反记账凭证
     */
    Result<Void> unpostVoucher(Long id);
    
    /**
     * 查询凭证
     */
    Result<PageResult<VoucherDTO>> queryVouchers(VoucherQueryDTO queryDTO);
    
    /**
     * 获取凭证详情
     */
    Result<VoucherDTO> getVoucher(Long id);
    
    /**
     * 检查借贷平衡
     */
    Result<Boolean> checkBalance(Long voucherId);
}
```

### 2.2 应收账款服务接口

```java
package com.qoobot.qooerp.finance.receivable.service;

import com.qoobot.qooerp.finance.receivable.domain.FinanceReceivable;
import com.qoobot.qooerp.finance.receivable.dto.ReceivableDTO;
import com.qoobot.qooerp.finance.receivable.dto.ReceiptDTO;
import com.qoobot.qooerp.common.response.Result;
import com.qoobot.qooerp.common.core.page.PageResult;
import java.math.BigDecimal;
import java.time.LocalDate;

/**
 * 应收账款服务
 */
public interface FinanceReceivableService {
    
    /**
     * 创建应收账款
     */
    Result<Long> createReceivable(ReceivableDTO receivableDTO);
    
    /**
     * 收款登记
     */
    Result<Long> registerReceipt(ReceiptDTO receiptDTO);
    
    /**
     * 核销应收账款
     */
    Result<Void> writeOff(Long receivableId, Long receiptId, BigDecimal amount);
    
    /**
     * 取消核销
     */
    Result<Void> unwriteOff(Long receivableId, Long receiptId);
    
    /**
     * 查询应收账款
     */
    Result<PageResult<ReceivableDTO>> queryReceivables(ReceivableQueryDTO queryDTO);
    
    /**
     * 账龄分析
     */
    Result<List<AgingAnalysisDTO>> agingAnalysis(LocalDate asOfDate);
}
```

### 2.3 应付账款服务接口

```java
package com.qoobot.qooerp.finance.payable.service;

import com.qoobot.qooerp.finance.payable.domain.FinancePayable;
import com.qoobot.qooerp.finance.payable.dto.PayableDTO;
import com.qoobot.qooerp.finance.payable.dto.PaymentDTO;
import com.qoobot.qooerp.common.response.Result;
import com.qoobot.qooerp.common.core.page.PageResult;

/**
 * 应付账款服务
 */
public interface FinancePayableService {
    
    /**
     * 创建应付账款
     */
    Result<Long> createPayable(PayableDTO payableDTO);
    
    /**
     * 付款登记
     */
    Result<Long> registerPayment(PaymentDTO paymentDTO);
    
    /**
     * 核销应付账款
     */
    Result<Void> writeOff(Long payableId, Long paymentId, BigDecimal amount);
    
    /**
     * 取消核销
     */
    Result<Void> unwriteOff(Long payableId, Long paymentId);
    
    /**
     * 查询应付账款
     */
    Result<PageResult<PayableDTO>> queryPayables(PayableQueryDTO queryDTO);
    
    /**
     * 账龄分析
     */
    Result<List<AgingAnalysisDTO>> agingAnalysis(LocalDate asOfDate);
}
```

### 2.4 资产管理服务接口

```java
package com.qoobot.qooerp.finance.asset.service;

import com.qoobot.qooerp.finance.asset.domain.FinanceAsset;
import com.qoobot.qooerp.finance.asset.dto.AssetDTO;
import com.qoobot.qooerp.finance.asset.dto.AssetDepreciationDTO;
import com.qoobot.qooerp.common.response.Result;
import com.qoobot.qooerp.common.core.page.PageResult;

/**
 * 资产管理服务
 */
public interface FinanceAssetService {
    
    /**
     * 创建资产
     */
    Result<Long> createAsset(AssetDTO assetDTO);
    
    /**
     * 更新资产
     */
    Result<Void> updateAsset(Long id, AssetDTO assetDTO);
    
    /**
     * 删除资产
     */
    Result<Void> deleteAsset(Long id);
    
    /**
     * 资产处置
     */
    Result<Void> disposalAsset(Long id, String disposalType, BigDecimal disposalAmount);
    
    /**
     * 月度折旧
     */
    Result<Void> monthlyDepreciation(String accountingPeriod);
    
    /**
     * 查询资产
     */
    Result<PageResult<AssetDTO>> queryAssets(AssetQueryDTO queryDTO);
    
    /**
     * 查询折旧记录
     */
    Result<PageResult<AssetDepreciationDTO>> queryDepreciations(AssetDepreciationQueryDTO queryDTO);
}
```

### 2.5 财务报表服务接口

```java
package com.qoobot.qooerp.finance.report.service;

import com.qoobot.qooerp.common.response.Result;

/**
 * 财务报表服务
 */
public interface FinanceReportService {
    
    /**
     * 生成资产负债表
     */
    Result<BalanceSheetDTO> generateBalanceSheet(String accountingPeriod);
    
    /**
     * 生成利润表
     */
    Result<IncomeStatementDTO> generateIncomeStatement(String accountingPeriod);
    
    /**
     * 生成现金流量表
     */
    Result<CashFlowStatementDTO> generateCashFlowStatement(String accountingPeriod);
    
    /**
     * 生成科目余额表
     */
    Result<AccountBalanceDTO> generateAccountBalance(String accountingPeriod);
}
```

---

## 三、包结构

```
com.qoobot.qooerp.finance
├── voucher           # 总账管理
│   ├── controller/
│   ├── service/
│   ├── domain/
│   │   ├── FinanceVoucher.java
│   │   └── FinanceVoucherDetail.java
│   └── dto/
├── account           # 科目管理
│   ├── controller/
│   ├── service/
│   ├── domain/
│   │   └── FinanceAccount.java
│   └── dto/
├── receivable        # 应收管理
├── payable           # 应付管理
├── asset             # 资产管理
└── report            # 报表管理
```

---

## 四、相关文档

- 01-业务设计.md
- 03-数据设计.md
- 04-API接口文档.md
- 05-技术设计.md
- 05-数据库脚本.sql
