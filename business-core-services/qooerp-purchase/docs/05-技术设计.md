# QooERP 采购管理 - 技术设计文档

> 版本：v1.0
> 创建日期：2026-02-17
> 服务名称：qooerp-purchase
> 端口：8091
> 数据库：PostgreSQL 15+

---

## 一、技术栈

| 分类 | 技术选型 | 版本 |
|------|---------|------|
| 开发语言 | Java | 17 |
| 框架 | Spring Boot | 3.2.x |
| 服务注册 | Nacos | 2.3.x |
| 持久层 | MyBatis Plus | 3.5.x |
| 数据库 | PostgreSQL | 15+ |
| 缓存 | Redis | 7.0.x |

---

## 二、配置文件

```yaml
server:
  port: 8091

spring:
  application:
    name: qooerp-purchase

  datasource:
    driver-class-name: org.postgresql.Driver
    url: jdbc:postgresql://localhost:5432/qooerp_purchase
    username: qooerp_purchase
    password: qooerp_purchase_2026

  redis:
    host: localhost
    port: 6379
    database: 5
```

---

## 三、包结构

```
com.qoobot.qooerp.purchase
├── config           # 配置类
│   ├── CrossOriginConfig.java
│   └── AsyncConfig.java
├── controller       # 控制器
├── dto             # 数据传输对象
│   ├── common       # 通用DTO
│   ├── order        # 订单DTO
│   ├── receipt      # 入库DTO
│   └── return       # 退货DTO
├── entity          # 实体类
├── exception       # 异常处理
│   ├── GlobalExceptionHandler.java
│   └── PurchaseException.java
├── mapper          # 数据访问层
├── service         # 业务逻辑层
│   └── impl        # 业务实现
└── util            # 工具类
    └── ResponseUtil.java
```

---

## 四、核心配置说明

### 4.1 跨域配置

```java
@Configuration
public class CrossOriginConfig {
    @Bean
    public CorsFilter corsFilter() {
        CorsConfiguration config = new CorsConfiguration();
        config.addAllowedOriginPattern("*");
        config.addAllowedMethod("*");
        config.addAllowedHeader("*");
        config.setAllowCredentials(true);
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", config);
        return new CorsFilter(source);
    }
}
```

### 4.2 全局异常处理

```java
@RestControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(PurchaseException.class)
    public Result<Void> handlePurchaseException(PurchaseException e) {
        return Result.error(e.getCode(), e.getMessage());
    }

    @ExceptionHandler(Exception.class)
    public Result<Void> handleException(Exception e) {
        log.error("系统异常", e);
        return Result.error(500, "系统异常");
    }
}
```

---

## 五、外部依赖接口

### 5.1 库存服务接口

采购模块需要调用库存服务实现库存联动：

| 接口 | 方法 | 说明 |
|------|------|------|
| 增加库存 | POST /api/inventory/increase | 入库时增加库存 |
| 扣减库存 | POST /api/inventory/decrease | 退货时扣减库存 |
| 查询库存 | GET /api/inventory/query | 查询物料可用库存 |

### 5.2 物料服务接口

| 接口 | 方法 | 说明 |
|------|------|------|
| 查询物料 | GET /api/material/{id} | 获取物料信息 |
| 批量查询 | POST /api/material/batch | 批量获取物料信息 |

### 5.3 仓库服务接口

| 接口 | 方法 | 说明 |
|------|------|------|
| 查询仓库 | GET /api/warehouse/{id} | 获取仓库信息 |

---

*文档维护：请保持此文档的及时更新*
