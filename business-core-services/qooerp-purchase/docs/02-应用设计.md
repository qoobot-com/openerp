# QooERP 采购管理 - 应用设计文档

> 版本：v1.0
> 创建日期：2026-02-17

---

## 一、核心实体设计

### 1.1 PurchaseOrder（采购订单实体）

```java
package com.qoobot.qooerp.purchase.order.domain;

import com.qoobot.qooerp.common.entity.BaseEntity;
import lombok.Data;
import lombok.EqualsAndHashCode;
import java.math.BigDecimal;
import java.time.LocalDate;

/**
 * 采购订单实体
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class PurchaseOrder extends BaseEntity {
    
    /** 订单编号 */
    private String orderCode;
    
    /** 供应商ID */
    private Long supplierId;
    
    /** 供应商名称 */
    private String supplierName;
    
    /** 订单日期 */
    private LocalDate orderDate;
    
    /** 交货日期 */
    private LocalDate deliveryDate;
    
    /** 订单金额 */
    private BigDecimal orderAmount;
    
    /** 折扣金额 */
    private BigDecimal discountAmount;
    
    /** 实付金额 */
    private BigDecimal payableAmount;
    
    /** 订单状态 */
    private String orderStatus; // DRAFT, PENDING, APPROVED, RECEIVED, COMPLETED, CANCELLED
    
    /** 采购员ID */
    private Long purchaserId;
    
    /** 采购员姓名 */
    private String purchaserName;
    
    /** 仓库ID */
    private Long warehouseId;
    
    /** 仓库名称 */
    private String warehouseName;
    
    /** 备注 */
    private String remark;
}
```

### 1.2 PurchaseOrderDetail（订单明细实体）

```java
package com.qoobot.qooerp.purchase.order.domain;

import com.qoobot.qooerp.common.entity.BaseEntity;
import lombok.Data;
import lombok.EqualsAndHashCode;
import java.math.BigDecimal;

/**
 * 采购订单明细实体
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class PurchaseOrderDetail extends BaseEntity {
    
    /** 订单ID */
    private Long orderId;
    
    /** 物料ID */
    private Long materialId;
    
    /** 物料编码 */
    private String materialCode;
    
    /** 物料名称 */
    private String materialName;
    
    /** 规格型号 */
    private String specification;
    
    /** 计量单位 */
    private String unit;
    
    /** 数量 */
    private BigDecimal quantity;
    
    /** 单价 */
    private BigDecimal unitPrice;
    
    /** 金额 */
    private BigDecimal amount;
    
    /** 折扣率 */
    private BigDecimal discountRate;
    
    /** 折扣金额 */
    private BigDecimal discountAmount;
    
    /** 实付金额 */
    private BigDecimal payableAmount;
    
    /** 已收货数量 */
    private BigDecimal receivedQuantity;
    
    /** 备注 */
    private String remark;
}
```

### 1.3 PurchaseReceipt（入库单实体）

```java
package com.qoobot.qooerp.purchase.receipt.domain;

import com.qoobot.qooerp.common.entity.BaseEntity;
import lombok.Data;
import lombok.EqualsAndHashCode;
import java.math.BigDecimal;
import java.time.LocalDate;

/**
 * 采购入库单实体
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class PurchaseReceipt extends BaseEntity {
    
    /** 入库单编号 */
    private String receiptCode;
    
    /** 订单ID */
    private Long orderId;
    
    /** 订单编号 */
    private String orderCode;
    
    /** 供应商ID */
    private Long supplierId;
    
    /** 供应商名称 */
    private String supplierName;
    
    /** 入库日期 */
    private LocalDate receiptDate;
    
    /** 入库金额 */
    private BigDecimal receiptAmount;
    
    /** 入库状态 */
    private String receiptStatus; // PENDING, COMPLETED, CANCELLED
    
    /** 仓库ID */
    private Long warehouseId;
    
    /** 仓库名称 */
    private String warehouseName;
    
    /** 入库员ID */
    private Long operatorId;
    
    /** 入库员姓名 */
    private String operatorName;
    
    /** 备注 */
    private String remark;
}
```

### 1.4 PurchaseReceiptDetail（入库明细实体）

```java
package com.qoobot.qooerp.purchase.receipt.domain;

import com.qoobot.qooerp.common.entity.BaseEntity;
import lombok.Data;
import lombok.EqualsAndHashCode;
import java.math.BigDecimal;

/**
 * 采购入库明细实体
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class PurchaseReceiptDetail extends BaseEntity {
    
    /** 入库单ID */
    private Long receiptId;
    
    /** 订单明细ID */
    private Long orderDetailId;
    
    /** 物料ID */
    private Long materialId;
    
    /** 物料编码 */
    private String materialCode;
    
    /** 物料名称 */
    private String materialName;
    
    /** 规格型号 */
    private String specification;
    
    /** 计量单位 */
    private String unit;
    
    /** 入库数量 */
    private BigDecimal quantity;
    
    /** 单价 */
    private BigDecimal unitPrice;
    
    /** 金额 */
    private BigDecimal amount;
    
    /** 批次号 */
    private String batchNo;
    
    /** 生产日期 */
    private LocalDate productionDate;
    
    /** 有效期至 */
    private LocalDate expiryDate;
    
    /** 备注 */
    private String remark;
}
```

### 1.5 PurchaseReturn（退货单实体）

```java
package com.qoobot.qooerp.purchase.return.domain;

import com.qoobot.qooerp.common.entity.BaseEntity;
import lombok.Data;
import lombok.EqualsAndHashCode;
import java.math.BigDecimal;
import java.time.LocalDate;

/**
 * 采购退货单实体
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class PurchaseReturn extends BaseEntity {
    
    /** 退货单编号 */
    private String returnCode;
    
    /** 订单ID */
    private Long orderId;
    
    /** 订单编号 */
    private String orderCode;
    
    /** 入库单ID */
    private Long receiptId;
    
    /** 供应商ID */
    private Long supplierId;
    
    /** 供应商名称 */
    private String supplierName;
    
    /** 退货日期 */
    private LocalDate returnDate;
    
    /** 退货金额 */
    private BigDecimal returnAmount;
    
    /** 退货原因 */
    private String reason;
    
    /** 退货状态 */
    private String returnStatus; // PENDING, APPROVED, COMPLETED, CANCELLED
    
    /** 仓库ID */
    private Long warehouseId;
    
    /** 仓库名称 */
    private String warehouseName;
    
    /** 退货员ID */
    private Long operatorId;
    
    /** 退货员姓名 */
    private String operatorName;
    
    /** 备注 */
    private String remark;
}
```

### 1.6 PurchaseReturnDetail（退货明细实体）

```java
package com.qoobot.qooerp.purchase.return.domain;

import com.qoobot.qooerp.common.entity.BaseEntity;
import lombok.Data;
import lombok.EqualsAndHashCode;
import java.math.BigDecimal;

/**
 * 采购退货明细实体
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class PurchaseReturnDetail extends BaseEntity {
    
    /** 退货单ID */
    private Long returnId;
    
    /** 物料ID */
    private Long materialId;
    
    /** 物料编码 */
    private String materialCode;
    
    /** 物料名称 */
    private String materialName;
    
    /** 规格型号 */
    private String specification;
    
    /** 计量单位 */
    private String unit;
    
    /** 退货数量 */
    private BigDecimal quantity;
    
    /** 单价 */
    private BigDecimal unitPrice;
    
    /** 金额 */
    private BigDecimal amount;
    
    /** 批次号 */
    private String batchNo;
    
    /** 退货原因 */
    private String reason;
    
    /** 备注 */
    private String remark;
}
```

---

## 二、DTO 数据传输对象

### 2.1 采购订单相关 DTO

```java
@Data
public class OrderCreateDTO {
    private Long supplierId;
    private String supplierName;
    private LocalDate orderDate;
    private LocalDate deliveryDate;
    private Long warehouseId;
    private String warehouseName;
    private String remark;
    private List<OrderDetailCreateDTO> details;
}

@Data
public class OrderDetailCreateDTO {
    private Long materialId;
    private String materialCode;
    private String materialName;
    private String specification;
    private String unit;
    private BigDecimal quantity;
    private BigDecimal unitPrice;
    private BigDecimal discountRate;
    private String remark;
}

@Data
public class OrderUpdateDTO {
    private Long id;
    private LocalDate deliveryDate;
    private Long warehouseId;
    private String warehouseName;
    private String remark;
    private List<OrderDetailCreateDTO> details;
}

@Data
public class OrderQueryDTO extends PageQuery {
    private String orderCode;
    private Long supplierId;
    private String orderStatus;
    private LocalDate startDate;
    private LocalDate endDate;
}

@Data
public class OrderDTO {
    private Long id;
    private String orderCode;
    private Long supplierId;
    private String supplierName;
    private LocalDate orderDate;
    private LocalDate deliveryDate;
    private BigDecimal orderAmount;
    private BigDecimal discountAmount;
    private BigDecimal payableAmount;
    private String orderStatus;
    private String orderStatusName;
    private Long purchaserId;
    private String purchaserName;
    private Long warehouseId;
    private String warehouseName;
    private String remark;
    private LocalDateTime createTime;
    private List<OrderDetailDTO> details;
}

@Data
public class OrderDetailDTO {
    private Long id;
    private Long materialId;
    private String materialCode;
    private String materialName;
    private String specification;
    private String unit;
    private BigDecimal quantity;
    private BigDecimal unitPrice;
    private BigDecimal amount;
    private BigDecimal discountRate;
    private BigDecimal discountAmount;
    private BigDecimal payableAmount;
    private BigDecimal receivedQuantity;
    private String remark;
}
```

### 2.2 采购入库相关 DTO

```java
@Data
public class ReceiptCreateDTO {
    private Long orderId;
    private LocalDate receiptDate;
    private Long warehouseId;
    private String warehouseName;
    private String remark;
    private List<ReceiptDetailCreateDTO> details;
}

@Data
public class ReceiptDetailCreateDTO {
    private Long orderDetailId;
    private Long materialId;
    private String materialCode;
    private String materialName;
    private String specification;
    private String unit;
    private BigDecimal quantity;
    private BigDecimal unitPrice;
    private String batchNo;
    private LocalDate productionDate;
    private LocalDate expiryDate;
    private String remark;
}

@Data
public class ReceiptQueryDTO extends PageQuery {
    private String receiptCode;
    private Long orderId;
    private Long supplierId;
    private String receiptStatus;
    private LocalDate startDate;
    private LocalDate endDate;
}

@Data
public class ReceiptDTO {
    private Long id;
    private String receiptCode;
    private Long orderId;
    private String orderCode;
    private Long supplierId;
    private String supplierName;
    private LocalDate receiptDate;
    private BigDecimal receiptAmount;
    private String receiptStatus;
    private String receiptStatusName;
    private Long warehouseId;
    private String warehouseName;
    private Long operatorId;
    private String operatorName;
    private String remark;
    private LocalDateTime createTime;
    private List<ReceiptDetailDTO> details;
}

@Data
public class ReceiptDetailDTO {
    private Long id;
    private Long materialId;
    private String materialCode;
    private String materialName;
    private String specification;
    private String unit;
    private BigDecimal quantity;
    private BigDecimal unitPrice;
    private BigDecimal amount;
    private String batchNo;
    private LocalDate productionDate;
    private LocalDate expiryDate;
    private String remark;
}
```

### 2.3 采购退货相关 DTO

```java
@Data
public class ReturnCreateDTO {
    private Long orderId;
    private Long receiptId;
    private LocalDate returnDate;
    private String reason;
    private Long warehouseId;
    private String warehouseName;
    private String remark;
    private List<ReturnDetailCreateDTO> details;
}

@Data
public class ReturnDetailCreateDTO {
    private Long materialId;
    private String materialCode;
    private String materialName;
    private String specification;
    private String unit;
    private BigDecimal quantity;
    private BigDecimal unitPrice;
    private String batchNo;
    private String reason;
    private String remark;
}

@Data
public class ReturnQueryDTO extends PageQuery {
    private String returnCode;
    private Long orderId;
    private Long supplierId;
    private String returnStatus;
    private LocalDate startDate;
    private LocalDate endDate;
}

@Data
public class ReturnDTO {
    private Long id;
    private String returnCode;
    private Long orderId;
    private String orderCode;
    private Long receiptId;
    private Long supplierId;
    private String supplierName;
    private LocalDate returnDate;
    private BigDecimal returnAmount;
    private String reason;
    private String returnStatus;
    private String returnStatusName;
    private Long warehouseId;
    private String warehouseName;
    private Long operatorId;
    private String operatorName;
    private String remark;
    private LocalDateTime createTime;
    private List<ReturnDetailDTO> details;
}

@Data
public class ReturnDetailDTO {
    private Long id;
    private Long materialId;
    private String materialCode;
    private String materialName;
    private String specification;
    private String unit;
    private BigDecimal quantity;
    private BigDecimal unitPrice;
    private BigDecimal amount;
    private String batchNo;
    private String reason;
    private String remark;
}
```

---

---

## 三、统一响应对象

```java
@Data
public class Result<T> {
    private Integer code;
    private String message;
    private T data;

    public static <T> Result<T> success(T data) {
        Result<T> result = new Result<>();
        result.setCode(200);
        result.setMessage("success");
        result.setData(data);
        return result;
    }

    public static <T> Result<T> error(Integer code, String message) {
        Result<T> result = new Result<>();
        result.setCode(code);
        result.setMessage(message);
        return result;
    }
}

@Data
public class PageResult<T> {
    private Long total;
    private List<T> records;
    private Integer pageNum;
    private Integer pageSize;
}
```

---

## 四、核心服务接口

### 4.1 采购订单服务接口

```java
public interface PurchaseOrderService {
    
    /**
     * 创建采购订单
     */
    Result<Long> createOrder(OrderCreateDTO orderDTO);
    
    /**
     * 更新采购订单
     */
    Result<Void> updateOrder(OrderUpdateDTO orderDTO);
    
    /**
     * 删除采购订单
     */
    Result<Void> deleteOrder(Long orderId);
    
    /**
     * 提交审核
     */
    Result<Void> submitOrder(Long orderId);
    
    /**
     * 审核订单
     */
    Result<Void> approveOrder(Long orderId, Long approverId);
    
    /**
     * 驳回订单
     */
    Result<Void> rejectOrder(Long orderId, String reason);
    
    /**
     * 取消订单
     */
    Result<Void> cancelOrder(Long orderId);
    
    /**
     * 完成订单
     */
    Result<Void> completeOrder(Long orderId);
    
    /**
     * 获取订单详情
     */
    Result<OrderDTO> getOrder(Long orderId);
    
    /**
     * 分页查询订单
     */
    Result<PageResult<OrderDTO>> queryOrders(OrderQueryDTO queryDTO);
}
```

### 4.2 采购入库服务接口

```java
public interface PurchaseReceiptService {
    
    /**
     * 创建入库单
     */
    Result<Long> createReceipt(ReceiptCreateDTO receiptDTO);
    
    /**
     * 删除入库单
     */
    Result<Void> deleteReceipt(Long receiptId);
    
    /**
     * 审核入库单
     */
    Result<Void> approveReceipt(Long receiptId);
    
    /**
     * 取消入库单
     */
    Result<Void> cancelReceipt(Long receiptId);
    
    /**
     * 获取入库单详情
     */
    Result<ReceiptDTO> getReceipt(Long receiptId);
    
    /**
     * 分页查询入库单
     */
    Result<PageResult<ReceiptDTO>> queryReceipts(ReceiptQueryDTO queryDTO);
}
```

### 4.3 采购退货服务接口

```java
public interface PurchaseReturnService {
    
    /**
     * 创建退货单
     */
    Result<Long> createReturn(ReturnCreateDTO returnDTO);
    
    /**
     * 删除退货单
     */
    Result<Void> deleteReturn(Long returnId);
    
    /**
     * 审核退货单
     */
    Result<Void> approveReturn(Long returnId);
    
    /**
     * 完成退货
     */
    Result<Void> completeReturn(Long returnId);
    
    /**
     * 取消退货单
     */
    Result<Void> cancelReturn(Long returnId);
    
    /**
     * 获取退货单详情
     */
    Result<ReturnDTO> getReturn(Long returnId);
    
    /**
     * 分页查询退货单
     */
    Result<PageResult<ReturnDTO>> queryReturns(ReturnQueryDTO queryDTO);
}
```

---

*文档维护：请保持此文档的及时更新*
