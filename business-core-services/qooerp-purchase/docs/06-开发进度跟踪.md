# QooERP 采购管理模块 - 开发进度跟踪

> 模块名称: qooerp-purchase
> 服务端口: 8091
> 跟踪周期: 20xx-xx-xx
> 最后更新: 20xx-xx-xx

## 开发完成总结

> 基础代码开发完成，待测试和库存联动集成

### 已完成文档
- ✅ 业务设计文档
- ✅ 应用设计文档
- ✅ 数据设计文档
- ✅ API接口文档
- ✅ 技术设计文档
- ✅ 数据库脚本

### 已完成代码
- ✅ 基础框架搭建
- ✅ Entity实体层
- ✅ DTO对象层
- ✅ Mapper持久层
- ✅ Service业务层
- ✅ Controller控制层

### 待完成
- ⏳ 单元测试
- ⏳ 集成测试
- ⏳ 库存联动集成

### 接口清单
| 模块 | 接口数 | 状态 |
|------|--------|------|
| 订单管理 | 10个 | ✅ 已完成 |
| 入库管理 | 6个 | ✅ 已完成 |
| 退货管理 | 7个 | ✅ 已完成 |
| **合计** | **23个** | **✅ 已完成** |

## 开发进度总览

| 阶段 | 任务数 | 已完成 | 进度 |
|------|--------|--------|------|
| 项目准备 | 4 | 4 | 100% |
| 数据库设计 | 6 | 6 | 100% |
| 基础框架 | 10 | 10 | 100% |
| 核心功能开发 | 44 | 44 | 100% |
| 测试 | 6 | 0 | 0% |
| 文档 | 7 | 7 | 100% |
| **总计** | **77** | **71** | **92%** |

---

## 一、项目准备 (4/4)

| 序号 | 任务名称 | 状态 | 负责人 | 完成时间 |
|------|----------|------|--------|----------|
| 1.1 | 需求分析与评审 | ✅ | - | 20xx-xx-xx |
| 1.2 | 技术方案设计 | ✅ | - | 20xx-xx-xx |
| 1.3 | 开发环境搭建 | ✅ | - | 20xx-xx-xx |
| 1.4 | 开发计划制定 | ✅ | - | 20xx-xx-xx |

---

## 二、数据库设计 (6/6)

| 序号 | 任务名称 | 状态 | 负责人 | 完成时间 |
|------|----------|------|--------|----------|
| 2.1 | purchase_order表设计 | ✅ | - | 20xx-xx-xx |
| 2.2 | purchase_order_detail表设计 | ✅ | - | 20xx-xx-xx |
| 2.3 | purchase_receipt表设计 | ✅ | - | 20xx-xx-xx |
| 2.4 | purchase_receipt_detail表设计 | ✅ | - | 20xx-xx-xx |
| 2.5 | purchase_return表设计 | ✅ | - | 20xx-xx-xx |
| 2.6 | purchase_return_detail表设计 | ✅ | - | 20xx-xx-xx |

---

## 三、基础框架 (10/10)

| 序号 | 任务名称 | 状态 | 负责人 | 完成时间 |
|------|----------|------|--------|----------|
| 3.1 | 启动类创建 | ✅ | - | 20xx-xx-xx |
| 3.2 | 配置文件编写 | ✅ | - | 20xx-xx-xx |
| 3.3 | 统一响应对象引用 | ✅ | - | 20xx-xx-xx |
| 3.4 | 分页查询对象引用 | ✅ | - | 20xx-xx-xx |
| 3.5 | 全局异常处理器引用 | ✅ | - | 20xx-xx-xx |
| 3.6 | 业务异常类引用 | ✅ | - | 20xx-xx-xx |
| 3.7 | 库存服务FeignClient | ✅ | - | 20xx-xx-xx |
| 3.8 | 物料服务FeignClient | ✅ | - | 20xx-xx-xx |
| 3.9 | 仓库服务FeignClient | ✅ | - | 20xx-xx-xx |
| 3.10 | Feign配置 | ✅ | - | 20xx-xx-xx |

---

## 四、核心功能开发 (0/44)

### 4.1 Entity实体层 (6/6)

| 序号 | 任务名称 | 状态 | 负责人 | 完成时间 |
|------|----------|------|--------|----------|
| 4.1.1 | PurchaseOrder实体 | ✅ | - | 20xx-xx-xx |
| 4.1.2 | PurchaseOrderDetail实体 | ✅ | - | 20xx-xx-xx |
| 4.1.3 | PurchaseReceipt实体 | ✅ | - | 20xx-xx-xx |
| 4.1.4 | PurchaseReceiptDetail实体 | ✅ | - | 20xx-xx-xx |
| 4.1.5 | PurchaseReturn实体 | ✅ | - | 20xx-xx-xx |
| 4.1.6 | PurchaseReturnDetail实体 | ✅ | - | 20xx-xx-xx |

### 4.2 DTO对象层 (17/17)

| 序号 | 任务名称 | 状态 | 负责人 | 完成时间 |
|------|----------|------|--------|----------|
| 4.2.1 | OrderCreateDTO | ✅ | - | 20xx-xx-xx |
| 4.2.2 | OrderUpdateDTO | ✅ | - | 20xx-xx-xx |
| 4.2.3 | OrderQueryDTO | ✅ | - | 20xx-xx-xx |
| 4.2.4 | OrderDTO | ✅ | - | 20xx-xx-xx |
| 4.2.5 | OrderDetailDTO | ✅ | - | 20xx-xx-xx |
| 4.2.6 | ReceiptCreateDTO | ✅ | - | 20xx-xx-xx |
| 4.2.7 | ReceiptQueryDTO | ✅ | - | 20xx-xx-xx |
| 4.2.8 | ReceiptDTO | ✅ | - | 20xx-xx-xx |
| 4.2.9 | ReceiptDetailDTO | ✅ | - | 20xx-xx-xx |
| 4.2.10 | ReturnCreateDTO | ✅ | - | 20xx-xx-xx |
| 4.2.11 | ReturnQueryDTO | ✅ | - | 20xx-xx-xx |
| 4.2.12 | ReturnDTO | ✅ | - | 20xx-xx-xx |
| 4.2.13 | ReturnDetailDTO | ✅ | - | 20xx-xx-xx |
| 4.2.14 | OrderDetailCreateDTO | ✅ | - | 20xx-xx-xx |
| 4.2.15 | ReceiptDetailCreateDTO | ✅ | - | 20xx-xx-xx |
| 4.2.16 | ReturnDetailCreateDTO | ✅ | - | 20xx-xx-xx |
| 4.2.17 | RejectReasonDTO | ✅ | - | 20xx-xx-xx |

### 4.3 Mapper持久层 (6/6)

| 序号 | 任务名称 | 状态 | 负责人 | 完成时间 |
|------|----------|------|--------|----------|
| 4.3.1 | PurchaseOrderMapper | ✅ | - | 20xx-xx-xx |
| 4.3.2 | PurchaseOrderDetailMapper | ✅ | - | 20xx-xx-xx |
| 4.3.3 | PurchaseReceiptMapper | ✅ | - | 20xx-xx-xx |
| 4.3.4 | PurchaseReceiptDetailMapper | ✅ | - | 20xx-xx-xx |
| 4.3.5 | PurchaseReturnMapper | ✅ | - | 20xx-xx-xx |
| 4.3.6 | PurchaseReturnDetailMapper | ✅ | - | 20xx-xx-xx |

### 4.4 Service业务层 (9/9)

| 序号 | 任务名称 | 状态 | 负责人 | 完成时间 |
|------|----------|------|--------|----------|
| 4.4.1 | PurchaseOrderService | ✅ | - | 20xx-xx-xx |
| 4.4.2 | PurchaseOrderServiceImpl | ✅ | - | 20xx-xx-xx |
| 4.4.3 | PurchaseReceiptService | ✅ | - | 20xx-xx-xx |
| 4.4.4 | PurchaseReceiptServiceImpl | ✅ | - | 20xx-xx-xx |
| 4.4.5 | PurchaseReturnService | ✅ | - | 20xx-xx-xx |
| 4.4.6 | PurchaseReturnServiceImpl | ✅ | - | 20xx-xx-xx |
| 4.4.7 | 订单状态机处理 | ✅ | - | 20xx-xx-xx |
| 4.4.8 | 入库库存联动 | ✅ | - | 20xx-xx-xx |
| 4.4.9 | 退货库存联动 | ✅ | - | 20xx-xx-xx |

### 4.5 Controller控制层 (3/3)

| 序号 | 任务名称 | 状态 | 负责人 | 完成时间 |
|------|----------|------|--------|----------|
| 4.5.1 | PurchaseOrderController | ✅ | - | 20xx-xx-xx |
| 4.5.2 | PurchaseReceiptController | ✅ | - | 20xx-xx-xx |
| 4.5.3 | PurchaseReturnController | ✅ | - | 20xx-xx-xx |

---

## 五、测试 (0/6)

| 序号 | 任务名称 | 状态 | 负责人 | 完成时间 |
|------|----------|------|--------|----------|
| 5.1 | 单元测试 | ⏳ | - | - |
| 5.2 | 集成测试 | ⏳ | - | - |
| 5.3 | 订单流程测试 | ⏳ | - | - |
| 5.4 | 入库流程测试 | ⏳ | - | - |
| 5.5 | 退货流程测试 | ⏳ | - | - |
| 5.6 | 库存联动测试 | ⏳ | - | - |

---

## 六、文档 (7/7)

| 序号 | 任务名称 | 状态 | 负责人 | 完成时间 |
|------|----------|------|--------|----------|
| 6.1 | 业务设计文档 | ✅ | - | 20xx-xx-xx |
| 6.2 | 应用设计文档 | ✅ | - | 20xx-xx-xx |
| 6.3 | 数据设计文档 | ✅ | - | 20xx-xx-xx |
| 6.4 | API接口文档 | ✅ | - | 20xx-xx-xx |
| 6.5 | 技术设计文档 | ✅ | - | 20xx-xx-xx |
| 6.6 | 数据库脚本 | ✅ | - | 20xx-xx-xx |
| 6.7 | 开发进度跟踪 | ✅ | - | 20xx-xx-xx |

---

## 功能清单

### 已完成功能
- [x] 业务设计文档
- [x] 应用设计文档
- [x] 数据设计文档
- [x] API接口文档
- [x] 技术设计文档
- [x] 数据库脚本
- [x] 开发进度跟踪文档

### 已完成代码
- [x] 基础框架（启动类、配置文件）
- [x] Entity实体层（6个）
- [x] DTO对象层（17个）
- [x] Mapper持久层（6个）
- [x] Service业务层（9个）
- [x] Controller控制层（3个）
- [x] FeignClient外部服务调用（3个）

### 待开发功能

#### 基础框架
1. 启动类创建
2. 配置文件编写
3. 统一响应对象引用（qooerp-common）
4. 分页查询对象引用（qooerp-common）
5. 全局异常处理器引用（qooerp-common）
6. 业务异常类引用（qooerp-common）
7. 跨域配置（使用qooerp-gateway网关层配置）
8. 外部服务FeignClient

#### 采购订单管理
1. 订单创建、编辑、删除
2. 订单提交审核、审核通过、驳回
3. 订单取消、完成
4. 订单列表查询、详情查询
5. 订单状态流转控制

#### 采购入库管理
1. 入库单创建（关联订单）
2. 入库单审核、取消
3. 入库单列表查询、详情查询
4. 入库库存联动更新
5. 批次管理（生产日期、有效期）

#### 采购退货管理
1. 退货单创建（关联订单/入库单）
2. 退货单审核、完成、取消
3. 退货单列表查询、详情查询
4. 退货库存联动更新

---

## 技术栈

| 技术 | 版本 |
|------|------|
| Java | 17 |
| Spring Boot | 3.2.x |
| Spring Cloud | 2023.x |
| Nacos | 2.x |
| MyBatis Plus | 3.5.x |
| PostgreSQL | 15+ |
| Redis | 7.x |

---

## 外部依赖

### 库存服务接口
- POST /api/inventory/increase - 增加库存（入库时）
- POST /api/inventory/decrease - 扣减库存（退货时）
- GET /api/inventory/query - 查询可用库存

### 物料服务接口
- GET /api/material/{id} - 查询物料信息
- POST /api/material/batch - 批量查询物料

### 仓库服务接口
- GET /api/warehouse/{id} - 查询仓库信息

---

## 文件清单

### Entity实体层 (6/6个文件)
✅ PurchaseOrder.java
✅ PurchaseOrderDetail.java
✅ PurchaseReceipt.java
✅ PurchaseReceiptDetail.java
✅ PurchaseReturn.java
✅ PurchaseReturnDetail.java

### DTO对象层 (17/17个文件)
✅ OrderCreateDTO, OrderUpdateDTO, OrderQueryDTO, OrderDTO, OrderDetailDTO, OrderDetailCreateDTO
✅ ReceiptCreateDTO, ReceiptQueryDTO, ReceiptDTO, ReceiptDetailDTO, ReceiptDetailCreateDTO
✅ ReturnCreateDTO, ReturnQueryDTO, ReturnDTO, ReturnDetailDTO, ReturnDetailCreateDTO
✅ RejectReasonDTO

### Mapper持久层 (6/6个文件)
✅ PurchaseOrderMapper
✅ PurchaseOrderDetailMapper
✅ PurchaseReceiptMapper
✅ PurchaseReceiptDetailMapper
✅ PurchaseReturnMapper
✅ PurchaseReturnDetailMapper

### Service业务层 (6/6个文件)
✅ PurchaseOrderService + PurchaseOrderServiceImpl
✅ PurchaseReceiptService + PurchaseReceiptServiceImpl
✅ PurchaseReturnService + PurchaseReturnServiceImpl

### Controller控制层 (3/3个文件)
✅ PurchaseOrderController
✅ PurchaseReceiptController
✅ PurchaseReturnController

### 配置和启动类 (3/3个文件)
✅ PurchaseApplication.java
✅ application.yml
✅ 数据库脚本已存在

### 框架组件 (3/3个文件)
✅ InventoryFeignClient.java - 库存服务调用
✅ MaterialFeignClient.java - 物料服务调用
✅ WarehouseFeignClient.java - 仓库服务调用

### 通用组件（使用qooerp-common）
✅ Result.java - 统一响应对象（qooerp-common提供）
✅ PageResult.java - 分页结果对象（qooerp-common提供）
✅ GlobalExceptionHandler.java - 全局异常处理器（qooerp-common提供）
✅ BusinessException.java - 业务异常类（qooerp-common提供）

### 网关层配置（qooerp-gateway提供）
✅ CrossOriginConfig.java - 跨域配置（网关层统一处理）

---

## 核心业务规则

### 采购订单规则
1. 草稿状态订单可编辑、删除
2. 提交审核后进入待审核状态
3. 审核通过后进入已审核状态，可创建入库单
4. 入库完成后订单进入已完成状态
5. 已审核前可取消订单

### 采购入库规则
1. 入库单必须关联已审核的采购订单
2. 入库数量不能超过订单未收货数量
3. 入库单审核后更新库存和订单收货数量
4. 入库单取消后回滚库存和订单收货数量

### 采购退货规则
1. 退货单可关联订单或入库单
2. 退货数量不能超过已入库数量
3. 退货单审核通过后扣减库存
4. 退货单完成需确认退款或换货

---

## 接口清单

### 订单管理接口 (10个)
| 接口 | 方法 | 路径 |
|------|------|------|
| 创建订单 | POST | /api/purchase/orders |
| 更新订单 | PUT | /api/purchase/orders/{id} |
| 删除订单 | DELETE | /api/purchase/orders/{id} |
| 提交审核 | POST | /api/purchase/orders/{id}/submit |
| 审核订单 | POST | /api/purchase/orders/{id}/approve |
| 驳回订单 | POST | /api/purchase/orders/{id}/reject |
| 取消订单 | POST | /api/purchase/orders/{id}/cancel |
| 完成订单 | POST | /api/purchase/orders/{id}/complete |
| 获取详情 | GET | /api/purchase/orders/{id} |
| 分页查询 | GET | /api/purchase/orders |

### 入库管理接口 (6个)
| 接口 | 方法 | 路径 |
|------|------|------|
| 创建入库单 | POST | /api/purchase/receipts |
| 删除入库单 | DELETE | /api/purchase/receipts/{id} |
| 审核入库单 | POST | /api/purchase/receipts/{id}/approve |
| 取消入库单 | POST | /api/purchase/receipts/{id}/cancel |
| 获取详情 | GET | /api/purchase/receipts/{id} |
| 分页查询 | GET | /api/purchase/receipts |

### 退货管理接口 (7个)
| 接口 | 方法 | 路径 |
|------|------|------|
| 创建退货单 | POST | /api/purchase/returns |
| 删除退货单 | DELETE | /api/purchase/returns/{id} |
| 审核退货单 | POST | /api/purchase/returns/{id}/approve |
| 完成退货 | POST | /api/purchase/returns/{id}/complete |
| 取消退货单 | POST | /api/purchase/returns/{id}/cancel |
| 获取详情 | GET | /api/purchase/returns/{id} |
| 分页查询 | GET | /api/purchase/returns |

---

## 备注

- 所有实体类支持逻辑删除（deleted字段）
- 所有接口支持租户隔离（tenant_id字段）
- 订单、入库单、退货单均需生成唯一编码
- 入库和退货需与库存模块联动
- 支持批次管理（生产日期、有效期）
- 订单支持部分收货

## 待办事项

### 高优先级
- 完成基础框架搭建（启动类、配置文件）
- 完成Entity实体层
- 完成DTO对象层
- 完成Mapper持久层
- 完成Service业务层
- 完成Controller控制层
- 编写单元测试

### 中优先级
- 实现库存联动逻辑
- 实现订单状态机
- 实现批量操作接口

### 低优先级
- 性能优化
- 日志完善
- 监控指标

---

**文档版本**: v3.0
**最后更新**: 20xx-xx-xx
**说明**: 基础代码开发完成（92%），待测试和库存联动集成
