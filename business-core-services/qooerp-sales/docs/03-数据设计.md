# QooERP 销售管理 - 数据设计文档

> 版本：v1.0
> 创建日期：2026-02-17
> 数据库：qooerp_sales

---

## 一、核心表设计

### 1.1 sales_quotation（销售报价表）

```sql
CREATE TABLE sales_quotation (
    id BIGSERIAL NOT NULL,
    tenant_id BIGINT NOT NULL DEFAULT 0,
    quotation_code VARCHAR(32) NOT NULL,
    customer_id BIGINT NOT NULL,
    customer_name VARCHAR(128) NOT NULL,
    quotation_date DATE NOT NULL,
    valid_until DATE NOT NULL,
    quotation_amount DECIMAL(18,2) NOT NULL DEFAULT 0.00,
    discount_amount DECIMAL(18,2) NOT NULL DEFAULT 0.00,
    payable_amount DECIMAL(18,2) NOT NULL DEFAULT 0.00,
    quotation_status VARCHAR(20) NOT NULL DEFAULT 'DRAFT',
    salesperson_id BIGINT DEFAULT NULL,
    salesperson_name VARCHAR(64),
    remark VARCHAR(512),
    created_by BIGINT DEFAULT NULL,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_by BIGINT DEFAULT NULL,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted SMALLINT NOT NULL DEFAULT 0,
    version INTEGER NOT NULL DEFAULT 0,
    PRIMARY KEY (id),
    UNIQUE INDEX uk_quotation_code (tenant_id, quotation_code),
    INDEX idx_customer_id (customer_id),
    INDEX idx_quotation_status (quotation_status),
    INDEX idx_deleted (deleted),
    INDEX idx_tenant_id (tenant_id)
);
```

### 1.2 sales_quotation_detail（报价明细表）

```sql
CREATE TABLE sales_quotation_detail (
    id BIGSERIAL NOT NULL,
    tenant_id BIGINT NOT NULL DEFAULT 0,
    quotation_id BIGINT NOT NULL,
    material_id BIGINT NOT NULL,
    material_code VARCHAR(32) NOT NULL,
    material_name VARCHAR(128) NOT NULL,
    specification VARCHAR(128),
    unit VARCHAR(20),
    quantity DECIMAL(10,2) NOT NULL,
    unit_price DECIMAL(18,2) NOT NULL,
    amount DECIMAL(18,2) NOT NULL,
    discount_rate DECIMAL(5,2) DEFAULT 0.00,
    discount_amount DECIMAL(18,2) DEFAULT 0.00,
    payable_amount DECIMAL(18,2) NOT NULL,
    remark VARCHAR(512),
    created_by BIGINT DEFAULT NULL,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_by BIGINT DEFAULT NULL,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted SMALLINT NOT NULL DEFAULT 0,
    PRIMARY KEY (id),
    INDEX idx_quotation_id (quotation_id),
    INDEX idx_material_id (material_id),
    INDEX idx_deleted (deleted),
    INDEX idx_tenant_id (tenant_id)
);
```

### 1.3 sales_contract（销售合同表）

```sql
CREATE TABLE sales_contract (
    id BIGSERIAL NOT NULL,
    tenant_id BIGINT NOT NULL DEFAULT 0,
    contract_code VARCHAR(32) NOT NULL,
    customer_id BIGINT NOT NULL,
    customer_name VARCHAR(128) NOT NULL,
    contract_date DATE NOT NULL,
    effective_date DATE NOT NULL,
    expiry_date DATE NOT NULL,
    contract_amount DECIMAL(18,2) NOT NULL DEFAULT 0.00,
    discount_amount DECIMAL(18,2) NOT NULL DEFAULT 0.00,
    payable_amount DECIMAL(18,2) NOT NULL DEFAULT 0.00,
    contract_status VARCHAR(20) NOT NULL DEFAULT 'DRAFT',
    salesperson_id BIGINT DEFAULT NULL,
    salesperson_name VARCHAR(64),
    warehouse_id BIGINT DEFAULT NULL,
    warehouse_name VARCHAR(64),
    remark VARCHAR(512),
    created_by BIGINT DEFAULT NULL,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_by BIGINT DEFAULT NULL,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted SMALLINT NOT NULL DEFAULT 0,
    version INTEGER NOT NULL DEFAULT 0,
    PRIMARY KEY (id),
    UNIQUE INDEX uk_contract_code (tenant_id, contract_code),
    INDEX idx_customer_id (customer_id),
    INDEX idx_contract_status (contract_status),
    INDEX idx_deleted (deleted),
    INDEX idx_tenant_id (tenant_id)
);
```

### 1.4 sales_contract_detail（合同明细表）

```sql
CREATE TABLE sales_contract_detail (
    id BIGSERIAL NOT NULL,
    tenant_id BIGINT NOT NULL DEFAULT 0,
    contract_id BIGINT NOT NULL,
    material_id BIGINT NOT NULL,
    material_code VARCHAR(32) NOT NULL,
    material_name VARCHAR(128) NOT NULL,
    specification VARCHAR(128),
    unit VARCHAR(20),
    quantity DECIMAL(10,2) NOT NULL,
    unit_price DECIMAL(18,2) NOT NULL,
    amount DECIMAL(18,2) NOT NULL,
    discount_rate DECIMAL(5,2) DEFAULT 0.00,
    discount_amount DECIMAL(18,2) DEFAULT 0.00,
    payable_amount DECIMAL(18,2) NOT NULL,
    remark VARCHAR(512),
    created_by BIGINT DEFAULT NULL,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_by BIGINT DEFAULT NULL,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted SMALLINT NOT NULL DEFAULT 0,
    PRIMARY KEY (id),
    INDEX idx_contract_id (contract_id),
    INDEX idx_material_id (material_id),
    INDEX idx_deleted (deleted),
    INDEX idx_tenant_id (tenant_id)
);
```

### 1.5 sales_order（销售订单表）

```sql
CREATE TABLE sales_order (
    id BIGSERIAL NOT NULL,
    tenant_id BIGINT NOT NULL DEFAULT 0,
    order_code VARCHAR(32) NOT NULL,
    customer_id BIGINT NOT NULL,
    customer_name VARCHAR(128) NOT NULL,
    order_date DATE NOT NULL,
    delivery_date DATE NOT NULL,
    order_amount DECIMAL(18,2) NOT NULL DEFAULT 0.00,
    discount_amount DECIMAL(18,2) NOT NULL DEFAULT 0.00,
    payable_amount DECIMAL(18,2) NOT NULL DEFAULT 0.00,
    order_status VARCHAR(20) NOT NULL DEFAULT 'DRAFT',
    order_type VARCHAR(20) NOT NULL DEFAULT 'NORMAL',
    salesperson_id BIGINT DEFAULT NULL,
    salesperson_name VARCHAR(64),
    warehouse_id BIGINT DEFAULT NULL,
    warehouse_name VARCHAR(64),
    remark VARCHAR(512),
    created_by BIGINT DEFAULT NULL,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_by BIGINT DEFAULT NULL,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted SMALLINT NOT NULL DEFAULT 0,
    version INTEGER NOT NULL DEFAULT 0,
    PRIMARY KEY (id),
    UNIQUE INDEX uk_order_code (tenant_id, order_code),
    INDEX idx_customer_id (customer_id),
    INDEX idx_order_status (order_status),
    INDEX idx_deleted (deleted),
    INDEX idx_tenant_id (tenant_id)
);
```

### 1.6 sales_order_detail（订单明细表）

```sql
CREATE TABLE sales_order_detail (
    id BIGSERIAL NOT NULL,
    tenant_id BIGINT NOT NULL DEFAULT 0,
    order_id BIGINT NOT NULL,
    material_id BIGINT NOT NULL,
    material_code VARCHAR(32) NOT NULL,
    material_name VARCHAR(128) NOT NULL,
    specification VARCHAR(128),
    unit VARCHAR(20),
    quantity DECIMAL(10,2) NOT NULL,
    unit_price DECIMAL(18,2) NOT NULL,
    amount DECIMAL(18,2) NOT NULL,
    discount_rate DECIMAL(5,2) DEFAULT 0.00,
    discount_amount DECIMAL(18,2) DEFAULT 0.00,
    payable_amount DECIMAL(18,2) NOT NULL,
    shipped_quantity DECIMAL(10,2) NOT NULL DEFAULT 0.00,
    remark VARCHAR(512),
    created_by BIGINT DEFAULT NULL,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_by BIGINT DEFAULT NULL,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted SMALLINT NOT NULL DEFAULT 0,
    PRIMARY KEY (id),
    INDEX idx_order_id (order_id),
    INDEX idx_material_id (material_id),
    INDEX idx_deleted (deleted),
    INDEX idx_tenant_id (tenant_id)
);
```

### 1.7 sales_delivery（发货单表）

```sql
CREATE TABLE sales_delivery (
    id BIGSERIAL NOT NULL,
    tenant_id BIGINT NOT NULL DEFAULT 0,
    delivery_code VARCHAR(32) NOT NULL,
    order_id BIGINT NOT NULL,
    order_code VARCHAR(32),
    customer_id BIGINT NOT NULL,
    customer_name VARCHAR(128) NOT NULL,
    delivery_date DATE NOT NULL,
    delivery_amount DECIMAL(18,2) NOT NULL,
    logistics_id BIGINT DEFAULT NULL,
    delivery_status VARCHAR(20) NOT NULL DEFAULT 'PENDING',
    remark VARCHAR(512),
    created_by BIGINT DEFAULT NULL,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_by BIGINT DEFAULT NULL,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted SMALLINT NOT NULL DEFAULT 0,
    version INTEGER NOT NULL DEFAULT 0,
    PRIMARY KEY (id),
    UNIQUE INDEX uk_delivery_code (tenant_id, delivery_code),
    INDEX idx_order_id (order_id),
    INDEX idx_customer_id (customer_id),
    INDEX idx_delivery_status (delivery_status),
    INDEX idx_deleted (deleted),
    INDEX idx_tenant_id (tenant_id)
);
```

### 1.8 sales_delivery_detail（发货明细表）

```sql
CREATE TABLE sales_delivery_detail (
    id BIGSERIAL NOT NULL,
    tenant_id BIGINT NOT NULL DEFAULT 0,
    delivery_id BIGINT NOT NULL,
    order_detail_id BIGINT NOT NULL,
    material_id BIGINT NOT NULL,
    material_code VARCHAR(32) NOT NULL,
    material_name VARCHAR(128) NOT NULL,
    quantity DECIMAL(10,2) NOT NULL,
    unit_price DECIMAL(18,2) NOT NULL,
    amount DECIMAL(18,2) NOT NULL,
    remark VARCHAR(512),
    created_by BIGINT DEFAULT NULL,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_by BIGINT DEFAULT NULL,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted SMALLINT NOT NULL DEFAULT 0,
    PRIMARY KEY (id),
    INDEX idx_delivery_id (delivery_id),
    INDEX idx_material_id (material_id),
    INDEX idx_deleted (deleted),
    INDEX idx_tenant_id (tenant_id)
);
```

### 1.9 sales_return（退货单表）

```sql
CREATE TABLE sales_return (
    id BIGSERIAL NOT NULL,
    tenant_id BIGINT NOT NULL DEFAULT 0,
    return_code VARCHAR(32) NOT NULL,
    order_id BIGINT NOT NULL,
    order_code VARCHAR(32),
    delivery_id BIGINT DEFAULT NULL,
    customer_id BIGINT NOT NULL,
    customer_name VARCHAR(128) NOT NULL,
    return_date DATE NOT NULL,
    return_amount DECIMAL(18,2) NOT NULL,
    reason VARCHAR(512),
    return_status VARCHAR(20) NOT NULL DEFAULT 'PENDING',
    remark VARCHAR(512),
    created_by BIGINT DEFAULT NULL,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_by BIGINT DEFAULT NULL,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted SMALLINT NOT NULL DEFAULT 0,
    version INTEGER NOT NULL DEFAULT 0,
    PRIMARY KEY (id),
    UNIQUE INDEX uk_return_code (tenant_id, return_code),
    INDEX idx_order_id (order_id),
    INDEX idx_customer_id (customer_id),
    INDEX idx_return_status (return_status),
    INDEX idx_deleted (deleted),
    INDEX idx_tenant_id (tenant_id)
);
```

### 1.10 sales_return_detail（退货明细表）

```sql
CREATE TABLE sales_return_detail (
    id BIGSERIAL NOT NULL,
    tenant_id BIGINT NOT NULL DEFAULT 0,
    return_id BIGINT NOT NULL,
    material_id BIGINT NOT NULL,
    material_code VARCHAR(32) NOT NULL,
    material_name VARCHAR(128) NOT NULL,
    quantity DECIMAL(10,2) NOT NULL,
    unit_price DECIMAL(18,2) NOT NULL,
    amount DECIMAL(18,2) NOT NULL,
    remark VARCHAR(512),
    created_by BIGINT DEFAULT NULL,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_by BIGINT DEFAULT NULL,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted SMALLINT NOT NULL DEFAULT 0,
    PRIMARY KEY (id),
    INDEX idx_return_id (return_id),
    INDEX idx_material_id (material_id),
    INDEX idx_deleted (deleted),
    INDEX idx_tenant_id (tenant_id)
);
```

### 1.11 sales_receipt（收款单表）

```sql
CREATE TABLE sales_receipt (
    id BIGSERIAL NOT NULL,
    tenant_id BIGINT NOT NULL DEFAULT 0,
    receipt_code VARCHAR(32) NOT NULL,
    customer_id BIGINT NOT NULL,
    customer_name VARCHAR(128) NOT NULL,
    receipt_date DATE NOT NULL,
    receipt_amount DECIMAL(18,2) NOT NULL,
    payment_method VARCHAR(20) NOT NULL,
    payment_account VARCHAR(64),
    receipt_status VARCHAR(20) NOT NULL DEFAULT 'DRAFT',
    remark VARCHAR(512),
    created_by BIGINT DEFAULT NULL,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_by BIGINT DEFAULT NULL,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted SMALLINT NOT NULL DEFAULT 0,
    version INTEGER NOT NULL DEFAULT 0,
    PRIMARY KEY (id),
    UNIQUE INDEX uk_receipt_code (tenant_id, receipt_code),
    INDEX idx_customer_id (customer_id),
    INDEX idx_receipt_status (receipt_status),
    INDEX idx_deleted (deleted),
    INDEX idx_tenant_id (tenant_id)
);
```

### 1.12 sales_receipt_detail（收款明细表）

```sql
CREATE TABLE sales_receipt_detail (
    id BIGSERIAL NOT NULL,
    tenant_id BIGINT NOT NULL DEFAULT 0,
    receipt_id BIGINT NOT NULL,
    order_id BIGINT NOT NULL,
    order_code VARCHAR(32) NOT NULL,
    writeoff_amount DECIMAL(18,2) NOT NULL,
    remaining_amount DECIMAL(18,2) NOT NULL,
    remark VARCHAR(512),
    created_by BIGINT DEFAULT NULL,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_by BIGINT DEFAULT NULL,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted SMALLINT NOT NULL DEFAULT 0,
    PRIMARY KEY (id),
    INDEX idx_receipt_id (receipt_id),
    INDEX idx_order_id (order_id),
    INDEX idx_deleted (deleted),
    INDEX idx_tenant_id (tenant_id)
);
```

### 1.13 customer_credit（客户信用表）

```sql
CREATE TABLE customer_credit (
    id BIGSERIAL NOT NULL,
    tenant_id BIGINT NOT NULL DEFAULT 0,
    customer_id BIGINT NOT NULL,
    customer_name VARCHAR(128) NOT NULL,
    credit_limit DECIMAL(18,2) NOT NULL DEFAULT 0.00,
    credit_used DECIMAL(18,2) NOT NULL DEFAULT 0.00,
    credit_available DECIMAL(18,2) GENERATED ALWAYS AS (credit_limit - credit_used) STORED,
    credit_level VARCHAR(20) NOT NULL DEFAULT 'NORMAL',
    credit_status VARCHAR(20) NOT NULL DEFAULT 'ACTIVE',
    remark VARCHAR(512),
    created_by BIGINT DEFAULT NULL,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_by BIGINT DEFAULT NULL,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted SMALLINT NOT NULL DEFAULT 0,
    version INTEGER NOT NULL DEFAULT 0,
    PRIMARY KEY (id),
    UNIQUE INDEX uk_customer_id (tenant_id, customer_id),
    INDEX idx_credit_level (credit_level),
    INDEX idx_deleted (deleted),
    INDEX idx_tenant_id (tenant_id)
);
```

---

*文档维护：请保持此文档的及时更新*
