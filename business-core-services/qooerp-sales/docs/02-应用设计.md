# QooERP 销售管理 - 应用设计文档

> 版本：v1.0
> 创建日期：20xx-xx-xx

---

## 一、核心实体设计

### 1.1 SalesQuotation（销售报价实体）

```java
package com.qoobot.qooerp.sales.quotation.domain;

import com.qoobot.qooerp.common.entity.BaseEntity;
import lombok.Data;
import lombok.EqualsAndHashCode;
import java.math.BigDecimal;
import java.time.LocalDate;

/**
 * 销售报价实体
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class SalesQuotation extends BaseEntity {

    /** 报价单编号 */
    private String quotationCode;

    /** 客户ID */
    private Long customerId;

    /** 客户名称 */
    private String customerName;

    /** 报价日期 */
    private LocalDate quotationDate;

    /** 有效期至 */
    private LocalDate validUntil;

    /** 报价金额 */
    private BigDecimal quotationAmount;

    /** 折扣金额 */
    private BigDecimal discountAmount;

    /** 实付金额 */
    private BigDecimal payableAmount;

    /** 报价状态 */
    private String quotationStatus; // DRAFT, PENDING, APPROVED, SENT, EXPIRED, CONVERTED, CANCELLED

    /** 销售员ID */
    private Long salespersonId;

    /** 销售员姓名 */
    private String salespersonName;

    /** 备注 */
    private String remark;
}
```

### 1.2 SalesQuotationDetail（报价明细实体）

```java
package com.qoobot.qooerp.sales.quotation.domain;

import com.qoobot.qooerp.common.entity.BaseEntity;
import lombok.Data;
import lombok.EqualsAndHashCode;
import java.math.BigDecimal;

/**
 * 销售报价明细实体
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class SalesQuotationDetail extends BaseEntity {

    /** 报价单ID */
    private Long quotationId;

    /** 物料ID */
    private Long materialId;

    /** 物料编码 */
    private String materialCode;

    /** 物料名称 */
    private String materialName;

    /** 规格型号 */
    private String specification;

    /** 计量单位 */
    private String unit;

    /** 数量 */
    private BigDecimal quantity;

    /** 单价 */
    private BigDecimal unitPrice;

    /** 金额 */
    private BigDecimal amount;

    /** 折扣率 */
    private BigDecimal discountRate;

    /** 折扣金额 */
    private BigDecimal discountAmount;

    /** 实付金额 */
    private BigDecimal payableAmount;

    /** 备注 */
    private String remark;
}
```

### 1.3 SalesContract（销售合同实体）

```java
package com.qoobot.qooerp.sales.contract.domain;

import com.qoobot.qooerp.common.entity.BaseEntity;
import lombok.Data;
import lombok.EqualsAndHashCode;
import java.math.BigDecimal;
import java.time.LocalDate;

/**
 * 销售合同实体
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class SalesContract extends BaseEntity {

    /** 合同编号 */
    private String contractCode;

    /** 客户ID */
    private Long customerId;

    /** 客户名称 */
    private String customerName;

    /** 合同日期 */
    private LocalDate contractDate;

    /** 生效日期 */
    private LocalDate effectiveDate;

    /** 到期日期 */
    private LocalDate expiryDate;

    /** 合同金额 */
    private BigDecimal contractAmount;

    /** 折扣金额 */
    private BigDecimal discountAmount;

    /** 实付金额 */
    private BigDecimal payableAmount;

    /** 合同状态 */
    private String contractStatus; // DRAFT, PENDING, APPROVED, ACTIVE, EXPIRED, TERMINATED, CANCELLED

    /** 销售员ID */
    private Long salespersonId;

    /** 销售员姓名 */
    private String salespersonName;

    /** 仓库ID */
    private Long warehouseId;

    /** 仓库名称 */
    private String warehouseName;

    /** 备注 */
    private String remark;
}
```

### 1.4 SalesContractDetail（合同明细实体）

```java
package com.qoobot.qooerp.sales.contract.domain;

import com.qoobot.qooerp.common.entity.BaseEntity;
import lombok.Data;
import lombok.EqualsAndHashCode;
import java.math.BigDecimal;

/**
 * 销售合同明细实体
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class SalesContractDetail extends BaseEntity {

    /** 合同ID */
    private Long contractId;

    /** 物料ID */
    private Long materialId;

    /** 物料编码 */
    private String materialCode;

    /** 物料名称 */
    private String materialName;

    /** 规格型号 */
    private String specification;

    /** 计量单位 */
    private String unit;

    /** 数量 */
    private BigDecimal quantity;

    /** 单价 */
    private BigDecimal unitPrice;

    /** 金额 */
    private BigDecimal amount;

    /** 折扣率 */
    private BigDecimal discountRate;

    /** 折扣金额 */
    private BigDecimal discountAmount;

    /** 实付金额 */
    private BigDecimal payableAmount;

    /** 备注 */
    private String remark;
}
```

### 1.5 SalesOrder（销售订单实体）

```java
package com.qoobot.qooerp.sales.order.domain;

import com.qoobot.qooerp.common.entity.BaseEntity;
import lombok.Data;
import lombok.EqualsAndHashCode;
import java.math.BigDecimal;
import java.time.LocalDate;

/**
 * 销售订单实体
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class SalesOrder extends BaseEntity {

    /** 订单编号 */
    private String orderCode;

    /** 客户ID */
    private Long customerId;

    /** 客户名称 */
    private String customerName;

    /** 订单日期 */
    private LocalDate orderDate;

    /** 交货日期 */
    private LocalDate deliveryDate;

    /** 订单金额 */
    private BigDecimal orderAmount;

    /** 折扣金额 */
    private BigDecimal discountAmount;

    /** 实付金额 */
    private BigDecimal payableAmount;

    /** 订单状态 */
    private String orderStatus; // DRAFT, PENDING, APPROVED, SHIPPED, COMPLETED, CANCELLED

    /** 订单类型 */
    private String orderType; // NORMAL, RETURN, EXCHANGE

    /** 销售员ID */
    private Long salespersonId;

    /** 销售员姓名 */
    private String salespersonName;

    /** 仓库ID */
    private Long warehouseId;

    /** 仓库名称 */
    private String warehouseName;

    /** 备注 */
    private String remark;
}
```

### 1.6 SalesOrderDetail（订单明细实体）

```java
package com.qoobot.qooerp.sales.order.domain;

import com.qoobot.qooerp.common.entity.BaseEntity;
import lombok.Data;
import lombok.EqualsAndHashCode;
import java.math.BigDecimal;

/**
 * 销售订单明细实体
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class SalesOrderDetail extends BaseEntity {

    /** 订单ID */
    private Long orderId;

    /** 物料ID */
    private Long materialId;

    /** 物料编码 */
    private String materialCode;

    /** 物料名称 */
    private String materialName;

    /** 规格型号 */
    private String specification;

    /** 计量单位 */
    private String unit;

    /** 数量 */
    private BigDecimal quantity;

    /** 单价 */
    private BigDecimal unitPrice;

    /** 金额 */
    private BigDecimal amount;

    /** 折扣率 */
    private BigDecimal discountRate;

    /** 折扣金额 */
    private BigDecimal discountAmount;

    /** 实付金额 */
    private BigDecimal payableAmount;

    /** 已发货数量 */
    private BigDecimal shippedQuantity;

    /** 备注 */
    private String remark;
}
```

### 1.7 SalesReceipt（收款单实体）

```java
package com.qoobot.qooerp.sales.receipt.domain;

import com.qoobot.qooerp.common.entity.BaseEntity;
import lombok.Data;
import lombok.EqualsAndHashCode;
import java.math.BigDecimal;
import java.time.LocalDate;

/**
 * 收款单实体
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class SalesReceipt extends BaseEntity {

    /** 收款单编号 */
    private String receiptCode;

    /** 客户ID */
    private Long customerId;

    /** 客户名称 */
    private String customerName;

    /** 收款日期 */
    private LocalDate receiptDate;

    /** 收款金额 */
    private BigDecimal receiptAmount;

    /** 收款方式 */
    private String paymentMethod; // CASH, BANK_TRANSFER, ALIPAY, WECHAT, CREDIT_CARD, OTHER

    /** 收款账户 */
    private String paymentAccount;

    /** 收款状态 */
    private String receiptStatus; // DRAFT, PENDING, CONFIRMED, CANCELLED

    /** 备注 */
    private String remark;
}
```

### 1.8 SalesReceiptDetail（收款明细实体）

```java
package com.qoobot.qooerp.sales.receipt.domain;

import com.qoobot.qooerp.common.entity.BaseEntity;
import lombok.Data;
import lombok.EqualsAndHashCode;
import java.math.BigDecimal;

/**
 * 收款明细实体
 */
@Data
@EqualsAndHashCode(callSuper = true)
public class SalesReceiptDetail extends BaseEntity {

    /** 收款单ID */
    private Long receiptId;

    /** 订单ID */
    private Long orderId;

    /** 订单编号 */
    private String orderCode;

    /** 核销金额 */
    private BigDecimal writeoffAmount;

    /** 剩余未核销金额 */
    private BigDecimal remainingAmount;

    /** 备注 */
    private String remark;
}
```

---

## 二、核心服务接口

```java
public interface SalesQuotationService {
    Result<Long> createQuotation(QuotationDTO quotationDTO);
    Result<Void> approveQuotation(Long quotationId, Long approverId);
    Result<Void> sendQuotation(Long quotationId);
    Result<Long> convertToOrder(Long quotationId);
    Result<QuotationDTO> getQuotation(Long quotationId);
    Result<PageResult<QuotationDTO>> queryQuotations(QuotationQueryDTO queryDTO);
}

public interface SalesContractService {
    Result<Long> createContract(ContractDTO contractDTO);
    Result<Void> approveContract(Long contractId, Long approverId);
    Result<Void> activateContract(Long contractId);
    Result<Void> terminateContract(Long contractId, String reason);
    Result<ContractDTO> getContract(Long contractId);
    Result<PageResult<ContractDTO>> queryContracts(ContractQueryDTO queryDTO);
}

public interface SalesOrderService {
    Result<Long> createOrder(OrderDTO orderDTO);
    Result<Void> approveOrder(Long orderId, Long approverId);
    Result<Void> cancelOrder(Long orderId, String reason);
    Result<OrderDTO> getOrder(Long orderId);
    Result<PageResult<OrderDTO>> queryOrders(OrderQueryDTO queryDTO);
}

public interface SalesDeliveryService {
    Result<Long> createDelivery(DeliveryDTO deliveryDTO);
    Result<Void> shipDelivery(Long deliveryId);
    Result<Void> confirmReceipt(Long deliveryId);
    Result<DeliveryDTO> getDelivery(Long deliveryId);
    Result<PageResult<DeliveryDTO>> queryDeliveries(DeliveryQueryDTO queryDTO);
}

public interface SalesReturnService {
    Result<Long> createReturn(ReturnDTO returnDTO);
    Result<Void> approveReturn(Long returnId, Long approverId);
    Result<Void> processReturn(Long returnId);
    Result<ReturnDTO> getReturn(Long returnId);
    Result<PageResult<ReturnDTO>> queryReturns(ReturnQueryDTO queryDTO);
}

public interface SalesReceiptService {
    Result<Long> createReceipt(ReceiptDTO receiptDTO);
    Result<Void> confirmReceipt(Long receiptId);
    Result<Void> writeoff(Long receiptId, List<ReceiptDetailDTO> details);
    Result<ReceiptDTO> getReceipt(Long receiptId);
    Result<PageResult<ReceiptDTO>> queryReceipts(ReceiptQueryDTO queryDTO);
}

public interface CustomerCreditService {
    Result<Void> setCreditLimit(Long customerId, BigDecimal creditLimit);
    Result<BigDecimal> checkCredit(Long customerId, BigDecimal amount);
    Result<CustomerCreditDTO> getCustomerCredit(Long customerId);
    Result<Void> updateCreditUsed(Long customerId, BigDecimal amount);
}
```

---

*文档维护：请保持此文档的及时更新*
