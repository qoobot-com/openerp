<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qoobot.qooerp.file.mapper.FileInfoMapper">

    <select id="selectByMd5" resultType="com.qoobot.qooerp.file.entity.FileInfo">
        SELECT * FROM file_info
        WHERE file_md5 = #{fileMd5}
          AND tenant_id = #{tenantId}
          AND deleted = 0
        LIMIT 1
    </select>

    <select id="selectByFolderId" resultType="com.qoobot.qooerp.file.entity.FileInfo">
        SELECT * FROM file_info
        WHERE folder_id = #{folderId}
          AND tenant_id = #{tenantId}
          AND deleted = 0
        ORDER BY create_time DESC
    </select>

    <select id="countByFileType" resultType="map">
        SELECT file_type AS file_type, COUNT(*) AS count
        FROM file_info
        WHERE tenant_id = #{tenantId}
          AND deleted = 0
        GROUP BY file_type
    </select>

    <select id="countTodayUploads" resultType="long">
        SELECT COUNT(*) FROM file_info
        WHERE tenant_id = #{tenantId}
          AND DATE(create_time) = CURRENT_DATE
          AND deleted = 0
    </select>

    <select id="countTodayDownloads" resultType="long">
        SELECT SUM(download_count) FROM file_info
        WHERE tenant_id = #{tenantId}
          AND DATE(update_time) = CURRENT_DATE
          AND deleted = 0
    </select>

</mapper>
