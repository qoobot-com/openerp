# QooERP 监控服务模块 - 开发进度跟踪

> 模块名称: qooerp-monitor
> 开始日期: 2026-02-17
> 目标版本: v2.0
> 架构变更: Prometheus + Grafana → qooerp-monitor + PostgreSQL + TimescaleDB + ECharts

## 一、总体进度

| 类别 | 总任务数 | 已完成 | 进行中 | 未开始 | 完成率 |
|------|---------|--------|--------|--------|--------|
| 设计文档 | 6 | 6 | 0 | 0 | 100% |
| 实体类 | 8 | 8 | 0 | 0 | 100% |
| DTO类 | 29 | 29 | 0 | 0 | 100% |
| Mapper接口 | 8 | 8 | 0 | 0 | 100% |
| Service接口 | 10 | 8 | 2 | 0 | 80% |
| Service实现 | 10 | 8 | 2 | 0 | 80% |
| Controller | 10 | 8 | 2 | 0 | 80% |
| OTLP接收器 | 3 | 0 | 0 | 3 | 0% |
| Metrics采集器 | 2 | 0 | 0 | 2 | 0% |
| 告警引擎 | 1 | 0 | 0 | 1 | 0% |
| 前端工程 | 4 | 0 | 0 | 4 | 0% |
| 配置文件 | 3 | 3 | 0 | 0 | 100% |
| 数据库脚本 | 1 | 1 | 0 | 0 | 100% |
| 测试用例 | 12 | 0 | 0 | 12 | 0% |
| **合计** | **106** | **79** | **4** | **23** | **75%** |

---

## 二、架构变更说明

### 2.1 原有架构（已废弃）
- Prometheus: 时序数据存储
- Grafana: 可视化面板
- 依赖外部 OpenTelemetry Collector

### 2.2 新架构（v2.0）
- **qooerp-monitor**: 自研监控微服务（OTLP 接收、Metrics 采集、告警引擎）
- **PostgreSQL + TimescaleDB**: 时序数据存储（超表、连续聚合）
- **Vue 3 + TDesign + ECharts**: 前端可视化（完全自研）

### 2.3 变更原因
1. Prometheus + Grafana 太重，需要额外安装工具
2. 学习曲线陡峭，配置复杂
3. 无法深度定制，与业务系统集成困难
4. 资源占用较大

---

## 三、设计文档开发进度

| 任务 | 状态 | 完成日期 | 备注 |
|------|------|----------|------|
| 01-业务设计.md | ✅ 已完成 | 2026-02-17 | 已更新 |
| 02-应用设计.md | ✅ 已完成 | 2026-02-17 | 已添加 OTLP、Metrics、Vue 前端接口 |
| 03-数据设计.md | ✅ 已完成 | 2026-02-17 | 已更新 TimescaleDB 超表 |
| 04-API接口文档.md | ✅ 已完成 | 2026-02-17 | 已添加 OTLP 接口 |
| 05-技术设计.md | ✅ 已完成 | 2026-02-18 | 新架构设计 |
| 05-数据库脚本.sql | ✅ 已完成 | 2026-02-18 | TimescaleDB 超表、连续聚合 |

---

## 四、实体类开发进度

| 序号 | 实体类 | 路径 | 状态 | 备注 |
|------|--------|------|------|------|
| 1 | MonitorService | entity/MonitorService.java | ✅ 已完成 | - |
| 2 | MonitorAlert | entity/MonitorAlert.java | ✅ 已完成 | - |
| 3 | MonitorAlertRule | entity/MonitorAlertRule.java | ✅ 已完成 | - |
| 4 | MonitorAlertChannel | entity/MonitorAlertChannel.java | ✅ 已完成 | - |
| 5 | MonitorAlertHandle | entity/MonitorAlertHandle.java | ✅ 已完成 | - |
| 6 | MonitorLog | entity/MonitorLog.java | ✅ 已完成 | - |
| 7 | MonitorMetrics | entity/MonitorMetrics.java | ✅ 已完成 | - |
| 8 | MonitorTrace | entity/MonitorTrace.java | ✅ 已完成 | - |

---

## 五、DTO类开发进度

### 5.1 服务相关DTO
| 序号 | DTO名称 | 路径 | 状态 |
|------|---------|------|------|
| 1 | MonitorServiceDTO | dto/MonitorServiceDTO.java | ✅ 已完成 |
| 2 | MonitorServiceCreateDTO | dto/MonitorServiceCreateDTO.java | ✅ 已完成 |
| 3 | MonitorServiceUpdateDTO | dto/MonitorServiceUpdateDTO.java | ✅ 已完成 |
| 4 | ServiceCheckDTO | dto/ServiceCheckDTO.java | ✅ 已完成 |
| 5 | ServiceStatusDTO | dto/ServiceStatusDTO.java | ✅ 已完成 |

### 5.2 告警相关DTO
| 序号 | DTO名称 | 路径 | 状态 |
|------|---------|------|------|
| 6 | MonitorAlertDTO | dto/MonitorAlertDTO.java | ✅ 已完成 |
| 7 | AlertQueryDTO | dto/AlertQueryDTO.java | ✅ 已完成 |
| 8 | AlertHandleDTO | dto/AlertHandleDTO.java | ✅ 已完成 |
| 9 | AlertStatisticsDTO | dto/AlertStatisticsDTO.java | ✅ 已完成 |
| 10 | AlertStatisticsQueryDTO | dto/AlertStatisticsQueryDTO.java | ✅ 已完成 |

### 5.3 告警规则相关DTO
| 序号 | DTO名称 | 路径 | 状态 |
|------|---------|------|------|
| 11 | AlertRuleDTO | dto/AlertRuleDTO.java | ✅ 已完成 |
| 12 | AlertRuleCreateDTO | dto/AlertRuleCreateDTO.java | ✅ 已完成 |
| 13 | AlertRuleUpdateDTO | dto/AlertRuleUpdateDTO.java | ✅ 已完成 |
| 14 | AlertRuleQueryDTO | dto/AlertRuleQueryDTO.java | ✅ 已完成 |

### 5.4 告警渠道相关DTO
| 序号 | DTO名称 | 路径 | 状态 |
|------|---------|------|------|
| 15 | AlertChannelDTO | dto/AlertChannelDTO.java | ✅ 已完成 |
| 16 | AlertChannelCreateDTO | dto/AlertChannelCreateDTO.java | ✅ 已完成 |
| 17 | AlertChannelUpdateDTO | dto/AlertChannelUpdateDTO.java | ✅ 已完成 |

### 5.5 日志相关DTO
| 序号 | DTO名称 | 路径 | 状态 |
|------|---------|------|------|
| 18 | MonitorLogDTO | dto/MonitorLogDTO.java | ✅ 已完成 |
| 19 | LogQueryDTO | dto/LogQueryDTO.java | ✅ 已完成 |

### 5.6 指标相关DTO
| 序号 | DTO名称 | 路径 | 状态 |
|------|---------|------|------|
| 20 | MonitorMetricsDTO | dto/MonitorMetricsDTO.java | ✅ 已完成 |
| 21 | MetricsQueryDTO | dto/MetricsQueryDTO.java | ✅ 已完成 |
| 22 | MetricsSummaryDTO | dto/MetricsSummaryDTO.java | ✅ 已完成 |
| 23 | MetricsSummaryQueryDTO | dto/MetricsSummaryQueryDTO.java | ✅ 已完成 |
| 24 | MetricsTrendDTO | dto/MetricsTrendDTO.java | ✅ 已完成 |
| 25 | MetricsTrendQueryDTO | dto/MetricsTrendQueryDTO.java | ✅ 已完成 |

### 5.7 追踪相关DTO
| 序号 | DTO名称 | 路径 | 状态 |
|------|---------|------|------|
| 26 | MonitorTraceDTO | dto/MonitorTraceDTO.java | ✅ 已完成 |
| 27 | TraceQueryDTO | dto/TraceQueryDTO.java | ✅ 已完成 |

### 5.8 仪表盘相关DTO
| 序号 | DTO名称 | 路径 | 状态 |
|------|---------|------|------|
| 28 | DashboardOverviewDTO | dto/DashboardOverviewDTO.java | ✅ 已完成 |
| 29 | DashboardMetricsDTO | dto/DashboardMetricsDTO.java | ✅ 已完成 |

---

## 六、Mapper接口开发进度

| 序号 | Mapper | 路径 | 状态 |
|------|--------|------|------|
| 1 | MonitorServiceMapper | mapper/MonitorServiceMapper.java | ✅ 已完成 |
| 2 | MonitorAlertMapper | mapper/MonitorAlertMapper.java | ✅ 已完成 |
| 3 | MonitorAlertRuleMapper | mapper/MonitorAlertRuleMapper.java | ✅ 已完成 |
| 4 | MonitorAlertChannelMapper | mapper/MonitorAlertChannelMapper.java | ✅ 已完成 |
| 5 | MonitorAlertHandleMapper | mapper/MonitorAlertHandleMapper.java | ✅ 已完成 |
| 6 | MonitorLogMapper | mapper/MonitorLogMapper.java | ✅ 已完成 |
| 7 | MonitorMetricsMapper | mapper/MonitorMetricsMapper.java | ✅ 已完成 |
| 8 | MonitorTraceMapper | mapper/MonitorTraceMapper.java | ✅ 已完成 |

---

## 七、Service接口开发进度

| 序号 | Service | 路径 | 状态 | 备注 |
|------|---------|------|------|------|
| 1 | MonitorServiceService | service/MonitorServiceService.java | ✅ 已完成 | - |
| 2 | MonitorAlertService | service/MonitorAlertService.java | ✅ 已完成 | - |
| 3 | MonitorAlertRuleService | service/MonitorAlertRuleService.java | ✅ 已完成 | - |
| 4 | MonitorAlertChannelService | service/MonitorAlertChannelService.java | ✅ 已完成 | - |
| 5 | MonitorLogService | service/MonitorLogService.java | ✅ 已完成 | - |
| 6 | MonitorMetricsService | service/MonitorMetricsService.java | ✅ 已完成 | - |
| 7 | MonitorTraceService | service/MonitorTraceService.java | ✅ 已完成 | - |
| 8 | MonitorDashboardService | service/MonitorDashboardService.java | ✅ 已完成 | - |
| 9 | OtlpReceiverService | service/OtlpReceiverService.java | ⬜ 未开始 | **新增**：OTLP 数据接收 |
| 10 | MetricsCollectorService | service/MetricsCollectorService.java | ⬜ 未开始 | **新增**：Metrics 采集 |

---

## 八、Service实现类开发进度

| 序号 | Service实现 | 路径 | 状态 | 备注 |
|------|------------|------|------|------|
| 1 | MonitorServiceServiceImpl | service/impl/MonitorServiceServiceImpl.java | ✅ 已完成 | - |
| 2 | MonitorAlertServiceImpl | service/impl/MonitorAlertServiceImpl.java | ✅ 已完成 | - |
| 3 | MonitorAlertRuleServiceImpl | service/impl/MonitorAlertRuleServiceImpl.java | ✅ 已完成 | - |
| 4 | MonitorAlertChannelServiceImpl | service/impl/MonitorAlertChannelServiceImpl.java | ✅ 已完成 | - |
| 5 | MonitorLogServiceImpl | service/impl/MonitorLogServiceImpl.java | ✅ 已完成 | - |
| 6 | MonitorMetricsServiceImpl | service/impl/MonitorMetricsServiceImpl.java | ✅ 已完成 | - |
| 7 | MonitorTraceServiceImpl | service/impl/MonitorTraceServiceImpl.java | ✅ 已完成 | - |
| 8 | MonitorDashboardServiceImpl | service/impl/MonitorDashboardServiceImpl.java | ✅ 已完成 | - |
| 9 | OtlpReceiverServiceImpl | service/impl/OtlpReceiverServiceImpl.java | ⬜ 未开始 | **新增**：解析 OTLP Protobuf |
| 10 | MetricsCollectorServiceImpl | service/impl/MetricsCollectorServiceImpl.java | ⬜ 未开始 | **新增**：采集 Micrometer 指标 |

---

## 九、Controller开发进度

| 序号 | Controller | 路径 | 状态 | 备注 |
|------|-----------|------|------|------|
| 1 | MonitorController | controller/MonitorController.java | ✅ 已完成 | - |
| 2 | MonitorAlertController | controller/MonitorAlertController.java | ✅ 已完成 | - |
| 3 | MonitorAlertRuleController | controller/MonitorAlertRuleController.java | ✅ 已完成 | - |
| 4 | MonitorAlertChannelController | controller/MonitorAlertChannelController.java | ✅ 已完成 | - |
| 5 | MonitorLogController | controller/MonitorLogController.java | ✅ 已完成 | - |
| 6 | MonitorMetricsController | controller/MonitorMetricsController.java | ✅ 已完成 | - |
| 7 | MonitorTraceController | controller/MonitorTraceController.java | ✅ 已完成 | - |
| 8 | MonitorDashboardController | controller/MonitorDashboardController.java | ✅ 已完成 | - |
| 9 | OtlpReceiverController | controller/OtlpReceiverController.java | ⬜ 未开始 | **新增**：接收 Traces/Metrics/Logs |
| 10 | MetricsCollectorController | controller/MetricsCollectorController.java | ⬜ 未开始 | **新增**：Push/Scrape 接口 |

---

## 十、OTLP 接收器开发进度（新增）

| 序号 | 模块 | 路径 | 状态 | 说明 |
|------|------|------|------|------|
| 1 | OTLP Traces 接收 | controller/OtlpReceiverController.java | ⬜ 未开始 | `POST /monitor/api/otlp/v1/traces` |
| 2 | OTLP Metrics 接收 | controller/OtlpReceiverController.java | ⬜ 未开始 | `POST /monitor/api/otlp/v1/metrics` |
| 3 | OTLP Logs 接收 | controller/OtlpReceiverController.java | ⬜ 未开始 | `POST /monitor/api/otlp/v1/logs` |

**技术实现要点**：
- 解析 OTLP Protobuf 格式数据
- 存储 TimescaleDB 超表（traces、metrics、logs）
- 支持批量写入优化性能

---

## 十一、Metrics 采集器开发进度（新增）

| 序号 | 模块 | 路径 | 状态 | 说明 |
|------|------|------|------|------|
| 1 | Metrics Push 接口 | controller/MetricsCollectorController.java | ⬜ 未开始 | `POST /monitor/api/metrics/push` |
| 2 | Metrics Scrape 接口 | controller/MetricsCollectorController.java | ⬜ 未开始 | `GET /monitor/api/metrics/scrape` (Prometheus 格式) |

**技术实现要点**：
- 支持主动推送（Push）
- 支持被动拉取（Scrape，兼容 Prometheus）
- 存储 TimescaleDB 超表（metrics）

---

## 十二、告警引擎开发进度（新增）

| 序号 | 模块 | 路径 | 状态 | 说明 |
|------|------|------|------|------|
| 1 | AlertEngine | task/AlertEngine.java | ⬜ 未开始 | 定时扫描、规则匹配、告警触发 |

**技术实现要点**：
- `@Scheduled` 定时任务（每分钟执行）
- 扫描 metrics 超表
- 匹配告警规则（monitor_alert_rule）
- 创建告警记录（monitor_alert）
- 发送通知（邮件/短信/站内信）

---

## 十三、前端工程开发进度（新增）

| 序号 | 模块 | 路径 | 状态 | 说明 |
|------|------|------|------|------|
| 1 | 仪表盘首页 | qooerp-frontend/packages/web/src/views/monitor/Dashboard.vue | ⬜ 未开始 | Vue 3 + TDesign |
| 2 | 链路追踪页 | qooerp-frontend/packages/web/src/views/monitor/Traces.vue | ⬜ 未开始 | ECharts 桑基图 |
| 3 | 指标趋势页 | qooerp-frontend/packages/web/src/views/monitor/Metrics.vue | ⬜ 未开始 | ECharts 时序图 |
| 4 | 告警管理页 | qooerp-frontend/packages/web/src/views/monitor/Alerts.vue | ⬜ 未开始 | TDesign Table |

**技术栈**：
- Vue 3.4+
- TDesign (PC)
- ECharts 5.x
- Pinia (状态管理)
- Axios (HTTP 客户端)
- TypeScript 5.x

---

## 十四、配置文件开发进度

| 序号 | 配置文件 | 路径 | 状态 | 备注 |
|------|---------|------|------|------|
| 1 | application.yml | resources/application.yml | ✅ 已完成 | 已添加 OTLP、Metrics、告警配置 |
| 2 | bootstrap.yml | resources/bootstrap.yml | ✅ 已完成 | - |
| 3 | logback-spring.xml | resources/logback-spring.xml | ✅ 已完成 | - |

---

## 十五、测试用例开发进度

### 15.1 单元测试
| 序号 | 测试类 | 路径 | 状态 |
|------|--------|------|------|
| 1 | MonitorServiceTest | test/MonitorServiceTest.java | ⬜ 未开始 |
| 2 | MonitorAlertTest | test/MonitorAlertTest.java | ⬜ 未开始 |
| 3 | MonitorAlertRuleTest | test/MonitorAlertRuleTest.java | ⬜ 未开始 |
| 4 | MonitorAlertChannelTest | test/MonitorAlertChannelTest.java | ⬜ 未开始 |
| 5 | MonitorLogTest | test/MonitorLogTest.java | ⬜ 未开始 |
| 6 | MonitorMetricsTest | test/MonitorMetricsTest.java | ⬜ 未开始 |
| 7 | MonitorTraceTest | test/MonitorTraceTest.java | ⬜ 未开始 |
| 8 | MonitorDashboardTest | test/MonitorDashboardTest.java | ⬜ 未开始 |

### 15.2 新增测试
| 序号 | 测试类 | 路径 | 状态 |
|------|--------|------|------|
| 9 | OtlpReceiverTest | test/OtlpReceiverTest.java | ⬜ 未开始 |
| 10 | MetricsCollectorTest | test/MetricsCollectorTest.java | ⬜ 未开始 |
| 11 | AlertEngineTest | test/AlertEngineTest.java | ⬜ 未开始 |
| 12 | TimescaleDBTest | test/TimescaleDBTest.java | ⬜ 未开始 |

---

## 十六、开发计划（v2.0）

### 阶段一：基础框架搭建（已完成）
- ✅ 设计文档完善（6份）
- ✅ 项目结构创建
- ✅ 配置文件设置（3个）
- ✅ 依赖配置

### 阶段二：数据层开发（已完成）
- ✅ 8个实体类开发
- ✅ 29个DTO类开发
- ✅ 8个Mapper接口开发
- ✅ TimescaleDB 数据库脚本

### 阶段三：业务逻辑层开发（已完成）
- ✅ 8个Service接口和实现类

### 阶段四：控制层开发（已完成）
- ✅ 8个Controller类

### 阶段五：OTLP 接收器开发（预计2天）
- ⬜ OtlpReceiverService 接口与实现
- ⬜ OtlpReceiverController 接收 Traces/Metrics/Logs
- ⬜ OTLP Protobuf 解析
- ⬜ TimescaleDB 批量写入优化

### 阶段六：Metrics 采集器开发（预计1天）
- ⬜ MetricsCollectorService 接口与实现
- ⬜ MetricsCollectorController Push/Scrape 接口
- ⬜ Prometheus 格式兼容

### 阶段七：告警引擎开发（预计2天）
- ⬜ AlertEngine 定时任务
- ⬜ 告警规则匹配逻辑
- ⬜ 告警通知发送

### 阶段八：前端工程开发（预计5天）
- ⬜ qooerp-frontend 前端项目搭建
- ⬜ 仪表盘首页（Vue 3 + TDesign + ECharts）
- ⬜ 链路追踪查询页
- ⬜ 指标趋势分析页
- ⬜ 告警管理页

### 阶段九：测试与优化（预计2天）
- ⬜ 单元测试（12个测试类）
- ⬜ 集成测试
- ⬜ 性能优化（TimescaleDB 查询优化）

---

## 十七、技术债务与待办事项

### 17.1 高优先级
- [ ] 实现 OTLP Protobuf 解析器
- [ ] 实现告警引擎定时任务
- [ ] 搭建 Vue 3 + TDesign 前端工程
- [ ] 实现 ECharts 图表组件

### 17.2 中优先级
- [ ] 实现数据保留策略（自动清理）
- [ ] 实现 TimescaleDB 连续聚合优化
- [ ] 实现告警通知渠道（邮件/短信/站内信）

### 17.3 低优先级
- [ ] 实现 Prometheus Scrape 接口完整兼容
- [ ] 实现前端国际化（i18n）
- [ ] 实现移动端适配（TDesign Mobile）

---

## 十八、完成总结

### 已完成的开发内容（v1.0 → v2.0）
1. ✅ 6份设计文档（业务、应用、数据、API、技术、数据库脚本）
2. ✅ 8个实体类
3. ✅ 29个DTO类
4. ✅ 8个Mapper接口
5. ✅ 8个Service接口和实现类
6. ✅ 8个Controller类
7. ✅ 3个配置文件
8. ✅ TimescaleDB 数据库脚本（超表、连续聚合）

### 核心功能（已完成）
- 服务监控与管理
- 告警管理与处理
- 告警规则配置
- 告警通知渠道
- 监控日志查询
- 监控仪表盘（基础版）

### 核心功能（待开发）
- **OTLP 数据接收**（Traces/Metrics/Logs）
- **Metrics 采集**（Push/Scrape）
- **告警引擎**（定时扫描、规则匹配）
- **Vue 3 + TDesign 前端**（ECharts 可视化）

**总进度：75% (79/106)**

---

**文档版本**: v2.0  
**更新日期**: 2026-02-18  
**架构变更**: Prometheus + Grafana → qooerp-monitor + PostgreSQL + TimescaleDB + ECharts
