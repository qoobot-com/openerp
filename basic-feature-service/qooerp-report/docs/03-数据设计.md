# QooERP 报表与分析模块 - 数据设计文档

> 模块名称: qooerp-report  
> 模块版本: v1.0  
> 创建日期: 20xx-xx-xx  
> 作者: Auto

---

## 一、数据库设计

| 表名 | 中文名称 | 说明 |
|------|---------|------|
| report | 报表表 | 报表主表 |
| report_datasource | 报表数据源表 | 数据源配置表 |
| report_config | 报表配置表 | 报表配置表 |
| dashboard | 仪表盘表 | 仪表盘主表 |
| dashboard_item | 仪表盘项表 | 仪表盘项表 |
| report_subscription | 报表订阅表 | 报表订阅表 |
| report_history | 报表历史表 | 报表历史表 |

---

## 二、表结构

### 2.1 report（报表表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| report_no | VARCHAR(50) | 报表编号 |
| report_name | VARCHAR(100) | 报表名称 |
| report_type | TINYINT | 报表类型(1-列表,2-图表,3-混合,4-交叉,5-透视) |
| category | VARCHAR(50) | 报表分类 |
| description | TEXT | 报表描述 |
| status | TINYINT | 状态(0-草稿,1-已发布,2-已归档) |
| created_by | BIGINT | 创建人 |
| created_time | TIMESTAMP | 创建时间 |
| updated_by | BIGINT | 更新人 |
| updated_time | TIMESTAMP | 更新时间 |

### 2.2 report_datasource（报表数据源表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| report_id | BIGINT | 报表ID |
| datasource_name | VARCHAR(100) | 数据源名称 |
| datasource_type | VARCHAR(20) | 数据源类型(mysql,postgresql,api,elastic) |
| connection_config | TEXT | 连接配置JSON |
| sql_query | TEXT | SQL查询 |
| cache_config | TEXT | 缓存配置JSON |
| created_by | BIGINT | 创建人 |
| created_time | TIMESTAMP | 创建时间 |
| updated_by | BIGINT | 更新人 |
| updated_time | TIMESTAMP | 更新时间 |

### 2.3 report_config（报表配置表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| report_id | BIGINT | 报表ID |
| config_name | VARCHAR(100) | 配置名称 |
| chart_type | VARCHAR(20) | 图表类型(bar,line,pie,table,scatter,gauge,funnel,radar) |
| chart_config | TEXT | 图表配置JSON |
| column_config | TEXT | 列配置JSON |
| filter_config | TEXT | 过滤条件配置JSON |
| sort_config | TEXT | 排序配置JSON |
| drill_config | TEXT | 下钻配置JSON |
| created_by | BIGINT | 创建人 |
| created_time | TIMESTAMP | 创建时间 |
| updated_by | BIGINT | 更新人 |
| updated_time | TIMESTAMP | 更新时间 |

### 2.4 dashboard（仪表盘表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| dashboard_no | VARCHAR(50) | 仪表盘编号 |
| dashboard_name | VARCHAR(100) | 仪表盘名称 |
| dashboard_type | TINYINT | 类型(1-个人,2-公共,3-系统) |
| layout_config | TEXT | 布局配置JSON |
| description | TEXT | 描述 |
| status | TINYINT | 状态(0-禁用,1-启用) |
| created_by | BIGINT | 创建人 |
| created_time | TIMESTAMP | 创建时间 |
| updated_by | BIGINT | 更新人 |
| updated_time | TIMESTAMP | 更新时间 |

### 2.5 dashboard_item（仪表盘项表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| dashboard_id | BIGINT | 仪表盘ID |
| report_id | BIGINT | 报表ID |
| item_name | VARCHAR(100) | 项名称 |
| position_config | TEXT | 位置配置JSON |
| size_config | TEXT | 尺寸配置JSON |
| display_config | TEXT | 显示配置JSON |
| refresh_interval | INT | 刷新间隔(秒) |
| sort_order | INT | 排序 |
| created_by | BIGINT | 创建人 |
| created_time | TIMESTAMP | 创建时间 |
| updated_by | BIGINT | 更新人 |
| updated_time | TIMESTAMP | 更新时间 |

### 2.6 report_subscription（报表订阅表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| report_id | BIGINT | 报表ID |
| user_id | BIGINT | 订阅用户ID |
| subscription_name | VARCHAR(100) | 订阅名称 |
| schedule_config | TEXT | 调度配置JSON |
| delivery_config | TEXT | 投递配置JSON |
| filter_config | TEXT | 过滤条件JSON |
| status | TINYINT | 状态(0-暂停,1-启用) |
| last_run_time | TIMESTAMP | 最后运行时间 |
| next_run_time | TIMESTAMP | 下次运行时间 |
| created_by | BIGINT | 创建人 |
| created_time | TIMESTAMP | 创建时间 |
| updated_by | BIGINT | 更新人 |
| updated_time | TIMESTAMP | 更新时间 |

### 2.7 report_history（报表历史表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| report_id | BIGINT | 报表ID |
| snapshot_data | TEXT | 快照数据JSON |
| snapshot_config | TEXT | 快照配置JSON |
| snapshot_time | TIMESTAMP | 快照时间 |
| created_by | BIGINT | 创建人 |
| created_time | TIMESTAMP | 创建时间 |

---

## 三、索引设计

```sql
-- report表索引
CREATE INDEX idx_report_no ON report(report_no);
CREATE INDEX idx_report_type ON report(report_type);
CREATE INDEX idx_report_category ON report(category);
CREATE INDEX idx_report_status ON report(status);
CREATE INDEX idx_report_created_by ON report(created_by);

-- report_datasource表索引
CREATE INDEX idx_datasource_report_id ON report_datasource(report_id);
CREATE INDEX idx_datasource_type ON report_datasource(datasource_type);

-- report_config表索引
CREATE INDEX idx_config_report_id ON report_config(report_id);

-- dashboard表索引
CREATE INDEX idx_dashboard_no ON dashboard(dashboard_no);
CREATE INDEX idx_dashboard_type ON dashboard(dashboard_type);
CREATE INDEX idx_dashboard_status ON dashboard(status);
CREATE INDEX idx_dashboard_created_by ON dashboard(created_by);

-- dashboard_item表索引
CREATE INDEX idx_item_dashboard_id ON dashboard_item(dashboard_id);
CREATE INDEX idx_item_report_id ON dashboard_item(report_id);

-- report_subscription表索引
CREATE INDEX idx_subscription_report_id ON report_subscription(report_id);
CREATE INDEX idx_subscription_user_id ON report_subscription(user_id);
CREATE INDEX idx_subscription_status ON report_subscription(status);
CREATE INDEX idx_subscription_next_run ON report_subscription(next_run_time);

-- report_history表索引
CREATE INDEX idx_history_report_id ON report_history(report_id);
CREATE INDEX idx_history_snapshot_time ON report_history(snapshot_time);
```

---

## 四、数据字典

### 4.1 报表类型(report_type)

| 值 | 说明 |
|----|------|
| 1 | 列表报表 |
| 2 | 图表报表 |
| 3 | 混合报表 |
| 4 | 交叉报表 |
| 5 | 透视报表 |

### 4.2 报表状态(status)

| 值 | 说明 |
|----|------|
| 0 | 草稿 |
| 1 | 已发布 |
| 2 | 已归档 |

### 4.3 数据源类型(datasource_type)

| 值 | 说明 |
|----|------|
| mysql | MySQL数据库 |
| postgresql | PostgreSQL数据库 |
| api | API接口 |
| elastic | Elasticsearch |

### 4.4 图表类型(chart_type)

| 值 | 说明 |
|----|------|
| bar | 柱状图 |
| line | 折线图 |
| pie | 饼图 |
| table | 表格 |
| scatter | 散点图 |
| gauge | 仪表盘 |
| funnel | 漏斗图 |
| radar | 雷达图 |

### 4.5 仪表盘类型(dashboard_type)

| 值 | 说明 |
|----|------|
| 1 | 个人仪表盘 |
| 2 | 公共仪表盘 |
| 3 | 系统仪表盘 |

---

**文档版本**: v1.1  
**最后更新**: 20xx-xx-xx
