# QooERP 通知服务模块 - 应用设计文档

## 模块结构

```
qooerp-notify/
├── qooerp-notify-service/        # 核心服务模块
│   ├── controller/               # 控制器
│   ├── service/                  # 服务层
│   ├── manager/                  # 业务管理器
│   ├── repository/               # 数据访问层
│   ├── domain/                   # 领域模型
│   ├── dto/                      # 数据传输对象
│   ├── enums/                    # 枚举
│   ├── config/                   # 配置
│   └── sender/                   # 发送器
│       ├── EmailSender           # 邮件发送器
│       ├── SmsSender            # 短信发送器
│       ├── PushSender           # 推送发送器
│       ├── InternalSender       # 站内发送器
│       └── WebhookSender        # Webhook发送器
└── qooerp-notify-start/         # 启动模块
```

## 核心接口

### 通知发送接口

```java
@RestController
@RequestMapping("/api/notify")
public class NotifyController {

    // 发送邮件
    @PostMapping("/email")
    public Result<Void> sendEmail(@RequestBody EmailDTO dto);

    // 发送短信
    @PostMapping("/sms")
    public Result<Void> sendSms(@RequestBody SmsDTO dto);

    // 发送站内通知
    @PostMapping("/internal")
    public Result<Void> sendInternal(@RequestBody InternalDTO dto);

    // 发送推送通知
    @PostMapping("/push")
    public Result<Void> sendPush(@RequestBody PushDTO dto);

    // 发送Webhook
    @PostMapping("/webhook")
    public Result<Void> sendWebhook(@RequestBody WebhookDTO dto);

    // 批量发送
    @PostMapping("/batch")
    public Result<Void> sendBatch(@RequestBody BatchDTO dto);

    // 使用模板发送
    @PostMapping("/template")
    public Result<Void> sendByTemplate(@RequestBody TemplateDTO dto);
}
```

### 模板管理接口

```java
@RestController
@RequestMapping("/api/notify/template")
public class TemplateController {

    @PostMapping
    public Result<Long> create(@RequestBody TemplateDTO dto);

    @PutMapping
    public Result<Void> update(@RequestBody TemplateDTO dto);

    @DeleteMapping("/{id}")
    public Result<Void> delete(@PathVariable Long id);

    @GetMapping("/{id}")
    public Result<TemplateVO> get(@PathVariable Long id);

    @GetMapping("/page")
    public Result<Page<TemplateVO>> page(TemplateQuery query);

    @PostMapping("/preview")
    public Result<String> preview(@RequestBody TemplatePreviewDTO dto);
}
```

### 记录查询接口

```java
@RestController
@RequestMapping("/api/notify/record")
public class RecordController {

    @GetMapping("/{id}")
    public Result<RecordVO> get(@PathVariable Long id);

    @GetMapping("/page")
    public Result<Page<RecordVO>> page(RecordQuery query);

    @GetMapping("/statistics")
    public Result<StatisticsVO> statistics(StatisticsQuery query);

    @PostMapping("/retry/{id}")
    public Result<Void> retry(@PathVariable Long id);
}
```

### 订阅管理接口

```java
@RestController
@RequestMapping("/api/notify/subscription")
public class SubscriptionController {

    @PostMapping
    public Result<Void> subscribe(@RequestBody SubscriptionDTO dto);

    @DeleteMapping
    public Result<Void> unsubscribe(@RequestBody UnsubscribeDTO dto);

    @GetMapping("/user/{userId}")
    public Result<List<SubscriptionVO>> getUserSubscriptions(@PathVariable Long userId);

    @PostMapping("/dnd")
    public Result<Void> setDND(@RequestBody DNDDTO dto);
}
```

### 配置管理接口

```java
@RestController
@RequestMapping("/api/notify/config")
public class ConfigController {

    @GetMapping
    public Result<NotifyConfigVO> getConfig();

    @PutMapping
    public Result<Void> updateConfig(@RequestBody NotifyConfigDTO dto);

    @GetMapping("/channel/{channelType}")
    public Result<ChannelConfigVO> getChannelConfig(@PathVariable String channelType);

    @PutMapping("/channel/{channelType}")
    public Result<Void> updateChannelConfig(
        @PathVariable String channelType,
        @RequestBody ChannelConfigDTO dto
    );
}
```

---

**文档版本**: v1.0
