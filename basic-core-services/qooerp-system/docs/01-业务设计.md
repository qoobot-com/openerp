# qooerp-system 系统管理 - 业务设计文档

> 模块版本：1.0.0-SNAPSHOT
> 创建日期：20xx-xx-xx
> 文档作者：QooERP团队

---

## 一、业务概述

### 1.1 模块定位

qooerp-system是QooERP系统的系统管理核心服务，负责：
|- 字典管理（数据字典、字典项）
|- 参数配置（系统参数、配置管理）
|- 日志管理（操作日志、登录日志、审计日志）
|- 系统公告（公告发布、范围管理、阅读跟踪）
|- 在线用户（在线用户管理、会话管理、强制下线）
|- 数据导入导出（导入任务、导出任务、模板管理）

### 1.2 业务目标

| 目标 | 描述 |
|------|------|
| 灵活性 | 支持动态配置，无需重启系统 |
| 可追溯 | 完整的日志记录，便于审计 |
| 易维护 | 统一的系统管理入口 |
| 安全性 | 完善的安全审计和会话管理 |
| 便捷性 | 支持数据导入导出和系统公告 |

---

## 二、核心业务功能

### 2.1 字典管理

| 功能点 | 描述 | 优先级 | 状态 |
|--------|------|--------|------|
| 字典创建 | 创建数据字典 | P0 | 未开始 |
| 字典编辑 | 编辑字典信息 | P0 | 未开始 |
| 字典删除 | 删除字典 | P0 | 未开始 |
| 字典项管理 | 管理字典明细项 | P0 | 未开始 |
| 字典查询 | 查询字典及项 | P0 | 未开始 |
| 字典缓存 | 字典数据缓存 | P0 | 未开始 |

### 2.2 参数配置

| 功能点 | 描述 | 优先级 | 状态 |
|--------|------|--------|------|
| 参数创建 | 创建系统参数 | P0 | 未开始 |
| 参数编辑 | 编辑系统参数 | P0 | 未开始 |
| 参数删除 | 删除系统参数 | P0 | 未开始 |
| 参数查询 | 查询系统参数 | P0 | 未开始 |
| 参数刷新 | 刷新参数缓存 | P0 | 未开始 |

### 2.3 日志管理

| 功能点 | 描述 | 优先级 | 状态 |
|--------|------|--------|------|
| 操作日志记录 | 记录用户操作 | P0 | 未开始 |
| 日志查询 | 查询操作日志 | P0 | 未开始 |
| 日志导出 | 导出操作日志 | P1 | 未开始 |
| 日志清理 | 定期清理过期日志 | P0 | 未开始 |

### 2.4 系统公告

| 功能点 | 描述 | 优先级 | 状态 |
|--------|------|--------|------|
| 公告创建 | 创建系统公告 | P0 | 未开始 |
| 公告编辑 | 编辑公告内容 | P0 | 未开始 |
| 公告删除 | 删除公告 | P0 | 未开始 |
| 公告发布 | 发布公告 | P0 | 未开始 |
| 公告撤回 | 撤回已发布公告 | P0 | 未开始 |
| 公告查询 | 分页查询公告 | P0 | 未开始 |
| 阅读状态 | 查看公告阅读状态 | P0 | 未开始 |
| 标记已读 | 标记公告为已读 | P0 | 未开始 |

### 2.5 在线用户管理

| 功能点 | 描述 | 优先级 | 状态 |
|--------|------|--------|------|
| 在线用户查询 | 查询在线用户列表 | P0 | 未开始 |
| 用户详情 | 查看在线用户详情 | P0 | 未开始 |
| 强制下线 | 强制指定用户下线 | P0 | 未开始 |
| 批量下线 | 批量强制用户下线 | P0 | 未开始 |
| 会话统计 | 统计在线会话数 | P0 | 未开始 |

### 2.6 数据导入导出

| 功能点 | 描述 | 优先级 | 状态 |
|--------|------|--------|------|
| 导出任务创建 | 创建数据导出任务 | P0 | 未开始 |
| 导出任务查询 | 查询导出任务列表 | P0 | 未开始 |
| 导出下载 | 下载导出文件 | P0 | 未开始 |
| 导入任务创建 | 创建数据导入任务 | P0 | 未开始 |
| 导入任务查询 | 查询导入任务列表 | P0 | 未开始 |
| 导入验证 | 验证导入数据 | P0 | 未开始 |
| 导入执行 | 执行数据导入 | P0 | 未开始 |
| 模板下载 | 下载导入模板 | P0 | 未开始 |

### 2.7 审计日志

| 功能点 | 描述 | 优先级 | 状态 |
|--------|------|--------|------|
| 审计日志记录 | 记录数据变更和敏感操作 | P0 | 未开始 |
| 审计日志查询 | 查询审计日志 | P0 | 未开始 |
| 变更对比 | 对比数据变更前后 | P0 | 未开始 |
| 审计日志导出 | 导出审计日志 | P0 | 未开始 |
| 审计日志归档 | 归档历史审计日志 | P1 | 未开始 |

---

## 三、业务规则

### 3.1 字典规则

| 规则 | 说明 |
|------|------|
| 字典编码唯一 | 字典编码全局唯一 |
| 字典项编码唯一 | 同一字典下字典项编码唯一 |
| 字典缓存有效期 | 30分钟 |
| 字典删除校验 | 字典下有字典项时不可删除 |

### 3.2 参数配置规则

| 规则 | 说明 |
|------|------|
| 参数键唯一 | 参数键全局唯一 |
| 参数缓存 | 所有参数加载到内存 |
| 系统参数保护 | 系统参数不可删除 |

### 3.3 日志规则

| 规则 | 说明 |
|------|------|
| 日志保留周期 | 操作日志保留90天 |
| 敏感信息脱敏 | 日志中的敏感信息需要脱敏 |
| 日志级别 | INFO、WARN、ERROR |

### 3.4 系统公告规则

| 规则 | 说明 |
|------|------|
| 公告类型 | 紧急、重要、普通 |
| 公告范围 | 全部用户、指定部门、指定角色 |
| 草稿限制 | 草稿状态不可阅读 |
| 已发布 | 已发布公告不可编辑 |

### 3.5 在线用户规则

| 规则 | 说明 |
|------|------|
| 会话超时 | 30分钟无操作自动下线 |
| 重复登录 | 同一账号重复登录踢出旧会话 |
| 强制下线 | 仅管理员可强制下线 |

### 3.6 数据导入导出规则

| 规则 | 说明 |
|------|------|
| 导出限制 | 单次导出最多10万条记录 |
| 导入限制 | 单次导入最多5万条记录 |
| 文件格式 | 仅支持Excel(.xlsx)和CSV格式 |
| 文件大小 | 最大50MB |

### 3.7 审计日志规则

| 规则 | 说明 |
|------|------|
| 保留周期 | 审计日志保留1年 |
| 敏感操作 | 登录、权限变更、数据导出 |
| 数据变更 | 记录变更前后的完整数据 |

---

## 四、异常处理

### 4.1 字典异常

| 错误码 | 错误信息 | 处理方式 |
|--------|---------|---------|
| SYS_001 | 字典编码已存在 | 提示修改编码 |
| SYS_002 | 字典项编码已存在 | 提示修改编码 |

### 4.2 参数异常

| 错误码 | 错误信息 | 处理方式 |
|--------|---------|---------|
| SYS_101 | 参数键已存在 | 提示修改键名 |
| SYS_102 | 系统参数不可删除 | 提示权限不足 |

### 4.3 系统公告异常

| 错误码 | 错误信息 | 处理方式 |
|--------|---------|---------|
| SYS_201 | 已发布公告不可编辑 | 提示先撤回 |
| SYS_202 | 目标用户不存在 | 提示检查目标配置 |

### 4.4 在线用户异常

| 错误码 | 错误信息 | 处理方式 |
|--------|---------|---------|
| SYS_301 | 用户不在线 | 提示用户已下线 |
| SYS_302 | 无权限强制下线 | 提示权限不足 |

### 4.5 数据导入导出异常

| 错误码 | 错误信息 | 处理方式 |
|--------|---------|---------|
| SYS_401 | 文件格式不支持 | 提示支持的格式 |
| SYS_402 | 文件大小超限 | 提示最大50MB |
| SYS_403 | 导入数据验证失败 | 返回验证错误详情 |
| SYS_404 | 导出记录数超限 | 提示最多10万条 |

---

## 五、业务指标

| 指标 | 目标值 |
|------|--------|
| 字典查询响应时间 | <10ms |
| 参数刷新响应时间 | <50ms |
| 日志写入性能 | >10000 TPS |
| 公告查询响应时间 | <20ms |
| 在线用户查询响应时间 | <30ms |
| 导出任务处理速度 | >1000条/秒 |
| 导入验证速度 | >2000条/秒 |

---

## 六、参考资料

>- [Logback日志框架](https://logback.qos.ch/)
