# qooerp-user 用户管理 - 业务功能定义文档

> 模块版本：2.0.0-REDESIGN
> 设计日期：2026-02-18
> 文档作者：QooERP团队
> 设计原则：DDD领域驱动设计

---

## 一、模块概述

### 1.1 模块定位

用户管理模块是QooERP系统的核心基础模块，负责用户全生命周期管理，包括用户身份管理、用户档案管理、用户账户管理、用户偏好管理等功能。该模块作为用户上下文的核心，与身份认证上下文、组织管理上下文、权限管理上下文、人力资源上下文等多个上下文协作，为整个系统提供用户管理能力。

### 1.2 业务目标

| 目标 | 描述 | 成功指标 |
|------|------|---------|
| 灵活性 | 支持不同规模企业的用户管理需求 | 支持小/中/大/集团企业 |
| 安全性 | 保障用户信息和账户安全 | 符合等保2.0要求 |
| 可扩展性 | 支持自定义扩展属性和业务逻辑 | 支持插件化扩展 |
| 可追溯 | 完整的用户操作日志和审计日志 | 操作日志100%可追溯 |
| 高可用 | 用户服务高可用 | 可用性≥99.9% |
| 全球化 | 支持多语言、多时区、多币种 | 支持100+语言、100+时区 |

### 1.3 适用范围

- **小微企业**：简化用户管理，支持100-500用户
- **中型企业**：完整用户管理，支持500-2000用户
- **大型企业**：企业级用户管理，支持2000-10000用户
- **集团企业**：多组织用户管理，支持10000+用户
- **政府机构**：严格权限管控，支持政府五级架构

---

## 二、功能模块划分

### 2.1 用户核心域

#### 2.1.1 用户身份管理

| 功能编号 | 功能名称 | 功能描述 | 优先级 | 状态 |
|---------|---------|---------|--------|------|
| UC-001 | 用户创建 | 创建新用户，包括基本信息、档案信息、账户信息 | P0 | 待实现 |
| UC-002 | 用户编辑 | 编辑用户基本信息、档案信息 | P0 | 待实现 |
| UC-003 | 用户删除 | 软删除用户（保留审计记录） | P0 | 待实现 |
| UC-004 | 用户查询 | 分页查询用户列表，支持多条件查询 | P0 | 待实现 |
| UC-005 | 用户详情 | 查询用户完整信息（含档案、组织、角色） | P0 | 待实现 |
| UC-006 | 用户启用 | 激活已停用的用户 | P0 | 待实现 |
| UC-007 | 用户停用 | 停用用户（不能登录） | P0 | 待实现 |
| UC-008 | 用户锁定 | 锁定用户账户（如登录失败过多） | P0 | 待实现 |
| UC-009 | 用户解锁 | 解锁用户账户 | P0 | 待实现 |
| UC-010 | 用户导入 | 批量导入用户（Excel） | P1 | 待实现 |
| UC-011 | 用户导出 | 导出用户列表（Excel/PDF） | P1 | 待实现 |

#### 2.1.2 用户档案管理

| 功能编号 | 功能名称 | 功能描述 | 优先级 | 状态 |
|---------|---------|---------|--------|------|
| UP-001 | 基本信息管理 | 管理用户基本信息（姓名、昵称、性别、生日等） | P0 | 待实现 |
| UP-002 | 联系方式管理 | 管理用户联系方式（手机、邮箱、工作邮箱、工作电话） | P0 | 待实现 |
| UP-003 | 地址信息管理 | 管理用户地址信息（家庭地址、工作地址） | P1 | 待实现 |
| UP-004 | 员工信息管理 | 管理员工信息（员工编号、入职日期、工作地点） | P0 | 待实现 |
| UP-005 | 教育背景管理 | 管理用户教育背景（学校、专业、学历、学位） | P1 | 待实现 |
| UP-006 | 工作经历管理 | 管理用户工作经历（公司、职位、时间段） | P1 | 待实现 |
| UP-007 | 技能管理 | 管理用户技能（技能名称、熟练度、证书） | P1 | 待实现 |
| UP-008 | 证件管理 | 管理用户证件（身份证、护照、学历证等） | P1 | 待实现 |
| UP-009 | 社交账号管理 | 管理用户社交账号（微信、钉钉、企业微信等） | P2 | 待实现 |
| UP-010 | 头像管理 | 上传、更换、删除用户头像 | P0 | 待实现 |
| UP-011 | 扩展属性管理 | 自定义扩展属性（JSON格式存储） | P1 | 待实现 |
| UP-012 | 档案完整度检查 | 检查用户档案信息完整度 | P2 | 待实现 |

#### 2.1.3 用户账户管理

| 功能编号 | 功能名称 | 功能描述 | 优先级 | 状态 |
|---------|---------|---------|--------|------|
| UA-001 | 密码修改 | 用户自行修改密码 | P0 | 待实现 |
| UA-002 | 密码重置 | 管理员重置用户密码 | P0 | 待实现 |
| UA-003 | 密码策略 | 配置密码复杂度策略、过期策略 | P0 | 待实现 |
| UA-004 | MFA启用 | 启用多因素认证 | P0 | 待实现 |
| UA-005 | MFA禁用 | 禁用多因素认证 | P0 | 待实现 |
| UA-006 | MFA验证 | MFA验证码验证 | P0 | 待实现 |
| UA-007 | 备用码管理 | 生成、查看、重新生成备用码 | P0 | 待实现 |
| UA-008 | 密码安全问题 | 设置密码安全问题 | P2 | 待实现 |
| UA-009 | 登录方式管理 | 配置支持多种登录方式（密码、手机、邮箱等） | P1 | 待实现 |
| UA-010 | 安全日志 | 查看用户安全日志（登录、密码修改等） | P0 | 待实现 |
| UA-011 | 密码过期提醒 | 密码过期前发送提醒 | P1 | 待实现 |
| UA-012 | 异常登录检测 | 检测异常登录（异地登录、异常时间） | P1 | 待实现 |

#### 2.1.4 用户偏好管理

| 功能编号 | 功能名称 | 功能描述 | 优先级 | 状态 |
|---------|---------|---------|--------|------|
| UPREF-001 | 语言偏好 | 设置界面语言（支持100+语言） | P0 | 待实现 |
| UPREF-002 | 时区偏好 | 设置时区（支持100+时区） | P0 | 待实现 |
| UPREF-003 | 日期格式 | 设置日期格式 | P1 | 待实现 |
| UPREF-004 | 时间格式 | 设置时间格式 | P1 | 待实现 |
| UPREF-005 | 主题设置 | 设置界面主题（亮色/暗色） | P1 | 待实现 |
| UPREF-006 | 首页布局 | 设置首页布局 | P2 | 待实现 |
| UPREF-007 | 每页显示条数 | 设置每页显示条数 | P1 | 待实现 |
| UPREF-008 | 通知设置 | 配置各类通知的接收方式 | P0 | 待实现 |
| UPREF-009 | 界面设置 | 配置界面相关设置 | P1 | 待实现 |
| UPREF-010 | 工作区设置 | 配置个人工作区 | P2 | 待实现 |
| UPREF-011 | 快捷方式管理 | 管理快捷方式 | P2 | 待实现 |
| UPREF-012 | 偏好导出导入 | 导出导入用户偏好 | P2 | 待实现 |

#### 2.1.5 用户组织关联管理

| 功能编号 | 功能名称 | 功能描述 | 优先级 | 状态 |
|---------|---------|---------|--------|------|
| UORG-001 | 分配组织 | 将用户分配到组织 | P0 | 待实现 |
| UORG-002 | 移除组织 | 将用户从组织移除 | P0 | 待实现 |
| UORG-003 | 设置主组织 | 设置用户主组织 | P0 | 待实现 |
| UORG-004 | 查询用户组织 | 查询用户所属组织列表 | P0 | 待实现 |
| UORG-005 | 组织调动 | 用户组织调动 | P0 | 待实现 |
| UORG-006 | 多组织支持 | 支持用户归属多个组织 | P0 | 待实现 |
| UORG-007 | 组织角色设置 | 设置用户在组织中的角色 | P1 | 待实现 |
| UORG-008 | 组织权限边界 | 设置用户组织权限边界 | P1 | 待实现 |
| UORG-009 | 组织数据权限 | 设置用户组织数据权限 | P1 | 待实现 |
| UORG-010 | 组织统计 | 统计组织下用户数量 | P2 | 待实现 |

#### 2.1.6 用户角色关联管理

| 功能编号 | 功能名称 | 功能描述 | 优先级 | 状态 |
|---------|---------|---------|--------|------|
| UROLE-001 | 分配角色 | 为用户分配角色 | P0 | 待实现 |
| UROLE-002 | 移除角色 | 移除用户角色 | P0 | 待实现 |
| UROLE-003 | 设置主角色 | 设置用户主角色 | P0 | 待实现 |
| UROLE-004 | 查询用户角色 | 查询用户角色列表 | P0 | 待实现 |
| UROLE-005 | 批量分配角色 | 批量为用户分配角色 | P1 | 待实现 |
| UROLE-006 | 角色过期设置 | 设置角色过期时间 | P2 | 待实现 |
| UROLE-007 | 角色继承 | 支持角色继承 | P2 | 待实现 |
| UROLE-008 | 角色权限查看 | 查看用户通过角色拥有的权限 | P1 | 待实现 |
| UROLE-009 | 角色统计 | 统计角色下用户数量 | P2 | 待实现 |

#### 2.1.7 用户活动管理

| 功能编号 | 功能名称 | 功能描述 | 优先级 | 状态 |
|---------|---------|---------|--------|------|
| UACT-001 | 登录记录 | 记录用户登录信息（时间、IP、设备） | P0 | 待实现 |
| UACT-002 | 操作日志 | 记录用户操作日志 | P0 | 待实现 |
| UACT-003 | 在线用户 | 查询在线用户列表 | P1 | 待实现 |
| UACT-004 | 活动统计 | 统计用户活动数据 | P1 | 待实现 |
| UACT-005 | 行为分析 | 分析用户行为模式 | P2 | 待实现 |
| UACT-006 | 活动轨迹 | 查看用户活动轨迹 | P2 | 待实现 |
| UACT-007 | 异常活动检测 | 检测用户异常活动 | P1 | 待实现 |

### 2.2 用户扩展域

#### 2.2.1 用户关系管理

| 功能编号 | 功能名称 | 功能描述 | 优先级 | 状态 |
|---------|---------|---------|--------|------|
| UREL-001 | 关注用户 | 关注其他用户 | P2 | 待实现 |
| UREL-002 | 粉丝列表 | 查看用户粉丝列表 | P2 | 待实现 |
| UREL-003 | 关注列表 | 查看用户关注列表 | P2 | 待实现 |
| UREL-004 | 添加好友 | 添加用户为好友 | P2 | 待实现 |
| UREL-005 | 好友列表 | 查看用户好友列表 | P2 | 待实现 |
| UREL-006 | 黑名单 | 添加用户到黑名单 | P2 | 待实现 |

#### 2.2.2 用户画像管理

| 功能编号 | 功能名称 | 功能描述 | 优先级 | 状态 |
|---------|---------|---------|--------|------|
| UPRO-001 | 用户标签 | 为用户打标签 | P2 | 待实现 |
| UPRO-002 | 用户分群 | 用户分群管理 | P2 | 待实现 |
| UPRO-003 | 用户画像 | 生成用户画像 | P2 | 待实现 |
| UPRO-004 | 画像分析 | 分析用户画像 | P2 | 待实现 |
| UPRO-005 | 画像对比 | 对比用户画像 | P2 | 待实现 |

#### 2.2.3 用户通知管理

| 功能编号 | 功能名称 | 功能描述 | 优先级 | 状态 |
|---------|---------|---------|--------|------|
| UNOT-001 | 系统通知 | 发送系统通知 | P0 | 待实现 |
| UNOT-002 | 通知查看 | 查看用户通知列表 | P0 | 待实现 |
| UNOT-003 | 通知标记 | 标记通知已读/未读 | P0 | 待实现 |
| UNOT-004 | 通知设置 | 设置通知接收偏好 | P0 | 待实现 |
| UNOT-005 | 通知统计 | 统计用户通知数据 | P2 | 待实现 |

#### 2.2.4 用户消息管理

| 功能编号 | 功能名称 | 功能描述 | 优先级 | 状态 |
|---------|---------|---------|--------|------|
| UMSG-001 | 发送消息 | 发送消息给用户 | P1 | 待实现 |
| UMSG-002 | 消息列表 | 查看用户消息列表 | P1 | 待实现 |
| UMSG-003 | 消息标记 | 标记消息已读/未读 | P1 | 待实现 |
| UMSG-004 | 消息删除 | 删除用户消息 | P1 | 待实现 |
| UMSG-005 | 消息统计 | 统计用户消息数据 | P2 | 待实现 |

### 2.3 用户管理域

#### 2.3.1 用户查询与统计

| 功能编号 | 功能名称 | 功能描述 | 优先级 | 状态 |
|---------|---------|---------|--------|------|
| UQRY-001 | 用户查询 | 多条件查询用户 | P0 | 待实现 |
| UQRY-002 | 用户搜索 | 全文搜索用户 | P1 | 待实现 |
| UQRY-003 | 用户统计 | 统计用户数据 | P1 | 待实现 |
| UQRY-004 | 用户报表 | 生成用户报表 | P1 | 待实现 |
| UQRY-005 | 用户分析 | 分析用户数据 | P2 | 待实现 |
| UQRY-006 | 用户增长趋势 | 统计用户增长趋势 | P2 | 待实现 |
| UQRY-007 | 用户活跃度 | 统计用户活跃度 | P2 | 待实现 |
| UQRY-008 | 用户留存 | 统计用户留存率 | P2 | 待实现 |

#### 2.3.2 用户批量操作

| 功能编号 | 功能名称 | 功能描述 | 优先级 | 状态 |
|---------|---------|---------|--------|------|
| UBAT-001 | 批量启用 | 批量启用用户 | P1 | 待实现 |
| UBAT-002 | 批量停用 | 批量停用用户 | P1 | 待实现 |
| UBAT-003 | 批量删除 | 批量删除用户 | P1 | 待实现 |
| UBAT-004 | 批量分配角色 | 批量为用户分配角色 | P1 | 待实现 |
| UBAT-005 | 批量移除角色 | 批量移除用户角色 | P1 | 待实现 |
| UBAT-006 | 批量分配组织 | 批量将用户分配到组织 | P1 | 待实现 |
| UBAT-007 | 批量导入 | 批量导入用户 | P1 | 待实现 |
| UBAT-008 | 批量导出 | 批量导出用户 | P1 | 待实现 |
| UBAT-009 | 批量重置密码 | 批量重置用户密码 | P2 | 待实现 |

#### 2.3.3 用户审核与审批

| 功能编号 | 功能名称 | 功能描述 | 优先级 | 状态 |
|---------|---------|---------|--------|------|
| UAPP-001 | 用户注册审核 | 审核用户注册申请 | P1 | 待实现 |
| UAPP-002 | 用户信息变更审核 | 审核用户信息变更申请 | P1 | 待实现 |
| UAPP-003 | 用户权限申请审核 | 审核用户权限申请 | P1 | 待实现 |
| UAPP-004 | 审批流程配置 | 配置用户相关审批流程 | P1 | 待实现 |
| UAPP-005 | 审批记录 | 查看审批记录 | P2 | 待实现 |

---

## 三、业务规则

### 3.1 用户创建规则

| 规则编号 | 规则名称 | 规则说明 | 优先级 |
|---------|---------|---------|--------|
| UR-001 | 用户名唯一 | 用户名在租户内必须唯一 | P0 |
| UR-002 | 用户名格式 | 用户名只能包含字母、数字、下划线，长度4-50 | P0 |
| UR-003 | 手机号唯一 | 手机号在租户内必须唯一（如果填写） | P0 |
| UR-004 | 手机号格式 | 手机号必须符合各国手机号格式 | P0 |
| UR-005 | 邮箱唯一 | 邮箱在租户内必须唯一（如果填写） | P0 |
| UR-006 | 邮箱格式 | 邮箱必须符合邮箱格式 | P0 |
| UR-007 | 密码复杂度 | 密码至少8位，包含大小写字母、数字、特殊字符 | P0 |
| UR-008 | 默认状态 | 新用户默认为激活状态 | P0 |
| UR-009 | 员工编号唯一 | 员工编号在租户内必须唯一（如果填写） | P1 |
| UR-010 | 超级管理员 | 超级管理员只能由系统创建，不能删除 | P0 |

### 3.2 用户状态规则

| 规则编号 | 规则名称 | 规则说明 | 优先级 |
|---------|---------|---------|--------|
| UR-011 | 激活用户 | 停用用户可以激活 | P0 |
| UR-012 | 停用用户 | 激活用户可以停用 | P0 |
| UR-013 | 停用用户登录 | 停用用户不能登录 | P0 |
| UR-014 | 超级管理员不能停用 | 超级管理员不能停用 | P0 |
| UR-015 | 账户锁定 | 登录失败5次后自动锁定账户 | P0 |
| UR-016 | 账户解锁 | 管理员或密码重置可以解锁账户 | P0 |
| UR-017 | 锁定账户登录 | 锁定账户不能登录 | P0 |

### 3.3 用户删除规则

| 规则编号 | 规则名称 | 规则说明 | 优先级 |
|---------|---------|---------|--------|
| UR-018 | 软删除 | 用户删除为软删除，保留审计记录 | P0 |
| UR-019 | 超级管理员不能删除 | 超级管理员不能删除 | P0 |
| UR-020 | 有数据用户不能删除 | 用户有业务数据时不能删除（需配置） | P1 |
| UR-021 | 离职员工处理 | 离职员工建议停用而不是删除 | P1 |

### 3.4 用户组织规则

| 规则编号 | 规则名称 | 规则说明 | 优先级 |
|---------|---------|---------|--------|
| UR-022 | 主组织唯一 | 用户只能有一个主组织 | P0 |
| UR-023 | 多组织支持 | 用户可以归属多个组织 | P0 |
| UR-024 | 组织必须存在 | 分配用户到组织时，组织必须存在 | P0 |
| UR-025 | 删除组织前检查 | 删除组织前，需要检查是否有用户 | P1 |

### 3.5 用户角色规则

| 规则编号 | 规则名称 | 规则说明 | 优先级 |
|---------|---------|---------|--------|
| UR-026 | 主角色唯一 | 用户只能有一个主角色 | P0 |
| UR-027 | 多角色支持 | 用户可以有多个角色 | P0 |
| UR-028 | 角色必须存在 | 分配用户角色时，角色必须存在 | P0 |
| UR-029 | 权限合并 | 用户多个角色的权限合并计算 | P0 |
| UR-030 | 角色过期 | 角色可以设置过期时间 | P2 |

### 3.6 用户账户规则

| 规则编号 | 规则名称 | 规则说明 | 优先级 |
|---------|---------|---------|--------|
| UR-031 | 密码修改 | 修改密码需要验证旧密码 | P0 |
| UR-032 | 密码过期 | 密码默认90天过期 | P0 |
| UR-033 | 密码不能重复 | 不能使用最近3次使用过的密码 | P1 |
| UR-034 | 密码重置 | 管理员重置密码后，用户首次登录需修改 | P0 |
| UR-035 | MFA绑定 | MFA绑定需要验证当前密码 | P0 |
| UR-036 | MFA验证 | MFA验证码6分钟内有效 | P0 |
| UR-037 | 备用码使用 | 备用码使用一次后失效 | P0 |

### 3.7 用户偏好规则

| 规则编号 | 规则名称 | 规则说明 | 优先级 |
|---------|---------|---------|--------|
| UR-038 | 语言支持 | 支持系统配置的所有语言 | P0 |
| UR-039 | 时区支持 | 支持IANA时区数据库中的所有时区 | P0 |
| UR-040 | 偏好继承 | 用户可以继承组织的默认偏好 | P1 |

### 3.8 用户审计规则

| 规则编号 | 规则名称 | 规则说明 | 优先级 |
|---------|---------|---------|--------|
| UR-041 | 操作日志 | 所有用户操作必须记录日志 | P0 |
| UR-042 | 登录日志 | 所有用户登录必须记录日志 | P0 |
| UR-043 | 审计日志 | 审计日志至少保留1年 | P0 |
| UR-044 | 安全日志 | 安全相关操作必须记录安全日志 | P0 |
| UR-045 | 日志不可删除 | 审计日志和安全日志不可删除 | P0 |

---

## 四、数据字典

### 4.1 用户状态（UserStatus）

| 值 | 名称 | 说明 | 使用场景 |
|----|------|------|---------|
| ACTIVE | 激活 | 用户激活状态，可以正常使用 | 正常用户 |
| INACTIVE | 未激活 | 用户未激活状态，不能登录 | 待激活用户 |
| LOCKED | 锁定 | 用户账户锁定状态，不能登录 | 违规或异常用户 |
| DELETED | 已删除 | 用户已删除状态 | 已删除用户 |

### 4.2 账户状态（AccountStatus）

| 值 | 名称 | 说明 | 使用场景 |
|----|------|------|---------|
| NORMAL | 正常 | 账户正常状态 | 正常账户 |
| LOCKED | 锁定 | 账户锁定状态 | 登录失败过多 |
| PASSWORD_EXPIRED | 密码过期 | 密码已过期 | 密码过期 |
| NEED_CHANGE_PASSWORD | 需要修改密码 | 首次登录或密码重置后 | 需要修改密码 |

### 4.3 用户类型（UserType）

| 值 | 名称 | 说明 | 使用场景 |
|----|------|------|---------|
| INTERNAL | 内部用户 | 企业内部员工 | 员工 |
| EXTERNAL | 外部用户 | 外部用户（客户、供应商等） | 外部用户 |
| SYSTEM | 系统用户 | 系统自动创建的用户 | 系统任务 |

### 4.4 性别（Gender）

| 值 | 名称 | 说明 | 使用场景 |
|----|------|------|---------|
| MALE | 男 | 男性 | 用户性别 |
| FEMALE | 女 | 女性 | 用户性别 |
| UNKNOWN | 未知 | 未知性别 | 用户性别 |

### 4.5 就职状态（EmploymentStatus）

| 值 | 名称 | 说明 | 使用场景 |
|----|------|------|---------|
| ACTIVE | 在职 | 在职状态 | 在职员工 |
| RESIGNED | 离职 | 离职状态 | 离职员工 |
| TRANSFERRED | 调动 | 调动状态 | 调动中 |
| SUSPENDED | 暂停 | 暂停状态 | 暂停工作 |

### 4.6 登录方式（LoginMethod）

| 值 | 名称 | 说明 | 使用场景 |
|----|------|------|---------|
| PASSWORD | 密码 | 密码登录 | 默认登录方式 |
| PHONE | 手机号 | 手机号验证码登录 | 手机号登录 |
| EMAIL | 邮箱 | 邮箱验证码登录 | 邮箱登录 |
| SSO | 单点登录 | 单点登录 | 企业SSO |
| WECHAT | 微信 | 微信登录 | 微信登录 |
| DINGTALK | 钉钉 | 钉钉登录 | 钉钉登录 |
| FEISHU | 飞书 | 飞书登录 | 飞书登录 |

### 4.7 通知类型（NotificationType）

| 值 | 名称 | 说明 | 使用场景 |
|----|------|------|---------|
| SYSTEM | 系统通知 | 系统通知 | 系统消息 |
| TASK | 任务通知 | 任务通知 | 任务消息 |
| APPROVAL | 审批通知 | 审批通知 | 审批消息 |
| REMIND | 提醒通知 | 提醒通知 | 提醒消息 |
| ALERT | 告警通知 | 告警通知 | 告警消息 |

### 4.8 通知接收方式（NotificationReceiveMethod）

| 值 | 名称 | 说明 | 使用场景 |
|----|------|------|---------|
| SYSTEM | 系统内 | 系统内通知 | 站内信 |
| EMAIL | 邮件 | 邮件通知 | 邮件 |
| SMS | 短信 | 短信通知 | 短信 |
| WECHAT | 微信 | 微信通知 | 微信 |
| DINGTALK | 钉钉 | 钉钉通知 | 钉钉 |

---

## 五、API接口定义

### 5.1 用户管理接口

#### 5.1.1 创建用户

```
POST /api/v1/users
Content-Type: application/json

Request Body:
{
    "username": "zhangsan",
    "password": "Abc@123456",
    "userType": "INTERNAL",
    "profile": {
        "realName": "张三",
        "nickname": "小三",
        "gender": "MALE",
        "birthday": "1990-01-01",
        "phone": "13800138000",
        "email": "zhangsan@example.com",
        "employeeNo": "E001",
        "hireDate": "2024-01-01"
    },
    "organizationIds": [1, 2],
    "roleIds": [1, 2]
}

Response:
{
    "code": 200,
    "message": "成功",
    "data": {
        "userId": 1
    }
}
```

#### 5.1.2 更新用户

```
PUT /api/v1/users/{userId}
Content-Type: application/json

Request Body:
{
    "profile": {
        "realName": "张三",
        "nickname": "三三",
        "avatar": "https://example.com/avatar.jpg"
    },
    "preference": {
        "language": "zh-CN",
        "timezone": "Asia/Shanghai",
        "theme": "dark"
    }
}

Response:
{
    "code": 200,
    "message": "成功",
    "data": null
}
```

#### 5.1.3 删除用户

```
DELETE /api/v1/users/{userId}

Response:
{
    "code": 200,
    "message": "成功",
    "data": null
}
```

#### 5.1.4 查询用户详情

```
GET /api/v1/users/{userId}

Response:
{
    "code": 200,
    "message": "成功",
    "data": {
        "userId": 1,
        "username": "zhangsan",
        "status": "ACTIVE",
        "accountStatus": "NORMAL",
        "userType": "INTERNAL",
        "lastLoginTime": "2024-01-18T10:00:00",
        "lastLoginIp": "192.168.1.1",
        "profile": {
            "realName": "张三",
            "nickname": "小三",
            "avatar": "https://example.com/avatar.jpg",
            "gender": "MALE",
            "birthday": "1990-01-01",
            "phone": "13800138000",
            "email": "zhangsan@example.com",
            "employeeNo": "E001",
            "hireDate": "2024-01-01"
        },
        "organizations": [
            {
                "orgId": 1,
                "orgName": "总公司",
                "isPrimary": true
            }
        ],
        "roles": [
            {
                "roleId": 1,
                "roleName": "普通用户",
                "isPrimary": true
            }
        ],
        "preference": {
            "language": "zh-CN",
            "timezone": "Asia/Shanghai",
            "theme": "dark"
        }
    }
}
```

#### 5.1.5 分页查询用户

```
GET /api/v1/users?page=1&size=20&username=zhangsan&status=ACTIVE

Response:
{
    "code": 200,
    "message": "成功",
    "data": {
        "total": 100,
        "page": 1,
        "size": 20,
        "records": [
            {
                "userId": 1,
                "username": "zhangsan",
                "realName": "张三",
                "nickname": "小三",
                "phone": "13800138000",
                "email": "zhangsan@example.com",
                "status": "ACTIVE",
                "deptName": "技术部",
                "positionName": "软件工程师",
                "lastLoginTime": "2024-01-18T10:00:00"
            }
        ]
    }
}
```

#### 5.1.6 激活用户

```
POST /api/v1/users/{userId}/activate

Response:
{
    "code": 200,
    "message": "成功",
    "data": null
}
```

#### 5.1.7 停用用户

```
POST /api/v1/users/{userId}/deactivate

Response:
{
    "code": 200,
    "message": "成功",
    "data": null
}
```

### 5.2 用户账户接口

#### 5.2.1 修改密码

```
POST /api/v1/users/{userId}/password/change
Content-Type: application/json

Request Body:
{
    "oldPassword": "Abc@123456",
    "newPassword": "Xyz@123456"
}

Response:
{
    "code": 200,
    "message": "成功",
    "data": null
}
```

#### 5.2.2 重置密码

```
POST /api/v1/users/{userId}/password/reset

Response:
{
    "code": 200,
    "message": "成功",
    "data": {
        "newPassword": "Default@123"
    }
}
```

#### 5.2.3 启用MFA

```
POST /api/v1/users/{userId}/mfa/enable

Response:
{
    "code": 200,
    "message": "成功",
    "data": {
        "secret": "JBSWY3DPEHPK3PXP",
        "qrCode": "data:image/png;base64,...",
        "backupCodes": ["123456", "789012", ...]
    }
}
```

#### 5.2.4 禁用MFA

```
POST /api/v1/users/{userId}/mfa/disable

Response:
{
    "code": 200,
    "message": "成功",
    "data": null
}
```

### 5.3 用户组织接口

#### 5.3.1 分配组织

```
POST /api/v1/users/{userId}/organizations
Content-Type: application/json

Request Body:
{
    "orgId": 1,
    "orgName": "总公司",
    "isPrimary": true
}

Response:
{
    "code": 200,
    "message": "成功",
    "data": null
}
```

#### 5.3.2 移除组织

```
DELETE /api/v1/users/{userId}/organizations/{orgId}

Response:
{
    "code": 200,
    "message": "成功",
    "data": null
}
```

#### 5.3.3 查询用户组织

```
GET /api/v1/users/{userId}/organizations

Response:
{
    "code": 200,
    "message": "成功",
    "data": [
        {
            "orgId": 1,
            "orgName": "总公司",
            "isPrimary": true,
            "joinDate": "2024-01-01"
        }
    ]
}
```

### 5.4 用户角色接口

#### 5.4.1 分配角色

```
POST /api/v1/users/{userId}/roles
Content-Type: application/json

Request Body:
{
    "roleId": 1,
    "roleName": "普通用户",
    "isPrimary": true
}

Response:
{
    "code": 200,
    "message": "成功",
    "data": null
}
```

#### 5.4.2 移除角色

```
DELETE /api/v1/users/{userId}/roles/{roleId}

Response:
{
    "code": 200,
    "message": "成功",
    "data": null
}
```

#### 5.4.3 查询用户角色

```
GET /api/v1/users/{userId}/roles

Response:
{
    "code": 200,
    "message": "成功",
    "data": [
        {
            "roleId": 1,
            "roleName": "普通用户",
            "isPrimary": true,
            "assignedTime": "2024-01-01T10:00:00"
        }
    ]
}
```

### 5.5 用户统计接口

#### 5.5.1 用户统计

```
GET /api/v1/users/statistics

Response:
{
    "code": 200,
    "message": "成功",
    "data": {
        "totalCount": 1000,
        "activeCount": 800,
        "inactiveCount": 150,
        "lockedCount": 50,
        "todayLoginCount": 300,
        "weekLoginCount": 500,
        "monthLoginCount": 700
    }
}
```

#### 5.5.2 用户增长趋势

```
GET /api/v1/users/growth-trend?startDate=2024-01-01&endDate=2024-01-31

Response:
{
    "code": 200,
    "message": "成功",
    "data": [
        {
            "date": "2024-01-01",
            "totalCount": 100,
            "newCount": 10
        }
    ]
}
```

---

## 六、业务流程

### 6.1 用户创建流程

```
开始
  ↓
填写用户基本信息
  ↓
填写用户档案信息
  ↓
填写用户账户信息
  ↓
选择用户所属组织
  ↓
选择用户角色
  ↓
校验用户名唯一性
  ↓
校验手机号唯一性
  ↓
校验邮箱唯一性
  ↓
校验密码复杂度
  ↓
创建用户聚合
  ↓
保存用户
  ↓
发布用户创建事件
  ↓
结束
```

### 6.2 用户登录流程

```
开始
  ↓
输入用户名密码
  ↓
验证用户名密码
  ↓ (验证失败)
记录登录失败  ─────────────┐
  ↓                       │
检查登录失败次数           │
  ↓ (次数>=5)              │
锁定账户                   │
  ↓                       │
结束                       │
                           ↓ (验证成功)
检查用户状态
  ↓ (未激活)
返回未激活提示
  ↓
结束
  ↓ (已停用)
返回已停用提示
  ↓
结束
  ↓ (已锁定)
返回已锁定提示
  ↓
结束
  ↓ (正常)
检查是否启用MFA
  ↓ (启用)
验证MFA码
  ↓ (验证失败)
返回MFA验证失败
  ↓
结束
  ↓ (验证成功)
检查密码是否过期
  ↓ (过期)
返回密码过期提示
  ↓
结束
  ↓ (正常)
记录登录成功
  ↓
发布用户登录事件
  ↓
结束
```

### 6.3 用户组织调动流程

```
开始
  ↓
选择用户
  ↓
选择目标组织
  ↓
选择目标岗位
  ↓
填写调动原因
  ↓
提交调动申请
  ↓
是否需要审批
  ↓ (是)
进入审批流程
  ↓ (审批通过)
执行调动
  ↓
更新用户组织关系
  ↓
发布用户组织变更事件
  ↓
结束
  ↓ (否)
直接执行调动
  ↓
更新用户组织关系
  ↓
发布用户组织变更事件
  ↓
结束
```

---

## 七、性能指标

| 指标 | 目标值 | 说明 |
|------|--------|------|
| 用户创建响应时间 | <200ms | 单个用户创建 |
| 用户查询响应时间 | <100ms | 单个用户查询 |
| 用户列表查询响应时间 | <300ms | 分页查询20条 |
| 用户登录响应时间 | <150ms | 登录验证 |
| 用户创建成功率 | >99.9% | 用户创建成功率 |
| 用户登录成功率 | >99.5% | 用户登录成功率 |
| 并发用户数 | 10000+ | 支持并发用户数 |
| 用户数据一致性 | 100% | 数据一致性保证 |

---

## 八、安全要求

### 8.1 数据安全

| 要求 | 说明 | 优先级 |
|------|------|--------|
| 密码加密 | 密码使用BCrypt加密存储 | P0 |
| 敏感信息脱敏 | 手机号、邮箱等敏感信息显示时脱敏 | P0 |
| 数据加密 | 敏感数据传输使用HTTPS | P0 |
| 数据备份 | 用户数据定期备份 | P0 |

### 8.2 访问控制

| 要求 | 说明 | 优先级 |
|------|------|--------|
| 权限验证 | 所有API接口验证用户权限 | P0 |
| 数据权限 | 验证用户数据访问权限 | P0 |
| 操作日志 | 记录所有用户操作 | P0 |
| 审计日志 | 记录审计日志 | P0 |

### 8.3 防护措施

| 要求 | 说明 | 优先级 |
|------|------|--------|
| 登录限制 | 限制登录失败次数 | P0 |
| MFA验证 | 支持多因素认证 | P0 |
| 异常检测 | 检测异常登录 | P1 |
| 防暴力破解 | 防止暴力破解 | P0 |

---

## 九、实施计划

### 9.1 第一阶段（P0功能）

| 序号 | 功能模块 | 预计工期 | 负责人 |
|------|---------|---------|--------|
| 1 | 用户身份管理 | 2周 | 待定 |
| 2 | 用户档案管理（基本信息） | 1周 | 待定 |
| 3 | 用户账户管理 | 2周 | 待定 |
| 4 | 用户组织关联管理 | 1周 | 待定 |
| 5 | 用户角色关联管理 | 1周 | 待定 |
| 6 | 用户偏好管理（语言、时区） | 1周 | 待定 |

### 9.2 第二阶段（P1功能）

| 序号 | 功能模块 | 预计工期 | 负责人 |
|------|---------|---------|--------|
| 1 | 用户档案管理（扩展信息） | 1周 | 待定 |
| 2 | 用户活动管理 | 1周 | 待定 |
| 3 | 用户查询与统计 | 1周 | 待定 |
| 4 | 用户批量操作 | 1周 | 待定 |
| 5 | 用户审核与审批 | 1周 | 待定 |

### 9.3 第三阶段（P2功能）

| 序号 | 功能模块 | 预计工期 | 负责人 |
|------|---------|---------|--------|
| 1 | 用户关系管理 | 1周 | 待定 |
| 2 | 用户画像管理 | 1周 | 待定 |
| 3 | 用户通知管理 | 1周 | 待定 |
| 4 | 用户消息管理 | 1周 | 待定 |

---

## 十、总结

本文档基于DDD领域驱动设计，重新定义了QooERP用户管理模块的功能。主要包括：

1. **功能模块划分**：按照DDD原则，将功能划分为用户核心域、用户扩展域、用户管理域
2. **业务规则定义**：定义了详细的业务规则，确保业务逻辑的正确性
3. **API接口定义**：定义了完整的RESTful API接口
4. **业务流程设计**：设计了关键业务的流程图
5. **性能指标**：定义了性能指标和安全要求
6. **实施计划**：制定了分阶段的实施计划

该设计遵循了QooERP总体设计的要求，支持多租户、多组织、多语言、多时区等全球化特性，能够满足不同规模企业的用户管理需求。

---

**文档版本历史**

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|----------|------|
| 2.0.0-REDESIGN | 2026-02-18 | 基于DDD重新设计用户管理功能 | QooERP团队 |
| 1.0.0 | 2026-02-17 | 初始版本 | QooERP团队 |
